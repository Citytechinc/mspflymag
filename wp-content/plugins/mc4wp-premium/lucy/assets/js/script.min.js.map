{"version":3,"sources":["lucy/assets/js/script.js"],"names":["require","undefined","define","e","t","n","r","s","o","u","a","i","f","Error","code","l","exports","call","length","1","module","Lucy","config","siteUrl","algoliaAppId","algoliaAppKey","algoliaIndexName","links","text","href","contactLink","window","lucy_config","emailLink","email_link","./third-party/lucy.js","2","addEvent","element","event","handler","addEventListener","attachEvent","removeEvent","removeEventListener","detachEvent","maybeClose","type","keyCode","this","close","clickedElement","target","srcElement","contains","listenForInput","value","searchQuery","reset","search","m","algoliasearch","algolia","initIndex","opened","loader","searchResults","document","createElement","setAttribute","hrefLinks","hrefContactLink","charAt","substr","body","appendChild","mount","view","getDOM","bind","prototype","results","map","trust","style","display","onclick","onsubmit","onkeyup","el","focus","placeholder","class","open","redraw","query","tick","innerText","loadingInterval","setInterval","handleAlgoliaResults","error","result","urlPrefix","clearInterval","console","log","parser","hits","path","url","pathname","_highlightResult","title","hitsPerPage","mithril","3","parse","str","match","exec","parseFloat","toLowerCase","y","d","h","_short","ms","Math","round","_long","plural","name","floor","ceil","val","options","4","AlgoliaSearch","AlgoliaSearchCore","apply","arguments","notImplemented","message","errors","AlgoliaSearchError","Index","deprecate","deprecatedMessage","inherits","deleteIndex","indexName","callback","_jsonRequest","method","encodeURIComponent","hostType","moveIndex","srcIndexName","dstIndexName","postObj","operation","destination","copyIndex","getLogs","offset","clone","params","_getSearchParams","listIndexes","page","listUserKeys","getUserKeyACL","key","deleteUserKey","addUserKey","acls","isArray","usage","acl","validity","maxQueriesPerIPPerHour","maxHitsPerQuery","indexes","description","queryParameters","referers","addUserKeyWithValidity","updateUserKey","putObj","startQueriesBatch","_batch","addQueryInBatch","args","push","sendQueriesBatch","batch","operations","requests","destroy","enableRateLimitForward","disableRateLimitForward","useSecuredAPIKey","disableSecuredAPIKey","generateSecuredApiKey","./AlgoliaSearchCore.js","./Index.js","./clone.js","./deprecate.js","./deprecatedMessage.js","./errors","isarray","5","applicationID","apiKey","opts","debug","_allowEmptyCredentials","defaultHosts","shuffle","hosts","read","write","hostIndex","protocol","timeout","test","concat","prepareHost","requestTimeout","extraHeaders","cache","_cache","_ua","_useCache","_useFallback","useFallback","_setTimeout","host","safeJSONStringify","obj","Array","toJSON","JSON","stringify","out","array","temporaryValue","randomIndex","currentIndex","random","removeCredentials","headers","newHeaders","headerName","Object","hasOwnProperty","exitPromise","IndexCore","MAX_API_KEY_LENGTH","setExtraHeader","addAlgoliaAgent","algoliaAgent","initialOpts","doRequest","requester","reqOpts","success","httpResponse","status","statusCode","requestDebug","httpResponseOk","endTime","Date","debugData","currentHost","content","contentLength","startTime","duration","client","cacheID","responseText","shouldRetry","tries","retryRequest","unrecoverableError","_promise","reject","tryFallback","err","stack","Unknown","UnparsableJSON","usingFallback","hasFallback","RequestTimeout","retryRequestWithHigherTimeout","resolve","fallback","jsonBody","_computeRequestHeaders","_request","then","promise","setTimeout","toString","withAPIKey","forEach","requestHeaders","x-algolia-agent","x-algolia-application-id","userToken","securityTags","header","queries","JSONPParams","request","requestId","join","strategy","setSecurityTags","tags","strTags","oredTags","j","setUserToken","clearCache","setRequestTimeout","milliseconds","parseInt","./IndexCore.js","./exitPromise.js","./map.js","foreach","6","addObject","objectID","indexObj","as","addObjects","objects","action","partialUpdateObject","partialObject","createIfNotExists","partialUpdateObjects","saveObject","object","saveObjects","deleteObject","deleteObjects","objectIDs","deleteByQuery","stopOrDelete","searchContent","nbHits","waitTask","doDeleteByQuery","deleteObjectsContent","taskID","failure","attributesToRetrieve","distinct","browseAll","browseLoop","cursor","browser","_stopped","queryString","index","browseCallback","_error","_result","_end","merge","IndexBrowser","ttAdapter","self","syncCb","asyncCb","cb","retryLoop","loop","delay","baseDelay","maxDelay","successCb","failureCb","clearIndex","getSettings","searchSynonyms","saveSynonym","synonym","forwardToSlaves","getSynonym","deleteSynonym","clearSynonyms","batchSynonyms","synonyms","replaceExistingSynonyms","setSettings","settings","./IndexBrowser","./merge.js","7","EventEmitter","stop","_clean","emit","removeAllListeners","events","8","typeAheadArgs","typeAheadValueOption","buildSearchMethod","similarSearch","browse","browseFrom","_search","getObject","attrs","getObjects","./buildSearchMethod.js","9","createAlgoliasearch","../../AlgoliaSearch.js","../createAlgoliasearch.js","10","process","global","Promise","uaSuffix","cloneDeep","getDocumentProtocol","ua","AlgoliaSearchBrowser","inlineHeaders","jsonpRequest","places","env","NODE_ENV","enable","version","initPlaces","__algolia","support","hasXMLHttpRequest","hasXDomainRequest","cors","XMLHttpRequest","load","timedOut","clearTimeout","ontimeout","req","getAllResponseHeaders","more","Network","abort","XDomainRequest","setRequestHeader","onprogress","onload","onerror","send","../clone.js","../errors","../places.js","../version.js","./get-document-protocol","./inline-headers","./jsonp-request","_process","es6-promise","11","location","12","encode","querystring-es3/encode","13","done","cbCalled","clean","JSONPScriptFail","readystatechange","readyState","script","onreadystatechange","head","removeChild","removeGlobals","cbName","JSONPScriptError","JSONPCounter","getElementsByTagName","data","async","defer","src","14","queryParam","./errors.js","15","16","fn","deprecated","warned","17","previousUsage","newUsage","githubAnchorLink","replace","18","extraProperties","captureStackTrace","constructor","createCustomError","AlgoliaSearchCustomError","slice","unshift","19","20","arr","newArr","item","itemIndex","21","sources","source","keyName","22","createPlacesClient","appID","23","24","runTimeout","fun","cachedSetTimeout","runClearTimeout","marker","cachedClearTimeout","cleanUpNextTick","draining","currentQueue","queue","queueIndex","drainQueue","len","run","Item","noop","nextTick","argv","versions","on","addListener","once","off","removeListener","binding","cwd","chdir","dir","umask","25","useColors","documentElement","firebug","exception","table","navigator","userAgent","RegExp","$1","formatArgs","namespace","humanize","diff","c","color","lastC","splice","Function","save","namespaces","storage","removeItem","localstorage","localStorage","chrome","local","colors","formatters","v","./debug","26","selectColor","prevColor","disabled","enabled","curr","prevTime","prev","coerce","format","formatter","logFn","split","skips","names","disable","algolia-ms","27","lib$es6$promise$utils$$objectOrFunction","x","lib$es6$promise$utils$$isFunction","lib$es6$promise$asap$$setScheduler","scheduleFn","lib$es6$promise$asap$$customSchedulerFn","lib$es6$promise$asap$$setAsap","asapFn","lib$es6$promise$asap$$asap","lib$es6$promise$asap$$useNextTick","lib$es6$promise$asap$$flush","lib$es6$promise$asap$$useVertxTimer","lib$es6$promise$asap$$vertxNext","lib$es6$promise$asap$$useMutationObserver","iterations","observer","lib$es6$promise$asap$$BrowserMutationObserver","node","createTextNode","observe","characterData","lib$es6$promise$asap$$useMessageChannel","channel","MessageChannel","port1","onmessage","port2","postMessage","lib$es6$promise$asap$$useSetTimeout","lib$es6$promise$asap$$len","lib$es6$promise$asap$$queue","arg","lib$es6$promise$asap$$attemptVertx","vertx","runOnLoop","runOnContext","lib$es6$promise$then$$then","onFulfillment","onRejection","parent","child","lib$es6$promise$$internal$$noop","lib$es6$promise$$internal$$PROMISE_ID","lib$es6$promise$$internal$$makePromise","state","_state","lib$es6$promise$$internal$$invokeCallback","lib$es6$promise$$internal$$subscribe","lib$es6$promise$promise$resolve$$resolve","Constructor","lib$es6$promise$$internal$$resolve","lib$es6$promise$$internal$$selfFulfillment","TypeError","lib$es6$promise$$internal$$cannotReturnOwn","lib$es6$promise$$internal$$getThen","lib$es6$promise$$internal$$GET_THEN_ERROR","lib$es6$promise$$internal$$tryThen","fulfillmentHandler","rejectionHandler","lib$es6$promise$$internal$$handleForeignThenable","thenable","sealed","lib$es6$promise$$internal$$fulfill","reason","lib$es6$promise$$internal$$reject","_label","lib$es6$promise$$internal$$handleOwnThenable","lib$es6$promise$$internal$$FULFILLED","lib$es6$promise$$internal$$REJECTED","lib$es6$promise$$internal$$handleMaybeThenable","maybeThenable","lib$es6$promise$then$$default","lib$es6$promise$promise$resolve$$default","lib$es6$promise$$internal$$publishRejection","_onerror","lib$es6$promise$$internal$$publish","lib$es6$promise$$internal$$PENDING","_subscribers","subscribers","settled","detail","lib$es6$promise$$internal$$ErrorObject","lib$es6$promise$$internal$$tryCatch","lib$es6$promise$$internal$$TRY_CATCH_ERROR","succeeded","failed","hasCallback","lib$es6$promise$$internal$$initializePromise","resolver","lib$es6$promise$$internal$$nextId","lib$es6$promise$$internal$$id","lib$es6$promise$promise$all$$all","entries","lib$es6$promise$enumerator$$default","lib$es6$promise$promise$race$$race","lib$es6$promise$utils$$isArray","lib$es6$promise$promise$reject$$reject","lib$es6$promise$promise$$needsResolver","lib$es6$promise$promise$$needsNew","lib$es6$promise$promise$$Promise","lib$es6$promise$enumerator$$Enumerator","input","_instanceConstructor","_input","_remaining","_enumerate","lib$es6$promise$enumerator$$validationError","lib$es6$promise$polyfill$$polyfill","P","cast","lib$es6$promise$promise$$default","lib$es6$promise$utils$$_isArray","lib$es6$promise$asap$$scheduleFlush","lib$es6$promise$asap$$browserWindow","lib$es6$promise$asap$$browserGlobal","MutationObserver","WebKitMutationObserver","lib$es6$promise$asap$$isNode","lib$es6$promise$asap$$isWorker","Uint8ClampedArray","importScripts","substring","lib$es6$promise$promise$all$$default","lib$es6$promise$promise$race$$default","lib$es6$promise$promise$reject$$default","all","race","_setScheduler","_setAsap","_asap","catch","_eachEntry","entry","_settledAt","_willSettleAt","enumerator","lib$es6$promise$polyfill$$default","lib$es6$promise$umd$$ES6Promise","polyfill","28","_events","_maxListeners","isFunction","isNumber","isObject","isUndefined","defaultMaxListeners","setMaxListeners","isNaN","er","listeners","context","listener","newListener","trace","g","fired","list","position","ret","listenerCount","evlistener","emitter","29","hasOwn","ctx","k","30","31","create","ctor","superCtor","super_","enumerable","writable","configurable","TempCtor","32","33","factory","amd","isString","initialize","mock","$document","$location","$cancelAnimationFrame","cancelAnimationFrame","$requestAnimationFrame","requestAnimationFrame","parseTagAttrs","cell","tag","classes","id","pair","getVirtualChildren","hasAttrs","children","assignAttrs","classAttr","attrName","pairs","parameterize","forKeys","dataToString","injectTextNode","parentElement","first","insertNode","nodeValue","flatten","insertBefore","childNodes","handleKeysDiffer","existing","cached","MOVE","from","nodes","INSERTION","actions","prop","changes","sort","sortChanges","newCached","change","DELETION","clear","dummy","changeElement","maybeChanged","diffKeys","keysDiffer","cachedCell","diffArray","_","parentNode","indexOf","buildArrayKeys","guid","isDifferentEnough","dataAttrKeys","keys","configContext","retain","maybeRecreateObject","onunload","controllers","controller","preventDefault","getObjectNamespace","xmlns","unloadCachedControllers","views","$old","pendingRequests","scheduleConfigsToBeCalled","configs","isNew","buildUpdatedNode","editable","hasKeys","setAttributes","build","contenteditable","intact","handleNonexistentNodes","$trusted","injectHTML","nodeName","voidElements","reattachNodes","parentTag","activeElement","innerHTML","nodeType","trim","handleTextNode","shouldReattach","valueOf","getSubArrayCount","buildArray","subArrayCount","shouldMaintainIdentities","cacheCount","makeCache","parentIndex","parentCache","end","constructNode","is","createElementNS","constructAttrs","constructChildren","reconstructCached","getController","cachedControllers","controllerIndex","updateLists","unloaders","checkView","forcing","subtree","markViews","$original","buildObject","b","copyStyleAttrs","dataAttr","cachedAttr","rule","setSingleAttr","autoredraw","setAttributeNS","shouldUseSetAttribute","trySetAttr","cachedAttrs","dataAttrs","unload","appendTextFragment","createRange","createContextualFragment","insertAdjacentHTML","replaceScriptNodes","tagName","replaceChild","buildExecutableNode","scriptEl","attributes","nextSibling","isElement","startComputation","endFirstComputation","getCellCacheKey","nodeCache","gettersetter","store","component","ctrl","currentArgs","output","checkPrevented","root","isPrevented","roots","currentComponent","topComponent","components","removeRootElement","computePreRedrawHook","render","computePostRedrawHook","lastRedrawId","lastRedrawCallTime","endComputation","normalizeRoute","route","modes","mode","routeByValue","router","routeParams","queryStart","parseQueryString","matcher","values","decodeURIComponent","routeUnobtrusive","ctrlKey","metaKey","shiftKey","which","returnValue","currentTarget","setScroll","hash","scrollTo","buildQueryString","prefix","duplicates","string","cacheKey","cellCache","propify","initialValue","Deferred","onSuccess","onFailure","finish","REJECTED","next","deferred","RESOLVED","promiseValue","thennable","notThennable","count","fire","REJECTING","RESOLVING","identity","handleJsonp","callbackKey","callbackName","getTime","resp","createXhr","xhr","user","password","serialize","deserialize","maybeXhr","FormData","ajax","dataType","bindData","querystring","parameterizeUrl","token","AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR","deps","html","form","width","height","documentNode","forceRecreation","isDocumentRoot","String","FRAME_BUDGET","unloader","redrawing","force","withAttr","withAttrCallback","callbackThis","_this","getAttribute","currentRoute","redirect","isDefaultRoute","arg1","arg2","vdom","base","oldRoute","queryIndex","currentPath","replaceHistory","history","pushState","param","sync","synchronizer","pos","resolved","outstanding","background","extract","isJSONP","jsonp","toUpperCase","ev","response","unwrapSuccess","res","unwrapError","34","xs","stringifyPrimitive","isFinite","sep","eq","objectKeys","ks"],"mappings":"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","file":"lucy/assets/js/script.min.js","sourcesContent":["(function () { var require = undefined; var define = undefined; (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\nvar Lucy = require('./third-party/lucy.js');\nvar config = {\n\tsiteUrl: 'https://mc4wp.com/',\n\talgoliaAppId: 'DA9YFSTRKA',\n\talgoliaAppKey: 'ce1c93fad15be2b70e0aa0b1c2e52d8e',\n\talgoliaIndexName: 'wpkb_articles',\n\tlinks: [\n\t\t{\n\t\t\ttext: \"<span class=\\\"dashicons dashicons-book\\\"></span> Knowledge Base\",\n\t\t\thref: \"https://mc4wp.com/kb/\"\n\t\t},\n\t\t{\n\t\t\ttext: \"<span class=\\\"dashicons dashicons-editor-code\\\"></span> Code Reference\",\n\t\t\thref: \"http://developer.mc4wp.com/\"\n\t\t},\n\t\t{\n\t\t\ttext: \"<span class=\\\"dashicons dashicons-editor-break\\\"></span> Changelog\",\n\t\t\thref: \"http://mc4wp.com/documentation/changelog/\"\n\t\t}\n\t],\n\tcontactLink: 'mailto:support@mc4wp.com'\n};\n\n// grab from WP dumped var.\nif( window.lucy_config ) {\n\tconfig.emailLink = window.lucy_config.email_link;\n}\n\nvar lucy = new Lucy(\n\tconfig.siteUrl,\n\tconfig.algoliaAppId,\n\tconfig.algoliaAppKey,\n\tconfig.algoliaIndexName,\n\tconfig.links,\n\tconfig.contactLink\n);\n},{\"./third-party/lucy.js\":2}],2:[function(require,module,exports){\n'use strict';\n\nvar m = require('mithril');\nvar algoliasearch = require('algoliasearch');\n\nfunction addEvent(element, event, handler) {\n\tif(element.addEventListener){\n\t\telement.addEventListener(event,handler,false);\n\t} else {\n\t\telement.attachEvent('on' + event, handler);\n\t}\n}\n\nfunction removeEvent(element, event, handler){\n\tif(element.removeEventListener){\n\t\telement.removeEventListener(event, handler);\n\t} else {\n\t\telement.detachEvent('on' + event, handler);\n\t}\n}\n\nfunction maybeClose(event) {\n\t// close when pressing ESCAPE\n\tif(event.type === 'keyup' && event.keyCode == 27 ) {\n\t\tthis.close();\n\t\treturn;\n\t}\n\n\t// close when clicking ANY element outside of Lucy\n\tvar clickedElement = event.target || event.srcElement;\n\tif(event.type === 'click' && this.element.contains && ! this.element.contains(clickedElement) )  {\n\t\tthis.close();\n\t}\n}\n\nfunction listenForInput(event) {\n\tvar element = event.target || event.srcElement;\n\tvar value = element.value;\n\n\t// revert back to list of links when empty\n\tif( value === '' && this.searchQuery !== '' ) {\n\t\tthis.reset();\n\t\treturn;\n\t}\n\n\tthis.searchQuery = value;\n\n\t// perform search on [ENTER]\n\tif(event.keyCode == 13 ) {\n\t\tthis.search(value);\n\t}\n}\n\nvar Lucy = function( siteUrl, algoliaAppId, algoliaAppKey, algoliaIndexName, links, contactLink ) {\n\n\tthis.siteUrl = siteUrl;\n\tthis.algolia = algoliasearch( algoliaAppId, algoliaAppKey ).initIndex( algoliaIndexName );\n\tthis.opened = false;\n\tthis.loader = null;\n\tthis.searchResults = null;\n\tthis.searchQuery = '';\n\tthis.element = document.createElement('div');\n\tthis.element.setAttribute('class','lucy closed');\n\tthis.hrefLinks = links;\n\tthis.hrefContactLink = contactLink;\n\n\t// make sure site url does not have trailing slash\n\tif( this.siteUrl.charAt(this.siteUrl.length - 1) == \"/\") {\n\t\tthis.siteUrl = this.siteUrl.substr(0, this.siteUrl.length - 1);\n\t}\n\n\tdocument.body.appendChild(this.element);\n\tm.mount(this.element, { view: this.getDOM.bind(this) });\n};\n\nLucy.prototype.getDOM = function() {\n\n\tvar results = \"\";\n\n\tif( this.searchQuery.length > 0 ) {\n\t\tif( this.searchResults === null ) {\n\t\t\tresults = m(\"em.search-pending\", \"Hit [ENTER] to search for \\\"\"+ this.searchQuery + \"\\\"..\")\n\t\t} else if( this.searchResults.length > 0 ) {\n\t\t\tresults = this.searchResults.map(function(l) {\n\t\t\t\treturn m('a', { href: l.href }, m.trust(l.text) );\n\t\t\t})\n\t\t} else {\n\t\t\tresults = m('em.search-pending',  \"Nothing found for \\\"\"+ this.searchQuery + \"\\\"..\");\n\t\t}\n\t}\n\n\treturn [\n\t\tm('div.lucy--content', { style: { display: this.opened ? 'block' : 'none' } }, [\n\t\t\tm('span.close-icon', { onclick: this.close.bind(this) }, \"\"),\n\t\t\tm('div.header', [\n\t\t\t\tm('h4', 'Looking for help?'),\n\t\t\t\tm('div.search-form', {\n\t\t\t\t\tonsubmit: this.search.bind(this)\n\t\t\t\t}, [\n\t\t\t\t\tm('input', {\n\t\t\t\t\t\ttype: 'text',\n\t\t\t\t\t\tvalue: this.searchQuery,\n\t\t\t\t\t\tonkeyup: listenForInput.bind(this),\n\t\t\t\t\t\tconfig: (function(el) { this.opened && el.focus(); }).bind(this),\n\t\t\t\t\t\tplaceholder: 'What are you looking for?'\n\t\t\t\t\t}),\n\t\t\t\t\tm('span', {\n\t\t\t\t\t\t\"class\": 'loader',\n\t\t\t\t\t\tconfig: (function(element) {\n\t\t\t\t\t\t\tthis.loader = element;\n\t\t\t\t\t\t}).bind(this)\n\t\t\t\t\t}),\n\t\t\t\t\tm('input', { type: 'submit' })\n\t\t\t\t])\n\t\t\t]),\n\t\t\tm('div.list', [\n\n\t\t\t\tm('div.links', { style: { display: this.searchQuery.length > 0 ? 'none' : 'block' } }, this.hrefLinks.map(function(l) {\n\t\t\t\t\treturn m('a', { href: l.href }, m.trust(l.text) );\n\t\t\t\t})),\n\n\t\t\t\tm('div.search-results', results)\n\n\t\t\t]),\n\t\t\tm('div.footer', [\n\t\t\t\tm(\"span\", \"Can't find the answer you're looking for?\"),\n\t\t\t\tm(\"a\", { \"class\": 'button button-primary', href: this.hrefContactLink, target: \"_blank\" }, \"Contact Support\")\n\t\t\t])\n\t\t]),\n\t\tm('span.lucy-button', {\n\t\t\tonclick: this.open.bind(this),\n\t\t\tstyle: { display: this.opened ? 'none' : 'block' }\n\t\t}, [\n\t\t\tm('span.lucy-button-text',  \"Need help?\")\n\t\t])\n\t];\n};\n\nLucy.prototype.open = function() {\n\tif( this.opened ) return;\n\tthis.opened = true;\n\n\tthis.element.setAttribute('class', 'lucy open' );\n\n\tm.redraw();\n\n\taddEvent(document, 'keyup', maybeClose.bind(this));\n\taddEvent(document, 'click', maybeClose.bind(this));\n};\n\nLucy.prototype.close = function() {\n\tif( ! this.opened ) return;\n\tthis.opened = false;\n\n\tthis.reset();\n\tthis.element.setAttribute('class', 'lucy closed' );\n\n\tremoveEvent(document, 'keyup', maybeClose.bind(this));\n\tremoveEvent(document, 'click', maybeClose.bind(this));\n};\n\nLucy.prototype.reset = function() {\n\tthis.searchQuery = '';\n\tthis.searchResults = null;\n\tm.redraw();\n};\n\nLucy.prototype.search = function(query) {\n\tvar loader = this.loader;\n\tvar tick = function() {\n\t\tloader.innerText += '.';\n\n\t\tif( loader.innerText.length > 3 ) {\n\t\t\tloader.innerText = '.';\n\t\t}\n\t};\n\n\t// start loader\n\tloader.innerText = '.';\n\tvar loadingInterval = window.setInterval(tick, 333 );\n\n\t// search\n\tvar handleAlgoliaResults = function( error, result ) {\n\n\t\tvar urlPrefix = this.siteUrl;\n\t\tthis.searchResults = [];\n\n\t\t/* clear loader */\n\t\tloader.innerText = '';\n\t\twindow.clearInterval(loadingInterval);\n\n\t\tif( error ) {\n\t\t\tconsole.log(error);\n\t\t\treturn;\n\t\t}\n\n\t\tvar parser = document.createElement('a');\n\t\tthis.searchResults = result.hits.map(function(r) {\n\t\t\tparser.href = r.path;\n\t\t\tvar url = urlPrefix + parser.pathname + ( parser.search || '' );\n\t\t\treturn { href: url, text: r._highlightResult.title.value};\n\t\t});\n\n\t\tm.redraw();\n\t};\n\n\tthis.algolia.search( query, { hitsPerPage: 5 }, handleAlgoliaResults.bind(this));\n};\n\n\n\nmodule.exports = Lucy;\n},{\"algoliasearch\":9,\"mithril\":33}],3:[function(require,module,exports){\n/**\n * Helpers.\n */\n\nvar s = 1000;\nvar m = s * 60;\nvar h = m * 60;\nvar d = h * 24;\nvar y = d * 365.25;\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {String|Number} val\n * @param {Object} options\n * @return {String|Number}\n * @api public\n */\n\nmodule.exports = function(val, options){\n  options = options || {};\n  if ('string' == typeof val) return parse(val);\n  // long, short were \"future reserved words in js\", YUI compressor fail on them\n  // https://github.com/algolia/algoliasearch-client-js/issues/113#issuecomment-111978606\n  // https://github.com/yui/yuicompressor/issues/47\n  // https://github.com/rauchg/ms.js/pull/40\n  return options['long']\n    ? _long(val)\n    : _short(val);\n};\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {String} str\n * @return {Number}\n * @api private\n */\n\nfunction parse(str) {\n  str = '' + str;\n  if (str.length > 10000) return;\n  var match = /^((?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);\n  if (!match) return;\n  var n = parseFloat(match[1]);\n  var type = (match[2] || 'ms').toLowerCase();\n  switch (type) {\n    case 'years':\n    case 'year':\n    case 'yrs':\n    case 'yr':\n    case 'y':\n      return n * y;\n    case 'days':\n    case 'day':\n    case 'd':\n      return n * d;\n    case 'hours':\n    case 'hour':\n    case 'hrs':\n    case 'hr':\n    case 'h':\n      return n * h;\n    case 'minutes':\n    case 'minute':\n    case 'mins':\n    case 'min':\n    case 'm':\n      return n * m;\n    case 'seconds':\n    case 'second':\n    case 'secs':\n    case 'sec':\n    case 's':\n      return n * s;\n    case 'milliseconds':\n    case 'millisecond':\n    case 'msecs':\n    case 'msec':\n    case 'ms':\n      return n;\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction _short(ms) {\n  if (ms >= d) return Math.round(ms / d) + 'd';\n  if (ms >= h) return Math.round(ms / h) + 'h';\n  if (ms >= m) return Math.round(ms / m) + 'm';\n  if (ms >= s) return Math.round(ms / s) + 's';\n  return ms + 'ms';\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction _long(ms) {\n  return plural(ms, d, 'day')\n    || plural(ms, h, 'hour')\n    || plural(ms, m, 'minute')\n    || plural(ms, s, 'second')\n    || ms + ' ms';\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, n, name) {\n  if (ms < n) return;\n  if (ms < n * 1.5) return Math.floor(ms / n) + ' ' + name;\n  return Math.ceil(ms / n) + ' ' + name + 's';\n}\n\n},{}],4:[function(require,module,exports){\nmodule.exports = AlgoliaSearch;\n\nvar Index = require('./Index.js');\nvar deprecate = require('./deprecate.js');\nvar deprecatedMessage = require('./deprecatedMessage.js');\nvar AlgoliaSearchCore = require('./AlgoliaSearchCore.js');\nvar inherits = require('inherits');\nvar errors = require('./errors');\n\nfunction AlgoliaSearch() {\n  AlgoliaSearchCore.apply(this, arguments);\n}\n\ninherits(AlgoliaSearch, AlgoliaSearchCore);\n\n/*\n * Delete an index\n *\n * @param indexName the name of index to delete\n * @param callback the result callback called with two arguments\n *  error: null or Error('message')\n *  content: the server answer that contains the task ID\n */\nAlgoliaSearch.prototype.deleteIndex = function(indexName, callback) {\n  return this._jsonRequest({\n    method: 'DELETE',\n    url: '/1/indexes/' + encodeURIComponent(indexName),\n    hostType: 'write',\n    callback: callback\n  });\n};\n\n/**\n * Move an existing index.\n * @param srcIndexName the name of index to copy.\n * @param dstIndexName the new index name that will contains a copy of\n * srcIndexName (destination will be overriten if it already exist).\n * @param callback the result callback called with two arguments\n *  error: null or Error('message')\n *  content: the server answer that contains the task ID\n */\nAlgoliaSearch.prototype.moveIndex = function(srcIndexName, dstIndexName, callback) {\n  var postObj = {\n    operation: 'move', destination: dstIndexName\n  };\n  return this._jsonRequest({\n    method: 'POST',\n    url: '/1/indexes/' + encodeURIComponent(srcIndexName) + '/operation',\n    body: postObj,\n    hostType: 'write',\n    callback: callback\n  });\n};\n\n/**\n * Copy an existing index.\n * @param srcIndexName the name of index to copy.\n * @param dstIndexName the new index name that will contains a copy\n * of srcIndexName (destination will be overriten if it already exist).\n * @param callback the result callback called with two arguments\n *  error: null or Error('message')\n *  content: the server answer that contains the task ID\n */\nAlgoliaSearch.prototype.copyIndex = function(srcIndexName, dstIndexName, callback) {\n  var postObj = {\n    operation: 'copy', destination: dstIndexName\n  };\n  return this._jsonRequest({\n    method: 'POST',\n    url: '/1/indexes/' + encodeURIComponent(srcIndexName) + '/operation',\n    body: postObj,\n    hostType: 'write',\n    callback: callback\n  });\n};\n\n/**\n * Return last log entries.\n * @param offset Specify the first entry to retrieve (0-based, 0 is the most recent log entry).\n * @param length Specify the maximum number of entries to retrieve starting\n * at offset. Maximum allowed value: 1000.\n * @param type Specify the maximum number of entries to retrieve starting\n * at offset. Maximum allowed value: 1000.\n * @param callback the result callback called with two arguments\n *  error: null or Error('message')\n *  content: the server answer that contains the task ID\n */\nAlgoliaSearch.prototype.getLogs = function(offset, length, callback) {\n  var clone = require('./clone.js');\n  var params = {};\n  if (typeof offset === 'object') {\n    // getLogs(params)\n    params = clone(offset);\n    callback = length;\n  } else if (arguments.length === 0 || typeof offset === 'function') {\n    // getLogs([cb])\n    callback = offset;\n  } else if (arguments.length === 1 || typeof length === 'function') {\n    // getLogs(1, [cb)]\n    callback = length;\n    params.offset = offset;\n  } else {\n    // getLogs(1, 2, [cb])\n    params.offset = offset;\n    params.length = length;\n  }\n\n  if (params.offset === undefined) params.offset = 0;\n  if (params.length === undefined) params.length = 10;\n\n  return this._jsonRequest({\n    method: 'GET',\n    url: '/1/logs?' + this._getSearchParams(params, ''),\n    hostType: 'read',\n    callback: callback\n  });\n};\n\n/*\n * List all existing indexes (paginated)\n *\n * @param page The page to retrieve, starting at 0.\n * @param callback the result callback called with two arguments\n *  error: null or Error('message')\n *  content: the server answer with index list\n */\nAlgoliaSearch.prototype.listIndexes = function(page, callback) {\n  var params = '';\n\n  if (page === undefined || typeof page === 'function') {\n    callback = page;\n  } else {\n    params = '?page=' + page;\n  }\n\n  return this._jsonRequest({\n    method: 'GET',\n    url: '/1/indexes' + params,\n    hostType: 'read',\n    callback: callback\n  });\n};\n\n/*\n * Get the index object initialized\n *\n * @param indexName the name of index\n * @param callback the result callback with one argument (the Index instance)\n */\nAlgoliaSearch.prototype.initIndex = function(indexName) {\n  return new Index(this, indexName);\n};\n\n/*\n * List all existing user keys with their associated ACLs\n *\n * @param callback the result callback called with two arguments\n *  error: null or Error('message')\n *  content: the server answer with user keys list\n */\nAlgoliaSearch.prototype.listUserKeys = function(callback) {\n  return this._jsonRequest({\n    method: 'GET',\n    url: '/1/keys',\n    hostType: 'read',\n    callback: callback\n  });\n};\n\n/*\n * Get ACL of a user key\n *\n * @param key\n * @param callback the result callback called with two arguments\n *  error: null or Error('message')\n *  content: the server answer with user keys list\n */\nAlgoliaSearch.prototype.getUserKeyACL = function(key, callback) {\n  return this._jsonRequest({\n    method: 'GET',\n    url: '/1/keys/' + key,\n    hostType: 'read',\n    callback: callback\n  });\n};\n\n/*\n * Delete an existing user key\n * @param key\n * @param callback the result callback called with two arguments\n *  error: null or Error('message')\n *  content: the server answer with user keys list\n */\nAlgoliaSearch.prototype.deleteUserKey = function(key, callback) {\n  return this._jsonRequest({\n    method: 'DELETE',\n    url: '/1/keys/' + key,\n    hostType: 'write',\n    callback: callback\n  });\n};\n\n/*\n * Add a new global API key\n *\n * @param {string[]} acls - The list of ACL for this key. Defined by an array of strings that\n *   can contains the following values:\n *     - search: allow to search (https and http)\n *     - addObject: allows to add/update an object in the index (https only)\n *     - deleteObject : allows to delete an existing object (https only)\n *     - deleteIndex : allows to delete index content (https only)\n *     - settings : allows to get index settings (https only)\n *     - editSettings : allows to change index settings (https only)\n * @param {Object} [params] - Optionnal parameters to set for the key\n * @param {number} params.validity - Number of seconds after which the key will be automatically removed (0 means no time limit for this key)\n * @param {number} params.maxQueriesPerIPPerHour - Number of API calls allowed from an IP address per hour\n * @param {number} params.maxHitsPerQuery - Number of hits this API key can retrieve in one call\n * @param {string[]} params.indexes - Allowed targeted indexes for this key\n * @param {string} params.description - A description for your key\n * @param {string[]} params.referers - A list of authorized referers\n * @param {Object} params.queryParameters - Force the key to use specific query parameters\n * @param {Function} callback - The result callback called with two arguments\n *   error: null or Error('message')\n *   content: the server answer with user keys list\n * @return {Promise|undefined} Returns a promise if no callback given\n * @example\n * client.addUserKey(['search'], {\n *   validity: 300,\n *   maxQueriesPerIPPerHour: 2000,\n *   maxHitsPerQuery: 3,\n *   indexes: ['fruits'],\n *   description: 'Eat three fruits',\n *   referers: ['*.algolia.com'],\n *   queryParameters: {\n *     tagFilters: ['public'],\n *   }\n * })\n * @see {@link https://www.algolia.com/doc/rest_api#AddKey|Algolia REST API Documentation}\n */\nAlgoliaSearch.prototype.addUserKey = function(acls, params, callback) {\n  var isArray = require('isarray');\n  var usage = 'Usage: client.addUserKey(arrayOfAcls[, params, callback])';\n\n  if (!isArray(acls)) {\n    throw new Error(usage);\n  }\n\n  if (arguments.length === 1 || typeof params === 'function') {\n    callback = params;\n    params = null;\n  }\n\n  var postObj = {\n    acl: acls\n  };\n\n  if (params) {\n    postObj.validity = params.validity;\n    postObj.maxQueriesPerIPPerHour = params.maxQueriesPerIPPerHour;\n    postObj.maxHitsPerQuery = params.maxHitsPerQuery;\n    postObj.indexes = params.indexes;\n    postObj.description = params.description;\n\n    if (params.queryParameters) {\n      postObj.queryParameters = this._getSearchParams(params.queryParameters, '');\n    }\n\n    postObj.referers = params.referers;\n  }\n\n  return this._jsonRequest({\n    method: 'POST',\n    url: '/1/keys',\n    body: postObj,\n    hostType: 'write',\n    callback: callback\n  });\n};\n\n/**\n * Add a new global API key\n * @deprecated Please use client.addUserKey()\n */\nAlgoliaSearch.prototype.addUserKeyWithValidity = deprecate(function(acls, params, callback) {\n  return this.addUserKey(acls, params, callback);\n}, deprecatedMessage('client.addUserKeyWithValidity()', 'client.addUserKey()'));\n\n/**\n * Update an existing API key\n * @param {string} key - The key to update\n * @param {string[]} acls - The list of ACL for this key. Defined by an array of strings that\n *   can contains the following values:\n *     - search: allow to search (https and http)\n *     - addObject: allows to add/update an object in the index (https only)\n *     - deleteObject : allows to delete an existing object (https only)\n *     - deleteIndex : allows to delete index content (https only)\n *     - settings : allows to get index settings (https only)\n *     - editSettings : allows to change index settings (https only)\n * @param {Object} [params] - Optionnal parameters to set for the key\n * @param {number} params.validity - Number of seconds after which the key will be automatically removed (0 means no time limit for this key)\n * @param {number} params.maxQueriesPerIPPerHour - Number of API calls allowed from an IP address per hour\n * @param {number} params.maxHitsPerQuery - Number of hits this API key can retrieve in one call\n * @param {string[]} params.indexes - Allowed targeted indexes for this key\n * @param {string} params.description - A description for your key\n * @param {string[]} params.referers - A list of authorized referers\n * @param {Object} params.queryParameters - Force the key to use specific query parameters\n * @param {Function} callback - The result callback called with two arguments\n *   error: null or Error('message')\n *   content: the server answer with user keys list\n * @return {Promise|undefined} Returns a promise if no callback given\n * @example\n * client.updateUserKey('APIKEY', ['search'], {\n *   validity: 300,\n *   maxQueriesPerIPPerHour: 2000,\n *   maxHitsPerQuery: 3,\n *   indexes: ['fruits'],\n *   description: 'Eat three fruits',\n *   referers: ['*.algolia.com'],\n *   queryParameters: {\n *     tagFilters: ['public'],\n *   }\n * })\n * @see {@link https://www.algolia.com/doc/rest_api#UpdateIndexKey|Algolia REST API Documentation}\n */\nAlgoliaSearch.prototype.updateUserKey = function(key, acls, params, callback) {\n  var isArray = require('isarray');\n  var usage = 'Usage: client.updateUserKey(key, arrayOfAcls[, params, callback])';\n\n  if (!isArray(acls)) {\n    throw new Error(usage);\n  }\n\n  if (arguments.length === 2 || typeof params === 'function') {\n    callback = params;\n    params = null;\n  }\n\n  var putObj = {\n    acl: acls\n  };\n\n  if (params) {\n    putObj.validity = params.validity;\n    putObj.maxQueriesPerIPPerHour = params.maxQueriesPerIPPerHour;\n    putObj.maxHitsPerQuery = params.maxHitsPerQuery;\n    putObj.indexes = params.indexes;\n    putObj.description = params.description;\n\n    if (params.queryParameters) {\n      putObj.queryParameters = this._getSearchParams(params.queryParameters, '');\n    }\n\n    putObj.referers = params.referers;\n  }\n\n  return this._jsonRequest({\n    method: 'PUT',\n    url: '/1/keys/' + key,\n    body: putObj,\n    hostType: 'write',\n    callback: callback\n  });\n};\n\n/**\n * Initialize a new batch of search queries\n * @deprecated use client.search()\n */\nAlgoliaSearch.prototype.startQueriesBatch = deprecate(function startQueriesBatchDeprecated() {\n  this._batch = [];\n}, deprecatedMessage('client.startQueriesBatch()', 'client.search()'));\n\n/**\n * Add a search query in the batch\n * @deprecated use client.search()\n */\nAlgoliaSearch.prototype.addQueryInBatch = deprecate(function addQueryInBatchDeprecated(indexName, query, args) {\n  this._batch.push({\n    indexName: indexName,\n    query: query,\n    params: args\n  });\n}, deprecatedMessage('client.addQueryInBatch()', 'client.search()'));\n\n/**\n * Launch the batch of queries using XMLHttpRequest.\n * @deprecated use client.search()\n */\nAlgoliaSearch.prototype.sendQueriesBatch = deprecate(function sendQueriesBatchDeprecated(callback) {\n  return this.search(this._batch, callback);\n}, deprecatedMessage('client.sendQueriesBatch()', 'client.search()'));\n\n/**\n * Perform write operations accross multiple indexes.\n *\n * To reduce the amount of time spent on network round trips,\n * you can create, update, or delete several objects in one call,\n * using the batch endpoint (all operations are done in the given order).\n *\n * Available actions:\n *   - addObject\n *   - updateObject\n *   - partialUpdateObject\n *   - partialUpdateObjectNoCreate\n *   - deleteObject\n *\n * https://www.algolia.com/doc/rest_api#Indexes\n * @param  {Object[]} operations An array of operations to perform\n * @return {Promise|undefined} Returns a promise if no callback given\n * @example\n * client.batch([{\n *   action: 'addObject',\n *   indexName: 'clients',\n *   body: {\n *     name: 'Bill'\n *   }\n * }, {\n *   action: 'udpateObject',\n *   indexName: 'fruits',\n *   body: {\n *     objectID: '29138',\n *     name: 'banana'\n *   }\n * }], cb)\n */\nAlgoliaSearch.prototype.batch = function(operations, callback) {\n  var isArray = require('isarray');\n  var usage = 'Usage: client.batch(operations[, callback])';\n\n  if (!isArray(operations)) {\n    throw new Error(usage);\n  }\n\n  return this._jsonRequest({\n    method: 'POST',\n    url: '/1/indexes/*/batch',\n    body: {\n      requests: operations\n    },\n    hostType: 'write',\n    callback: callback\n  });\n};\n\n// environment specific methods\nAlgoliaSearch.prototype.destroy = notImplemented;\nAlgoliaSearch.prototype.enableRateLimitForward = notImplemented;\nAlgoliaSearch.prototype.disableRateLimitForward = notImplemented;\nAlgoliaSearch.prototype.useSecuredAPIKey = notImplemented;\nAlgoliaSearch.prototype.disableSecuredAPIKey = notImplemented;\nAlgoliaSearch.prototype.generateSecuredApiKey = notImplemented;\n\nfunction notImplemented() {\n  var message = 'Not implemented in this environment.\\n' +\n    'If you feel this is a mistake, write to support@algolia.com';\n\n  throw new errors.AlgoliaSearchError(message);\n}\n\n},{\"./AlgoliaSearchCore.js\":5,\"./Index.js\":6,\"./clone.js\":15,\"./deprecate.js\":16,\"./deprecatedMessage.js\":17,\"./errors\":18,\"inherits\":31,\"isarray\":32}],5:[function(require,module,exports){\nmodule.exports = AlgoliaSearchCore;\n\nvar errors = require('./errors');\nvar exitPromise = require('./exitPromise.js');\nvar IndexCore = require('./IndexCore.js');\n\n// We will always put the API KEY in the JSON body in case of too long API KEY\nvar MAX_API_KEY_LENGTH = 500;\n\n/*\n * Algolia Search library initialization\n * https://www.algolia.com/\n *\n * @param {string} applicationID - Your applicationID, found in your dashboard\n * @param {string} apiKey - Your API key, found in your dashboard\n * @param {Object} [opts]\n * @param {number} [opts.timeout=2000] - The request timeout set in milliseconds,\n * another request will be issued after this timeout\n * @param {string} [opts.protocol='http:'] - The protocol used to query Algolia Search API.\n *                                        Set to 'https:' to force using https.\n *                                        Default to document.location.protocol in browsers\n * @param {Object|Array} [opts.hosts={\n *           read: [this.applicationID + '-dsn.algolia.net'].concat([\n *             this.applicationID + '-1.algolianet.com',\n *             this.applicationID + '-2.algolianet.com',\n *             this.applicationID + '-3.algolianet.com']\n *           ]),\n *           write: [this.applicationID + '.algolia.net'].concat([\n *             this.applicationID + '-1.algolianet.com',\n *             this.applicationID + '-2.algolianet.com',\n *             this.applicationID + '-3.algolianet.com']\n *           ]) - The hosts to use for Algolia Search API.\n *           If you provide them, you will less benefit from our HA implementation\n */\nfunction AlgoliaSearchCore(applicationID, apiKey, opts) {\n  var debug = require('debug')('algoliasearch');\n\n  var clone = require('./clone.js');\n  var isArray = require('isarray');\n  var map = require('./map.js');\n\n  var usage = 'Usage: algoliasearch(applicationID, apiKey, opts)';\n\n  if (opts._allowEmptyCredentials !== true && !applicationID) {\n    throw new errors.AlgoliaSearchError('Please provide an application ID. ' + usage);\n  }\n\n  if (opts._allowEmptyCredentials !== true && !apiKey) {\n    throw new errors.AlgoliaSearchError('Please provide an API key. ' + usage);\n  }\n\n  this.applicationID = applicationID;\n  this.apiKey = apiKey;\n\n  var defaultHosts = shuffle([\n    this.applicationID + '-1.algolianet.com',\n    this.applicationID + '-2.algolianet.com',\n    this.applicationID + '-3.algolianet.com'\n  ]);\n  this.hosts = {\n    read: [],\n    write: []\n  };\n\n  this.hostIndex = {\n    read: 0,\n    write: 0\n  };\n\n  opts = opts || {};\n\n  var protocol = opts.protocol || 'https:';\n  var timeout = opts.timeout === undefined ? 2000 : opts.timeout;\n\n  // while we advocate for colon-at-the-end values: 'http:' for `opts.protocol`\n  // we also accept `http` and `https`. It's a common error.\n  if (!/:$/.test(protocol)) {\n    protocol = protocol + ':';\n  }\n\n  if (opts.protocol !== 'http:' && opts.protocol !== 'https:') {\n    throw new errors.AlgoliaSearchError('protocol must be `http:` or `https:` (was `' + opts.protocol + '`)');\n  }\n\n  // no hosts given, add defaults\n  if (!opts.hosts) {\n    this.hosts.read = [this.applicationID + '-dsn.algolia.net'].concat(defaultHosts);\n    this.hosts.write = [this.applicationID + '.algolia.net'].concat(defaultHosts);\n  } else if (isArray(opts.hosts)) {\n    this.hosts.read = clone(opts.hosts);\n    this.hosts.write = clone(opts.hosts);\n  } else {\n    this.hosts.read = clone(opts.hosts.read);\n    this.hosts.write = clone(opts.hosts.write);\n  }\n\n  // add protocol and lowercase hosts\n  this.hosts.read = map(this.hosts.read, prepareHost(protocol));\n  this.hosts.write = map(this.hosts.write, prepareHost(protocol));\n  this.requestTimeout = timeout;\n\n  this.extraHeaders = [];\n\n  // In some situations you might want to warm the cache\n  this.cache = opts._cache || {};\n\n  this._ua = opts._ua;\n  this._useCache = opts._useCache === undefined || opts._cache ? true : opts._useCache;\n  this._useFallback = opts.useFallback === undefined ? true : opts.useFallback;\n\n  this._setTimeout = opts._setTimeout;\n\n  debug('init done, %j', this);\n}\n\n/*\n * Get the index object initialized\n *\n * @param indexName the name of index\n * @param callback the result callback with one argument (the Index instance)\n */\nAlgoliaSearchCore.prototype.initIndex = function(indexName) {\n  return new IndexCore(this, indexName);\n};\n\n/**\n* Add an extra field to the HTTP request\n*\n* @param name the header field name\n* @param value the header field value\n*/\nAlgoliaSearchCore.prototype.setExtraHeader = function(name, value) {\n  this.extraHeaders.push({\n    name: name.toLowerCase(), value: value\n  });\n};\n\n/**\n* Augment sent x-algolia-agent with more data, each agent part\n* is automatically separated from the others by a semicolon;\n*\n* @param algoliaAgent the agent to add\n*/\nAlgoliaSearchCore.prototype.addAlgoliaAgent = function(algoliaAgent) {\n  this._ua += ';' + algoliaAgent;\n};\n\n/*\n * Wrapper that try all hosts to maximize the quality of service\n */\nAlgoliaSearchCore.prototype._jsonRequest = function(initialOpts) {\n  var requestDebug = require('debug')('algoliasearch:' + initialOpts.url);\n\n  var body;\n  var cache = initialOpts.cache;\n  var client = this;\n  var tries = 0;\n  var usingFallback = false;\n  var hasFallback = client._useFallback && client._request.fallback && initialOpts.fallback;\n  var headers;\n\n  if (this.apiKey.length > MAX_API_KEY_LENGTH && initialOpts.body !== undefined && initialOpts.body.params !== undefined) {\n    initialOpts.body.apiKey = this.apiKey;\n    headers = this._computeRequestHeaders(false);\n  } else {\n    headers = this._computeRequestHeaders();\n  }\n\n  if (initialOpts.body !== undefined) {\n    body = safeJSONStringify(initialOpts.body);\n  }\n\n  requestDebug('request start');\n  var debugData = [];\n\n  function doRequest(requester, reqOpts) {\n    var startTime = new Date();\n    var cacheID;\n\n    if (client._useCache) {\n      cacheID = initialOpts.url;\n    }\n\n    // as we sometime use POST requests to pass parameters (like query='aa'),\n    // the cacheID must also include the body to be different between calls\n    if (client._useCache && body) {\n      cacheID += '_body_' + reqOpts.body;\n    }\n\n    // handle cache existence\n    if (client._useCache && cache && cache[cacheID] !== undefined) {\n      requestDebug('serving response from cache');\n      return client._promise.resolve(JSON.parse(cache[cacheID]));\n    }\n\n    // if we reached max tries\n    if (tries >= client.hosts[initialOpts.hostType].length) {\n      if (!hasFallback || usingFallback) {\n        requestDebug('could not get any response');\n        // then stop\n        return client._promise.reject(new errors.AlgoliaSearchError(\n          'Cannot connect to the AlgoliaSearch API.' +\n          ' Send an email to support@algolia.com to report and resolve the issue.' +\n          ' Application id was: ' + client.applicationID, {debugData: debugData}\n        ));\n      }\n\n      requestDebug('switching to fallback');\n\n      // let's try the fallback starting from here\n      tries = 0;\n\n      // method, url and body are fallback dependent\n      reqOpts.method = initialOpts.fallback.method;\n      reqOpts.url = initialOpts.fallback.url;\n      reqOpts.jsonBody = initialOpts.fallback.body;\n      if (reqOpts.jsonBody) {\n        reqOpts.body = safeJSONStringify(reqOpts.jsonBody);\n      }\n      // re-compute headers, they could be omitting the API KEY\n      headers = client._computeRequestHeaders();\n\n      reqOpts.timeout = client.requestTimeout * (tries + 1);\n      client.hostIndex[initialOpts.hostType] = 0;\n      usingFallback = true; // the current request is now using fallback\n      return doRequest(client._request.fallback, reqOpts);\n    }\n\n    var currentHost = client.hosts[initialOpts.hostType][client.hostIndex[initialOpts.hostType]];\n\n    var url = currentHost + reqOpts.url;\n    var options = {\n      body: reqOpts.body,\n      jsonBody: reqOpts.jsonBody,\n      method: reqOpts.method,\n      headers: headers,\n      timeout: reqOpts.timeout,\n      debug: requestDebug\n    };\n\n    requestDebug('method: %s, url: %s, headers: %j, timeout: %d',\n      options.method, url, options.headers, options.timeout);\n\n    if (requester === client._request.fallback) {\n      requestDebug('using fallback');\n    }\n\n    // `requester` is any of this._request or this._request.fallback\n    // thus it needs to be called using the client as context\n    return requester.call(client, url, options).then(success, tryFallback);\n\n    function success(httpResponse) {\n      // compute the status of the response,\n      //\n      // When in browser mode, using XDR or JSONP, we have no statusCode available\n      // So we rely on our API response `status` property.\n      // But `waitTask` can set a `status` property which is not the statusCode (it's the task status)\n      // So we check if there's a `message` along `status` and it means it's an error\n      //\n      // That's the only case where we have a response.status that's not the http statusCode\n      var status = httpResponse && httpResponse.body && httpResponse.body.message && httpResponse.body.status ||\n\n        // this is important to check the request statusCode AFTER the body eventual\n        // statusCode because some implementations (jQuery XDomainRequest transport) may\n        // send statusCode 200 while we had an error\n        httpResponse.statusCode ||\n\n        // When in browser mode, using XDR or JSONP\n        // we default to success when no error (no response.status && response.message)\n        // If there was a JSON.parse() error then body is null and it fails\n        httpResponse && httpResponse.body && 200;\n\n      requestDebug('received response: statusCode: %s, computed statusCode: %d, headers: %j',\n        httpResponse.statusCode, status, httpResponse.headers);\n\n      var httpResponseOk = Math.floor(status / 100) === 2;\n\n      var endTime = new Date();\n      debugData.push({\n        currentHost: currentHost,\n        headers: removeCredentials(headers),\n        content: body || null,\n        contentLength: body !== undefined ? body.length : null,\n        method: reqOpts.method,\n        timeout: reqOpts.timeout,\n        url: reqOpts.url,\n        startTime: startTime,\n        endTime: endTime,\n        duration: endTime - startTime,\n        statusCode: status\n      });\n\n      if (httpResponseOk) {\n        if (client._useCache && cache) {\n          cache[cacheID] = httpResponse.responseText;\n        }\n\n        return httpResponse.body;\n      }\n\n      var shouldRetry = Math.floor(status / 100) !== 4;\n\n      if (shouldRetry) {\n        tries += 1;\n        return retryRequest();\n      }\n\n      requestDebug('unrecoverable error');\n\n      // no success and no retry => fail\n      var unrecoverableError = new errors.AlgoliaSearchError(\n        httpResponse.body && httpResponse.body.message, {debugData: debugData, statusCode: status}\n      );\n\n      return client._promise.reject(unrecoverableError);\n    }\n\n    function tryFallback(err) {\n      // error cases:\n      //  While not in fallback mode:\n      //    - CORS not supported\n      //    - network error\n      //  While in fallback mode:\n      //    - timeout\n      //    - network error\n      //    - badly formatted JSONP (script loaded, did not call our callback)\n      //  In both cases:\n      //    - uncaught exception occurs (TypeError)\n      requestDebug('error: %s, stack: %s', err.message, err.stack);\n\n      var endTime = new Date();\n      debugData.push({\n        currentHost: currentHost,\n        headers: removeCredentials(headers),\n        content: body || null,\n        contentLength: body !== undefined ? body.length : null,\n        method: reqOpts.method,\n        timeout: reqOpts.timeout,\n        url: reqOpts.url,\n        startTime: startTime,\n        endTime: endTime,\n        duration: endTime - startTime\n      });\n\n      if (!(err instanceof errors.AlgoliaSearchError)) {\n        err = new errors.Unknown(err && err.message, err);\n      }\n\n      tries += 1;\n\n      // stop the request implementation when:\n      if (\n        // we did not generate this error,\n        // it comes from a throw in some other piece of code\n        err instanceof errors.Unknown ||\n\n        // server sent unparsable JSON\n        err instanceof errors.UnparsableJSON ||\n\n        // max tries and already using fallback or no fallback\n        tries >= client.hosts[initialOpts.hostType].length &&\n        (usingFallback || !hasFallback)) {\n        // stop request implementation for this command\n        err.debugData = debugData;\n        return client._promise.reject(err);\n      }\n\n      // When a timeout occured, retry by raising timeout\n      if (err instanceof errors.RequestTimeout) {\n        return retryRequestWithHigherTimeout();\n      }\n\n      return retryRequest();\n    }\n\n    function retryRequest() {\n      requestDebug('retrying request');\n      client.hostIndex[initialOpts.hostType] = (client.hostIndex[initialOpts.hostType] + 1) % client.hosts[initialOpts.hostType].length;\n      return doRequest(requester, reqOpts);\n    }\n\n    function retryRequestWithHigherTimeout() {\n      requestDebug('retrying request with higher timeout');\n      client.hostIndex[initialOpts.hostType] = (client.hostIndex[initialOpts.hostType] + 1) % client.hosts[initialOpts.hostType].length;\n      reqOpts.timeout = client.requestTimeout * (tries + 1);\n      return doRequest(requester, reqOpts);\n    }\n  }\n\n  var promise = doRequest(\n    client._request, {\n      url: initialOpts.url,\n      method: initialOpts.method,\n      body: body,\n      jsonBody: initialOpts.body,\n      timeout: client.requestTimeout * (tries + 1)\n    }\n  );\n\n  // either we have a callback\n  // either we are using promises\n  if (initialOpts.callback) {\n    promise.then(function okCb(content) {\n      exitPromise(function() {\n        initialOpts.callback(null, content);\n      }, client._setTimeout || setTimeout);\n    }, function nookCb(err) {\n      exitPromise(function() {\n        initialOpts.callback(err);\n      }, client._setTimeout || setTimeout);\n    });\n  } else {\n    return promise;\n  }\n};\n\n/*\n* Transform search param object in query string\n*/\nAlgoliaSearchCore.prototype._getSearchParams = function(args, params) {\n  if (args === undefined || args === null) {\n    return params;\n  }\n  for (var key in args) {\n    if (key !== null && args[key] !== undefined && args.hasOwnProperty(key)) {\n      params += params === '' ? '' : '&';\n      params += key + '=' + encodeURIComponent(Object.prototype.toString.call(args[key]) === '[object Array]' ? safeJSONStringify(args[key]) : args[key]);\n    }\n  }\n  return params;\n};\n\nAlgoliaSearchCore.prototype._computeRequestHeaders = function(withAPIKey) {\n  var forEach = require('foreach');\n\n  var requestHeaders = {\n    'x-algolia-agent': this._ua,\n    'x-algolia-application-id': this.applicationID\n  };\n\n  // browser will inline headers in the url, node.js will use http headers\n  // but in some situations, the API KEY will be too long (big secured API keys)\n  // so if the request is a POST and the KEY is very long, we will be asked to not put\n  // it into headers but in the JSON body\n  if (withAPIKey !== false) {\n    requestHeaders['x-algolia-api-key'] = this.apiKey;\n  }\n\n  if (this.userToken) {\n    requestHeaders['x-algolia-usertoken'] = this.userToken;\n  }\n\n  if (this.securityTags) {\n    requestHeaders['x-algolia-tagfilters'] = this.securityTags;\n  }\n\n  if (this.extraHeaders) {\n    forEach(this.extraHeaders, function addToRequestHeaders(header) {\n      requestHeaders[header.name] = header.value;\n    });\n  }\n\n  return requestHeaders;\n};\n\n/**\n * Search through multiple indices at the same time\n * @param  {Object[]}   queries  An array of queries you want to run.\n * @param {string} queries[].indexName The index name you want to target\n * @param {string} [queries[].query] The query to issue on this index. Can also be passed into `params`\n * @param {Object} queries[].params Any search param like hitsPerPage, ..\n * @param  {Function} callback Callback to be called\n * @return {Promise|undefined} Returns a promise if no callback given\n */\nAlgoliaSearchCore.prototype.search = function(queries, opts, callback) {\n  var isArray = require('isarray');\n  var map = require('./map.js');\n\n  var usage = 'Usage: client.search(arrayOfQueries[, callback])';\n\n  if (!isArray(queries)) {\n    throw new Error(usage);\n  }\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  } else if (opts === undefined) {\n    opts = {};\n  }\n\n  var client = this;\n\n  var postObj = {\n    requests: map(queries, function prepareRequest(query) {\n      var params = '';\n\n      // allow query.query\n      // so we are mimicing the index.search(query, params) method\n      // {indexName:, query:, params:}\n      if (query.query !== undefined) {\n        params += 'query=' + encodeURIComponent(query.query);\n      }\n\n      return {\n        indexName: query.indexName,\n        params: client._getSearchParams(query.params, params)\n      };\n    })\n  };\n\n  var JSONPParams = map(postObj.requests, function prepareJSONPParams(request, requestId) {\n    return requestId + '=' +\n      encodeURIComponent(\n        '/1/indexes/' + encodeURIComponent(request.indexName) + '?' +\n        request.params\n      );\n  }).join('&');\n\n  var url = '/1/indexes/*/queries';\n\n  if (opts.strategy !== undefined) {\n    url += '?strategy=' + opts.strategy;\n  }\n\n  return this._jsonRequest({\n    cache: this.cache,\n    method: 'POST',\n    url: url,\n    body: postObj,\n    hostType: 'read',\n    fallback: {\n      method: 'GET',\n      url: '/1/indexes/*',\n      body: {\n        params: JSONPParams\n      }\n    },\n    callback: callback\n  });\n};\n\n/**\n * Set the extra security tagFilters header\n * @param {string|array} tags The list of tags defining the current security filters\n */\nAlgoliaSearchCore.prototype.setSecurityTags = function(tags) {\n  if (Object.prototype.toString.call(tags) === '[object Array]') {\n    var strTags = [];\n    for (var i = 0; i < tags.length; ++i) {\n      if (Object.prototype.toString.call(tags[i]) === '[object Array]') {\n        var oredTags = [];\n        for (var j = 0; j < tags[i].length; ++j) {\n          oredTags.push(tags[i][j]);\n        }\n        strTags.push('(' + oredTags.join(',') + ')');\n      } else {\n        strTags.push(tags[i]);\n      }\n    }\n    tags = strTags.join(',');\n  }\n\n  this.securityTags = tags;\n};\n\n/**\n * Set the extra user token header\n * @param {string} userToken The token identifying a uniq user (used to apply rate limits)\n */\nAlgoliaSearchCore.prototype.setUserToken = function(userToken) {\n  this.userToken = userToken;\n};\n\n/**\n * Clear all queries in client's cache\n * @return undefined\n */\nAlgoliaSearchCore.prototype.clearCache = function() {\n  this.cache = {};\n};\n\n/**\n* Set the number of milliseconds a request can take before automatically being terminated.\n*\n* @param {Number} milliseconds\n*/\nAlgoliaSearchCore.prototype.setRequestTimeout = function(milliseconds) {\n  if (milliseconds) {\n    this.requestTimeout = parseInt(milliseconds, 10);\n  }\n};\n\nfunction prepareHost(protocol) {\n  return function prepare(host) {\n    return protocol + '//' + host.toLowerCase();\n  };\n}\n\n// Prototype.js < 1.7, a widely used library, defines a weird\n// Array.prototype.toJSON function that will fail to stringify our content\n// appropriately\n// refs:\n//   - https://groups.google.com/forum/#!topic/prototype-core/E-SAVvV_V9Q\n//   - https://github.com/sstephenson/prototype/commit/038a2985a70593c1a86c230fadbdfe2e4898a48c\n//   - http://stackoverflow.com/a/3148441/147079\nfunction safeJSONStringify(obj) {\n  /* eslint no-extend-native:0 */\n\n  if (Array.prototype.toJSON === undefined) {\n    return JSON.stringify(obj);\n  }\n\n  var toJSON = Array.prototype.toJSON;\n  delete Array.prototype.toJSON;\n  var out = JSON.stringify(obj);\n  Array.prototype.toJSON = toJSON;\n\n  return out;\n}\n\nfunction shuffle(array) {\n  var currentIndex = array.length;\n  var temporaryValue;\n  var randomIndex;\n\n  // While there remain elements to shuffle...\n  while (currentIndex !== 0) {\n    // Pick a remaining element...\n    randomIndex = Math.floor(Math.random() * currentIndex);\n    currentIndex -= 1;\n\n    // And swap it with the current element.\n    temporaryValue = array[currentIndex];\n    array[currentIndex] = array[randomIndex];\n    array[randomIndex] = temporaryValue;\n  }\n\n  return array;\n}\n\nfunction removeCredentials(headers) {\n  var newHeaders = {};\n\n  for (var headerName in headers) {\n    if (Object.prototype.hasOwnProperty.call(headers, headerName)) {\n      var value;\n\n      if (headerName === 'x-algolia-api-key' || headerName === 'x-algolia-application-id') {\n        value = '**hidden for security purposes**';\n      } else {\n        value = headers[headerName];\n      }\n\n      newHeaders[headerName] = value;\n    }\n  }\n\n  return newHeaders;\n}\n\n},{\"./IndexCore.js\":8,\"./clone.js\":15,\"./errors\":18,\"./exitPromise.js\":19,\"./map.js\":20,\"debug\":25,\"foreach\":29,\"isarray\":32}],6:[function(require,module,exports){\nvar inherits = require('inherits');\nvar IndexCore = require('./IndexCore.js');\nvar deprecate = require('./deprecate.js');\nvar deprecatedMessage = require('./deprecatedMessage.js');\nvar exitPromise = require('./exitPromise.js');\nvar errors = require('./errors');\n\nmodule.exports = Index;\n\nfunction Index() {\n  IndexCore.apply(this, arguments);\n}\n\ninherits(Index, IndexCore);\n\n/*\n* Add an object in this index\n*\n* @param content contains the javascript object to add inside the index\n* @param objectID (optional) an objectID you want to attribute to this object\n* (if the attribute already exist the old object will be overwrite)\n* @param callback (optional) the result callback called with two arguments:\n*  error: null or Error('message')\n*  content: the server answer that contains 3 elements: createAt, taskId and objectID\n*/\nIndex.prototype.addObject = function(content, objectID, callback) {\n  var indexObj = this;\n\n  if (arguments.length === 1 || typeof objectID === 'function') {\n    callback = objectID;\n    objectID = undefined;\n  }\n\n  return this.as._jsonRequest({\n    method: objectID !== undefined ?\n    'PUT' : // update or create\n    'POST', // create (API generates an objectID)\n    url: '/1/indexes/' + encodeURIComponent(indexObj.indexName) + // create\n    (objectID !== undefined ? '/' + encodeURIComponent(objectID) : ''), // update or create\n    body: content,\n    hostType: 'write',\n    callback: callback\n  });\n};\n\n/*\n* Add several objects\n*\n* @param objects contains an array of objects to add\n* @param callback (optional) the result callback called with two arguments:\n*  error: null or Error('message')\n*  content: the server answer that updateAt and taskID\n*/\nIndex.prototype.addObjects = function(objects, callback) {\n  var isArray = require('isarray');\n  var usage = 'Usage: index.addObjects(arrayOfObjects[, callback])';\n\n  if (!isArray(objects)) {\n    throw new Error(usage);\n  }\n\n  var indexObj = this;\n  var postObj = {\n    requests: []\n  };\n  for (var i = 0; i < objects.length; ++i) {\n    var request = {\n      action: 'addObject',\n      body: objects[i]\n    };\n    postObj.requests.push(request);\n  }\n  return this.as._jsonRequest({\n    method: 'POST',\n    url: '/1/indexes/' + encodeURIComponent(indexObj.indexName) + '/batch',\n    body: postObj,\n    hostType: 'write',\n    callback: callback\n  });\n};\n\n/*\n* Update partially an object (only update attributes passed in argument)\n*\n* @param partialObject contains the javascript attributes to override, the\n*  object must contains an objectID attribute\n* @param createIfNotExists (optional) if false, avoid an automatic creation of the object\n* @param callback (optional) the result callback called with two arguments:\n*  error: null or Error('message')\n*  content: the server answer that contains 3 elements: createAt, taskId and objectID\n*/\nIndex.prototype.partialUpdateObject = function(partialObject, createIfNotExists, callback) {\n  if (arguments.length === 1 || typeof createIfNotExists === 'function') {\n    callback = createIfNotExists;\n    createIfNotExists = undefined;\n  }\n\n  var indexObj = this;\n  var url = '/1/indexes/' + encodeURIComponent(indexObj.indexName) + '/' + encodeURIComponent(partialObject.objectID) + '/partial';\n  if (createIfNotExists === false) {\n    url += '?createIfNotExists=false';\n  }\n\n  return this.as._jsonRequest({\n    method: 'POST',\n    url: url,\n    body: partialObject,\n    hostType: 'write',\n    callback: callback\n  });\n};\n\n/*\n* Partially Override the content of several objects\n*\n* @param objects contains an array of objects to update (each object must contains a objectID attribute)\n* @param callback (optional) the result callback called with two arguments:\n*  error: null or Error('message')\n*  content: the server answer that updateAt and taskID\n*/\nIndex.prototype.partialUpdateObjects = function(objects, callback) {\n  var isArray = require('isarray');\n  var usage = 'Usage: index.partialUpdateObjects(arrayOfObjects[, callback])';\n\n  if (!isArray(objects)) {\n    throw new Error(usage);\n  }\n\n  var indexObj = this;\n  var postObj = {\n    requests: []\n  };\n  for (var i = 0; i < objects.length; ++i) {\n    var request = {\n      action: 'partialUpdateObject',\n      objectID: objects[i].objectID,\n      body: objects[i]\n    };\n    postObj.requests.push(request);\n  }\n  return this.as._jsonRequest({\n    method: 'POST',\n    url: '/1/indexes/' + encodeURIComponent(indexObj.indexName) + '/batch',\n    body: postObj,\n    hostType: 'write',\n    callback: callback\n  });\n};\n\n/*\n* Override the content of object\n*\n* @param object contains the javascript object to save, the object must contains an objectID attribute\n* @param callback (optional) the result callback called with two arguments:\n*  error: null or Error('message')\n*  content: the server answer that updateAt and taskID\n*/\nIndex.prototype.saveObject = function(object, callback) {\n  var indexObj = this;\n  return this.as._jsonRequest({\n    method: 'PUT',\n    url: '/1/indexes/' + encodeURIComponent(indexObj.indexName) + '/' + encodeURIComponent(object.objectID),\n    body: object,\n    hostType: 'write',\n    callback: callback\n  });\n};\n\n/*\n* Override the content of several objects\n*\n* @param objects contains an array of objects to update (each object must contains a objectID attribute)\n* @param callback (optional) the result callback called with two arguments:\n*  error: null or Error('message')\n*  content: the server answer that updateAt and taskID\n*/\nIndex.prototype.saveObjects = function(objects, callback) {\n  var isArray = require('isarray');\n  var usage = 'Usage: index.saveObjects(arrayOfObjects[, callback])';\n\n  if (!isArray(objects)) {\n    throw new Error(usage);\n  }\n\n  var indexObj = this;\n  var postObj = {\n    requests: []\n  };\n  for (var i = 0; i < objects.length; ++i) {\n    var request = {\n      action: 'updateObject',\n      objectID: objects[i].objectID,\n      body: objects[i]\n    };\n    postObj.requests.push(request);\n  }\n  return this.as._jsonRequest({\n    method: 'POST',\n    url: '/1/indexes/' + encodeURIComponent(indexObj.indexName) + '/batch',\n    body: postObj,\n    hostType: 'write',\n    callback: callback\n  });\n};\n\n/*\n* Delete an object from the index\n*\n* @param objectID the unique identifier of object to delete\n* @param callback (optional) the result callback called with two arguments:\n*  error: null or Error('message')\n*  content: the server answer that contains 3 elements: createAt, taskId and objectID\n*/\nIndex.prototype.deleteObject = function(objectID, callback) {\n  if (typeof objectID === 'function' || typeof objectID !== 'string' && typeof objectID !== 'number') {\n    var err = new errors.AlgoliaSearchError('Cannot delete an object without an objectID');\n    callback = objectID;\n    if (typeof callback === 'function') {\n      return callback(err);\n    }\n\n    return this.as._promise.reject(err);\n  }\n\n  var indexObj = this;\n  return this.as._jsonRequest({\n    method: 'DELETE',\n    url: '/1/indexes/' + encodeURIComponent(indexObj.indexName) + '/' + encodeURIComponent(objectID),\n    hostType: 'write',\n    callback: callback\n  });\n};\n\n/*\n* Delete several objects from an index\n*\n* @param objectIDs contains an array of objectID to delete\n* @param callback (optional) the result callback called with two arguments:\n*  error: null or Error('message')\n*  content: the server answer that contains 3 elements: createAt, taskId and objectID\n*/\nIndex.prototype.deleteObjects = function(objectIDs, callback) {\n  var isArray = require('isarray');\n  var map = require('./map.js');\n\n  var usage = 'Usage: index.deleteObjects(arrayOfObjectIDs[, callback])';\n\n  if (!isArray(objectIDs)) {\n    throw new Error(usage);\n  }\n\n  var indexObj = this;\n  var postObj = {\n    requests: map(objectIDs, function prepareRequest(objectID) {\n      return {\n        action: 'deleteObject',\n        objectID: objectID,\n        body: {\n          objectID: objectID\n        }\n      };\n    })\n  };\n\n  return this.as._jsonRequest({\n    method: 'POST',\n    url: '/1/indexes/' + encodeURIComponent(indexObj.indexName) + '/batch',\n    body: postObj,\n    hostType: 'write',\n    callback: callback\n  });\n};\n\n/*\n* Delete all objects matching a query\n*\n* @param query the query string\n* @param params the optional query parameters\n* @param callback (optional) the result callback called with one argument\n*  error: null or Error('message')\n*/\nIndex.prototype.deleteByQuery = function(query, params, callback) {\n  var clone = require('./clone.js');\n  var map = require('./map.js');\n\n  var indexObj = this;\n  var client = indexObj.as;\n\n  if (arguments.length === 1 || typeof params === 'function') {\n    callback = params;\n    params = {};\n  } else {\n    params = clone(params);\n  }\n\n  params.attributesToRetrieve = 'objectID';\n  params.hitsPerPage = 1000;\n  params.distinct = false;\n\n  // when deleting, we should never use cache to get the\n  // search results\n  this.clearCache();\n\n  // there's a problem in how we use the promise chain,\n  // see how waitTask is done\n  var promise = this\n  .search(query, params)\n  .then(stopOrDelete);\n\n  function stopOrDelete(searchContent) {\n    // stop here\n    if (searchContent.nbHits === 0) {\n      // return indexObj.as._request.resolve();\n      return searchContent;\n    }\n\n    // continue and do a recursive call\n    var objectIDs = map(searchContent.hits, function getObjectID(object) {\n      return object.objectID;\n    });\n\n    return indexObj\n    .deleteObjects(objectIDs)\n    .then(waitTask)\n    .then(doDeleteByQuery);\n  }\n\n  function waitTask(deleteObjectsContent) {\n    return indexObj.waitTask(deleteObjectsContent.taskID);\n  }\n\n  function doDeleteByQuery() {\n    return indexObj.deleteByQuery(query, params);\n  }\n\n  if (!callback) {\n    return promise;\n  }\n\n  promise.then(success, failure);\n\n  function success() {\n    exitPromise(function exit() {\n      callback(null);\n    }, client._setTimeout || setTimeout);\n  }\n\n  function failure(err) {\n    exitPromise(function exit() {\n      callback(err);\n    }, client._setTimeout || setTimeout);\n  }\n};\n\n/*\n* Browse all content from an index using events. Basically this will do\n* .browse() -> .browseFrom -> .browseFrom -> .. until all the results are returned\n*\n* @param {string} query - The full text query\n* @param {Object} [queryParameters] - Any search query parameter\n* @return {EventEmitter}\n* @example\n* var browser = index.browseAll('cool songs', {\n*   tagFilters: 'public,comments',\n*   hitsPerPage: 500\n* });\n*\n* browser.on('result', function resultCallback(content) {\n*   console.log(content.hits);\n* });\n*\n* // if any error occurs, you get it\n* browser.on('error', function(err) {\n*   throw err;\n* });\n*\n* // when you have browsed the whole index, you get this event\n* browser.on('end', function() {\n*   console.log('finished');\n* });\n*\n* // at any point if you want to stop the browsing process, you can stop it manually\n* // otherwise it will go on and on\n* browser.stop();\n*\n* @see {@link https://www.algolia.com/doc/rest_api#Browse|Algolia REST API Documentation}\n*/\nIndex.prototype.browseAll = function(query, queryParameters) {\n  if (typeof query === 'object') {\n    queryParameters = query;\n    query = undefined;\n  }\n\n  var merge = require('./merge.js');\n\n  var IndexBrowser = require('./IndexBrowser');\n\n  var browser = new IndexBrowser();\n  var client = this.as;\n  var index = this;\n  var params = client._getSearchParams(\n    merge({}, queryParameters || {}, {\n      query: query\n    }), ''\n  );\n\n  // start browsing\n  browseLoop();\n\n  function browseLoop(cursor) {\n    if (browser._stopped) {\n      return;\n    }\n\n    var queryString;\n\n    if (cursor !== undefined) {\n      queryString = 'cursor=' + encodeURIComponent(cursor);\n    } else {\n      queryString = params;\n    }\n\n    client._jsonRequest({\n      method: 'GET',\n      url: '/1/indexes/' + encodeURIComponent(index.indexName) + '/browse?' + queryString,\n      hostType: 'read',\n      callback: browseCallback\n    });\n  }\n\n  function browseCallback(err, content) {\n    if (browser._stopped) {\n      return;\n    }\n\n    if (err) {\n      browser._error(err);\n      return;\n    }\n\n    browser._result(content);\n\n    // no cursor means we are finished browsing\n    if (content.cursor === undefined) {\n      browser._end();\n      return;\n    }\n\n    browseLoop(content.cursor);\n  }\n\n  return browser;\n};\n\n/*\n* Get a Typeahead.js adapter\n* @param searchParams contains an object with query parameters (see search for details)\n*/\nIndex.prototype.ttAdapter = function(params) {\n  var self = this;\n  return function ttAdapter(query, syncCb, asyncCb) {\n    var cb;\n\n    if (typeof asyncCb === 'function') {\n      // typeahead 0.11\n      cb = asyncCb;\n    } else {\n      // pre typeahead 0.11\n      cb = syncCb;\n    }\n\n    self.search(query, params, function searchDone(err, content) {\n      if (err) {\n        cb(err);\n        return;\n      }\n\n      cb(content.hits);\n    });\n  };\n};\n\n/*\n* Wait the publication of a task on the server.\n* All server task are asynchronous and you can check with this method that the task is published.\n*\n* @param taskID the id of the task returned by server\n* @param callback the result callback with with two arguments:\n*  error: null or Error('message')\n*  content: the server answer that contains the list of results\n*/\nIndex.prototype.waitTask = function(taskID, callback) {\n  // wait minimum 100ms before retrying\n  var baseDelay = 100;\n  // wait maximum 5s before retrying\n  var maxDelay = 5000;\n  var loop = 0;\n\n  // waitTask() must be handled differently from other methods,\n  // it's a recursive method using a timeout\n  var indexObj = this;\n  var client = indexObj.as;\n\n  var promise = retryLoop();\n\n  function retryLoop() {\n    return client._jsonRequest({\n      method: 'GET',\n      hostType: 'read',\n      url: '/1/indexes/' + encodeURIComponent(indexObj.indexName) + '/task/' + taskID\n    }).then(function success(content) {\n      loop++;\n      var delay = baseDelay * loop * loop;\n      if (delay > maxDelay) {\n        delay = maxDelay;\n      }\n\n      if (content.status !== 'published') {\n        return client._promise.delay(delay).then(retryLoop);\n      }\n\n      return content;\n    });\n  }\n\n  if (!callback) {\n    return promise;\n  }\n\n  promise.then(successCb, failureCb);\n\n  function successCb(content) {\n    exitPromise(function exit() {\n      callback(null, content);\n    }, client._setTimeout || setTimeout);\n  }\n\n  function failureCb(err) {\n    exitPromise(function exit() {\n      callback(err);\n    }, client._setTimeout || setTimeout);\n  }\n};\n\n/*\n* This function deletes the index content. Settings and index specific API keys are kept untouched.\n*\n* @param callback (optional) the result callback called with two arguments\n*  error: null or Error('message')\n*  content: the settings object or the error message if a failure occured\n*/\nIndex.prototype.clearIndex = function(callback) {\n  var indexObj = this;\n  return this.as._jsonRequest({\n    method: 'POST',\n    url: '/1/indexes/' + encodeURIComponent(indexObj.indexName) + '/clear',\n    hostType: 'write',\n    callback: callback\n  });\n};\n\n/*\n* Get settings of this index\n*\n* @param callback (optional) the result callback called with two arguments\n*  error: null or Error('message')\n*  content: the settings object or the error message if a failure occured\n*/\nIndex.prototype.getSettings = function(callback) {\n  var indexObj = this;\n  return this.as._jsonRequest({\n    method: 'GET',\n    url: '/1/indexes/' + encodeURIComponent(indexObj.indexName) + '/settings?getVersion=2',\n    hostType: 'read',\n    callback: callback\n  });\n};\n\nIndex.prototype.searchSynonyms = function(params, callback) {\n  if (typeof params === 'function') {\n    callback = params;\n    params = {};\n  } else if (params === undefined) {\n    params = {};\n  }\n\n  return this.as._jsonRequest({\n    method: 'POST',\n    url: '/1/indexes/' + encodeURIComponent(this.indexName) + '/synonyms/search',\n    body: params,\n    hostType: 'read',\n    callback: callback\n  });\n};\n\nIndex.prototype.saveSynonym = function(synonym, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  } else if (opts === undefined) {\n    opts = {};\n  }\n\n  return this.as._jsonRequest({\n    method: 'PUT',\n    url: '/1/indexes/' + encodeURIComponent(this.indexName) + '/synonyms/' + encodeURIComponent(synonym.objectID) +\n      '?forwardToSlaves=' + (opts.forwardToSlaves ? 'true' : 'false'),\n    body: synonym,\n    hostType: 'write',\n    callback: callback\n  });\n};\n\nIndex.prototype.getSynonym = function(objectID, callback) {\n  return this.as._jsonRequest({\n    method: 'GET',\n    url: '/1/indexes/' + encodeURIComponent(this.indexName) + '/synonyms/' + encodeURIComponent(objectID),\n    hostType: 'read',\n    callback: callback\n  });\n};\n\nIndex.prototype.deleteSynonym = function(objectID, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  } else if (opts === undefined) {\n    opts = {};\n  }\n\n  return this.as._jsonRequest({\n    method: 'DELETE',\n    url: '/1/indexes/' + encodeURIComponent(this.indexName) + '/synonyms/' + encodeURIComponent(objectID) +\n      '?forwardToSlaves=' + (opts.forwardToSlaves ? 'true' : 'false'),\n    hostType: 'write',\n    callback: callback\n  });\n};\n\nIndex.prototype.clearSynonyms = function(opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  } else if (opts === undefined) {\n    opts = {};\n  }\n\n  return this.as._jsonRequest({\n    method: 'POST',\n    url: '/1/indexes/' + encodeURIComponent(this.indexName) + '/synonyms/clear' +\n      '?forwardToSlaves=' + (opts.forwardToSlaves ? 'true' : 'false'),\n    hostType: 'write',\n    callback: callback\n  });\n};\n\nIndex.prototype.batchSynonyms = function(synonyms, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  } else if (opts === undefined) {\n    opts = {};\n  }\n\n  return this.as._jsonRequest({\n    method: 'POST',\n    url: '/1/indexes/' + encodeURIComponent(this.indexName) + '/synonyms/batch' +\n      '?forwardToSlaves=' + (opts.forwardToSlaves ? 'true' : 'false') +\n      '&replaceExistingSynonyms=' + (opts.replaceExistingSynonyms ? 'true' : 'false'),\n    hostType: 'write',\n    body: synonyms,\n    callback: callback\n  });\n};\n\n/*\n* Set settings for this index\n*\n* @param settigns the settings object that can contains :\n* - minWordSizefor1Typo: (integer) the minimum number of characters to accept one typo (default = 3).\n* - minWordSizefor2Typos: (integer) the minimum number of characters to accept two typos (default = 7).\n* - hitsPerPage: (integer) the number of hits per page (default = 10).\n* - attributesToRetrieve: (array of strings) default list of attributes to retrieve in objects.\n*   If set to null, all attributes are retrieved.\n* - attributesToHighlight: (array of strings) default list of attributes to highlight.\n*   If set to null, all indexed attributes are highlighted.\n* - attributesToSnippet**: (array of strings) default list of attributes to snippet alongside the number\n* of words to return (syntax is attributeName:nbWords).\n*   By default no snippet is computed. If set to null, no snippet is computed.\n* - attributesToIndex: (array of strings) the list of fields you want to index.\n*   If set to null, all textual and numerical attributes of your objects are indexed,\n*   but you should update it to get optimal results.\n*   This parameter has two important uses:\n*     - Limit the attributes to index: For example if you store a binary image in base64,\n*     you want to store it and be able to\n*       retrieve it but you don't want to search in the base64 string.\n*     - Control part of the ranking*: (see the ranking parameter for full explanation)\n*     Matches in attributes at the beginning of\n*       the list will be considered more important than matches in attributes further down the list.\n*       In one attribute, matching text at the beginning of the attribute will be\n*       considered more important than text after, you can disable\n*       this behavior if you add your attribute inside `unordered(AttributeName)`,\n*       for example attributesToIndex: [\"title\", \"unordered(text)\"].\n* - attributesForFaceting: (array of strings) The list of fields you want to use for faceting.\n*   All strings in the attribute selected for faceting are extracted and added as a facet.\n*   If set to null, no attribute is used for faceting.\n* - attributeForDistinct: (string) The attribute name used for the Distinct feature.\n* This feature is similar to the SQL \"distinct\" keyword: when enabled\n*   in query with the distinct=1 parameter, all hits containing a duplicate\n*   value for this attribute are removed from results.\n*   For example, if the chosen attribute is show_name and several hits have\n*   the same value for show_name, then only the best one is kept and others are removed.\n* - ranking: (array of strings) controls the way results are sorted.\n*   We have six available criteria:\n*    - typo: sort according to number of typos,\n*    - geo: sort according to decreassing distance when performing a geo-location based search,\n*    - proximity: sort according to the proximity of query words in hits,\n*    - attribute: sort according to the order of attributes defined by attributesToIndex,\n*    - exact:\n*        - if the user query contains one word: sort objects having an attribute\n*        that is exactly the query word before others.\n*          For example if you search for the \"V\" TV show, you want to find it\n*          with the \"V\" query and avoid to have all popular TV\n*          show starting by the v letter before it.\n*        - if the user query contains multiple words: sort according to the\n*        number of words that matched exactly (and not as a prefix).\n*    - custom: sort according to a user defined formula set in **customRanking** attribute.\n*   The standard order is [\"typo\", \"geo\", \"proximity\", \"attribute\", \"exact\", \"custom\"]\n* - customRanking: (array of strings) lets you specify part of the ranking.\n*   The syntax of this condition is an array of strings containing attributes\n*   prefixed by asc (ascending order) or desc (descending order) operator.\n*   For example `\"customRanking\" => [\"desc(population)\", \"asc(name)\"]`\n* - queryType: Select how the query words are interpreted, it can be one of the following value:\n*   - prefixAll: all query words are interpreted as prefixes,\n*   - prefixLast: only the last word is interpreted as a prefix (default behavior),\n*   - prefixNone: no query word is interpreted as a prefix. This option is not recommended.\n* - highlightPreTag: (string) Specify the string that is inserted before\n* the highlighted parts in the query result (default to \"<em>\").\n* - highlightPostTag: (string) Specify the string that is inserted after\n* the highlighted parts in the query result (default to \"</em>\").\n* - optionalWords: (array of strings) Specify a list of words that should\n* be considered as optional when found in the query.\n* @param callback (optional) the result callback called with two arguments\n*  error: null or Error('message')\n*  content: the server answer or the error message if a failure occured\n*/\nIndex.prototype.setSettings = function(settings, opts, callback) {\n  if (arguments.length === 1 || typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var forwardToSlaves = opts.forwardToSlaves || false;\n\n  var indexObj = this;\n  return this.as._jsonRequest({\n    method: 'PUT',\n    url: '/1/indexes/' + encodeURIComponent(indexObj.indexName) + '/settings?forwardToSlaves='\n      + (forwardToSlaves ? 'true' : 'false'),\n    hostType: 'write',\n    body: settings,\n    callback: callback\n  });\n};\n\n/*\n* List all existing user keys associated to this index\n*\n* @param callback the result callback called with two arguments\n*  error: null or Error('message')\n*  content: the server answer with user keys list\n*/\nIndex.prototype.listUserKeys = function(callback) {\n  var indexObj = this;\n  return this.as._jsonRequest({\n    method: 'GET',\n    url: '/1/indexes/' + encodeURIComponent(indexObj.indexName) + '/keys',\n    hostType: 'read',\n    callback: callback\n  });\n};\n\n/*\n* Get ACL of a user key associated to this index\n*\n* @param key\n* @param callback the result callback called with two arguments\n*  error: null or Error('message')\n*  content: the server answer with user keys list\n*/\nIndex.prototype.getUserKeyACL = function(key, callback) {\n  var indexObj = this;\n  return this.as._jsonRequest({\n    method: 'GET',\n    url: '/1/indexes/' + encodeURIComponent(indexObj.indexName) + '/keys/' + key,\n    hostType: 'read',\n    callback: callback\n  });\n};\n\n/*\n* Delete an existing user key associated to this index\n*\n* @param key\n* @param callback the result callback called with two arguments\n*  error: null or Error('message')\n*  content: the server answer with user keys list\n*/\nIndex.prototype.deleteUserKey = function(key, callback) {\n  var indexObj = this;\n  return this.as._jsonRequest({\n    method: 'DELETE',\n    url: '/1/indexes/' + encodeURIComponent(indexObj.indexName) + '/keys/' + key,\n    hostType: 'write',\n    callback: callback\n  });\n};\n\n/*\n* Add a new API key to this index\n*\n* @param {string[]} acls - The list of ACL for this key. Defined by an array of strings that\n*   can contains the following values:\n*     - search: allow to search (https and http)\n*     - addObject: allows to add/update an object in the index (https only)\n*     - deleteObject : allows to delete an existing object (https only)\n*     - deleteIndex : allows to delete index content (https only)\n*     - settings : allows to get index settings (https only)\n*     - editSettings : allows to change index settings (https only)\n* @param {Object} [params] - Optionnal parameters to set for the key\n* @param {number} params.validity - Number of seconds after which the key will\n* be automatically removed (0 means no time limit for this key)\n* @param {number} params.maxQueriesPerIPPerHour - Number of API calls allowed from an IP address per hour\n* @param {number} params.maxHitsPerQuery - Number of hits this API key can retrieve in one call\n* @param {string} params.description - A description for your key\n* @param {string[]} params.referers - A list of authorized referers\n* @param {Object} params.queryParameters - Force the key to use specific query parameters\n* @param {Function} callback - The result callback called with two arguments\n*   error: null or Error('message')\n*   content: the server answer with user keys list\n* @return {Promise|undefined} Returns a promise if no callback given\n* @example\n* index.addUserKey(['search'], {\n*   validity: 300,\n*   maxQueriesPerIPPerHour: 2000,\n*   maxHitsPerQuery: 3,\n*   description: 'Eat three fruits',\n*   referers: ['*.algolia.com'],\n*   queryParameters: {\n*     tagFilters: ['public'],\n*   }\n* })\n* @see {@link https://www.algolia.com/doc/rest_api#AddIndexKey|Algolia REST API Documentation}\n*/\nIndex.prototype.addUserKey = function(acls, params, callback) {\n  var isArray = require('isarray');\n  var usage = 'Usage: index.addUserKey(arrayOfAcls[, params, callback])';\n\n  if (!isArray(acls)) {\n    throw new Error(usage);\n  }\n\n  if (arguments.length === 1 || typeof params === 'function') {\n    callback = params;\n    params = null;\n  }\n\n  var postObj = {\n    acl: acls\n  };\n\n  if (params) {\n    postObj.validity = params.validity;\n    postObj.maxQueriesPerIPPerHour = params.maxQueriesPerIPPerHour;\n    postObj.maxHitsPerQuery = params.maxHitsPerQuery;\n    postObj.description = params.description;\n\n    if (params.queryParameters) {\n      postObj.queryParameters = this.as._getSearchParams(params.queryParameters, '');\n    }\n\n    postObj.referers = params.referers;\n  }\n\n  return this.as._jsonRequest({\n    method: 'POST',\n    url: '/1/indexes/' + encodeURIComponent(this.indexName) + '/keys',\n    body: postObj,\n    hostType: 'write',\n    callback: callback\n  });\n};\n\n/**\n* Add an existing user key associated to this index\n* @deprecated use index.addUserKey()\n*/\nIndex.prototype.addUserKeyWithValidity = deprecate(function deprecatedAddUserKeyWithValidity(acls, params, callback) {\n  return this.addUserKey(acls, params, callback);\n}, deprecatedMessage('index.addUserKeyWithValidity()', 'index.addUserKey()'));\n\n/**\n* Update an existing API key of this index\n* @param {string} key - The key to update\n* @param {string[]} acls - The list of ACL for this key. Defined by an array of strings that\n*   can contains the following values:\n*     - search: allow to search (https and http)\n*     - addObject: allows to add/update an object in the index (https only)\n*     - deleteObject : allows to delete an existing object (https only)\n*     - deleteIndex : allows to delete index content (https only)\n*     - settings : allows to get index settings (https only)\n*     - editSettings : allows to change index settings (https only)\n* @param {Object} [params] - Optionnal parameters to set for the key\n* @param {number} params.validity - Number of seconds after which the key will\n* be automatically removed (0 means no time limit for this key)\n* @param {number} params.maxQueriesPerIPPerHour - Number of API calls allowed from an IP address per hour\n* @param {number} params.maxHitsPerQuery - Number of hits this API key can retrieve in one call\n* @param {string} params.description - A description for your key\n* @param {string[]} params.referers - A list of authorized referers\n* @param {Object} params.queryParameters - Force the key to use specific query parameters\n* @param {Function} callback - The result callback called with two arguments\n*   error: null or Error('message')\n*   content: the server answer with user keys list\n* @return {Promise|undefined} Returns a promise if no callback given\n* @example\n* index.updateUserKey('APIKEY', ['search'], {\n*   validity: 300,\n*   maxQueriesPerIPPerHour: 2000,\n*   maxHitsPerQuery: 3,\n*   description: 'Eat three fruits',\n*   referers: ['*.algolia.com'],\n*   queryParameters: {\n*     tagFilters: ['public'],\n*   }\n* })\n* @see {@link https://www.algolia.com/doc/rest_api#UpdateIndexKey|Algolia REST API Documentation}\n*/\nIndex.prototype.updateUserKey = function(key, acls, params, callback) {\n  var isArray = require('isarray');\n  var usage = 'Usage: index.updateUserKey(key, arrayOfAcls[, params, callback])';\n\n  if (!isArray(acls)) {\n    throw new Error(usage);\n  }\n\n  if (arguments.length === 2 || typeof params === 'function') {\n    callback = params;\n    params = null;\n  }\n\n  var putObj = {\n    acl: acls\n  };\n\n  if (params) {\n    putObj.validity = params.validity;\n    putObj.maxQueriesPerIPPerHour = params.maxQueriesPerIPPerHour;\n    putObj.maxHitsPerQuery = params.maxHitsPerQuery;\n    putObj.description = params.description;\n\n    if (params.queryParameters) {\n      putObj.queryParameters = this.as._getSearchParams(params.queryParameters, '');\n    }\n\n    putObj.referers = params.referers;\n  }\n\n  return this.as._jsonRequest({\n    method: 'PUT',\n    url: '/1/indexes/' + encodeURIComponent(this.indexName) + '/keys/' + key,\n    body: putObj,\n    hostType: 'write',\n    callback: callback\n  });\n};\n\n},{\"./IndexBrowser\":7,\"./IndexCore.js\":8,\"./clone.js\":15,\"./deprecate.js\":16,\"./deprecatedMessage.js\":17,\"./errors\":18,\"./exitPromise.js\":19,\"./map.js\":20,\"./merge.js\":21,\"inherits\":31,\"isarray\":32}],7:[function(require,module,exports){\n'use strict';\n\n// This is the object returned by the `index.browseAll()` method\n\nmodule.exports = IndexBrowser;\n\nvar inherits = require('inherits');\nvar EventEmitter = require('events').EventEmitter;\n\nfunction IndexBrowser() {\n}\n\ninherits(IndexBrowser, EventEmitter);\n\nIndexBrowser.prototype.stop = function() {\n  this._stopped = true;\n  this._clean();\n};\n\nIndexBrowser.prototype._end = function() {\n  this.emit('end');\n  this._clean();\n};\n\nIndexBrowser.prototype._error = function(err) {\n  this.emit('error', err);\n  this._clean();\n};\n\nIndexBrowser.prototype._result = function(content) {\n  this.emit('result', content);\n};\n\nIndexBrowser.prototype._clean = function() {\n  this.removeAllListeners('stop');\n  this.removeAllListeners('end');\n  this.removeAllListeners('error');\n  this.removeAllListeners('result');\n};\n\n},{\"events\":28,\"inherits\":31}],8:[function(require,module,exports){\nvar buildSearchMethod = require('./buildSearchMethod.js');\n\nmodule.exports = IndexCore;\n\n/*\n* Index class constructor.\n* You should not use this method directly but use initIndex() function\n*/\nfunction IndexCore(algoliasearch, indexName) {\n  this.indexName = indexName;\n  this.as = algoliasearch;\n  this.typeAheadArgs = null;\n  this.typeAheadValueOption = null;\n\n  // make sure every index instance has it's own cache\n  this.cache = {};\n}\n\n/*\n* Clear all queries in cache\n*/\nIndexCore.prototype.clearCache = function() {\n  this.cache = {};\n};\n\n/*\n* Search inside the index using XMLHttpRequest request (Using a POST query to\n* minimize number of OPTIONS queries: Cross-Origin Resource Sharing).\n*\n* @param query the full text query\n* @param args (optional) if set, contains an object with query parameters:\n* - page: (integer) Pagination parameter used to select the page to retrieve.\n*                   Page is zero-based and defaults to 0. Thus,\n*                   to retrieve the 10th page you need to set page=9\n* - hitsPerPage: (integer) Pagination parameter used to select the number of hits per page. Defaults to 20.\n* - attributesToRetrieve: a string that contains the list of object attributes\n* you want to retrieve (let you minimize the answer size).\n*   Attributes are separated with a comma (for example \"name,address\").\n*   You can also use an array (for example [\"name\",\"address\"]).\n*   By default, all attributes are retrieved. You can also use '*' to retrieve all\n*   values when an attributesToRetrieve setting is specified for your index.\n* - attributesToHighlight: a string that contains the list of attributes you\n*   want to highlight according to the query.\n*   Attributes are separated by a comma. You can also use an array (for example [\"name\",\"address\"]).\n*   If an attribute has no match for the query, the raw value is returned.\n*   By default all indexed text attributes are highlighted.\n*   You can use `*` if you want to highlight all textual attributes.\n*   Numerical attributes are not highlighted.\n*   A matchLevel is returned for each highlighted attribute and can contain:\n*      - full: if all the query terms were found in the attribute,\n*      - partial: if only some of the query terms were found,\n*      - none: if none of the query terms were found.\n* - attributesToSnippet: a string that contains the list of attributes to snippet alongside\n* the number of words to return (syntax is `attributeName:nbWords`).\n*    Attributes are separated by a comma (Example: attributesToSnippet=name:10,content:10).\n*    You can also use an array (Example: attributesToSnippet: ['name:10','content:10']).\n*    By default no snippet is computed.\n* - minWordSizefor1Typo: the minimum number of characters in a query word to accept one typo in this word.\n* Defaults to 3.\n* - minWordSizefor2Typos: the minimum number of characters in a query word\n* to accept two typos in this word. Defaults to 7.\n* - getRankingInfo: if set to 1, the result hits will contain ranking\n* information in _rankingInfo attribute.\n* - aroundLatLng: search for entries around a given\n* latitude/longitude (specified as two floats separated by a comma).\n*   For example aroundLatLng=47.316669,5.016670).\n*   You can specify the maximum distance in meters with the aroundRadius parameter (in meters)\n*   and the precision for ranking with aroundPrecision\n*   (for example if you set aroundPrecision=100, two objects that are distant of\n*   less than 100m will be considered as identical for \"geo\" ranking parameter).\n*   At indexing, you should specify geoloc of an object with the _geoloc attribute\n*   (in the form {\"_geoloc\":{\"lat\":48.853409, \"lng\":2.348800}})\n* - insideBoundingBox: search entries inside a given area defined by the two extreme points\n* of a rectangle (defined by 4 floats: p1Lat,p1Lng,p2Lat,p2Lng).\n*   For example insideBoundingBox=47.3165,4.9665,47.3424,5.0201).\n*   At indexing, you should specify geoloc of an object with the _geoloc attribute\n*   (in the form {\"_geoloc\":{\"lat\":48.853409, \"lng\":2.348800}})\n* - numericFilters: a string that contains the list of numeric filters you want to\n* apply separated by a comma.\n*   The syntax of one filter is `attributeName` followed by `operand` followed by `value`.\n*   Supported operands are `<`, `<=`, `=`, `>` and `>=`.\n*   You can have multiple conditions on one attribute like for example numericFilters=price>100,price<1000.\n*   You can also use an array (for example numericFilters: [\"price>100\",\"price<1000\"]).\n* - tagFilters: filter the query by a set of tags. You can AND tags by separating them by commas.\n*   To OR tags, you must add parentheses. For example, tags=tag1,(tag2,tag3) means tag1 AND (tag2 OR tag3).\n*   You can also use an array, for example tagFilters: [\"tag1\",[\"tag2\",\"tag3\"]]\n*   means tag1 AND (tag2 OR tag3).\n*   At indexing, tags should be added in the _tags** attribute\n*   of objects (for example {\"_tags\":[\"tag1\",\"tag2\"]}).\n* - facetFilters: filter the query by a list of facets.\n*   Facets are separated by commas and each facet is encoded as `attributeName:value`.\n*   For example: `facetFilters=category:Book,author:John%20Doe`.\n*   You can also use an array (for example `[\"category:Book\",\"author:John%20Doe\"]`).\n* - facets: List of object attributes that you want to use for faceting.\n*   Comma separated list: `\"category,author\"` or array `['category','author']`\n*   Only attributes that have been added in **attributesForFaceting** index setting\n*   can be used in this parameter.\n*   You can also use `*` to perform faceting on all attributes specified in **attributesForFaceting**.\n* - queryType: select how the query words are interpreted, it can be one of the following value:\n*    - prefixAll: all query words are interpreted as prefixes,\n*    - prefixLast: only the last word is interpreted as a prefix (default behavior),\n*    - prefixNone: no query word is interpreted as a prefix. This option is not recommended.\n* - optionalWords: a string that contains the list of words that should\n* be considered as optional when found in the query.\n*   Comma separated and array are accepted.\n* - distinct: If set to 1, enable the distinct feature (disabled by default)\n* if the attributeForDistinct index setting is set.\n*   This feature is similar to the SQL \"distinct\" keyword: when enabled\n*   in a query with the distinct=1 parameter,\n*   all hits containing a duplicate value for the attributeForDistinct attribute are removed from results.\n*   For example, if the chosen attribute is show_name and several hits have\n*   the same value for show_name, then only the best\n*   one is kept and others are removed.\n* - restrictSearchableAttributes: List of attributes you want to use for\n* textual search (must be a subset of the attributesToIndex index setting)\n* either comma separated or as an array\n* @param callback the result callback called with two arguments:\n*  error: null or Error('message'). If false, the content contains the error.\n*  content: the server answer that contains the list of results.\n*/\nIndexCore.prototype.search = buildSearchMethod('query');\n\n/*\n* -- BETA --\n* Search a record similar to the query inside the index using XMLHttpRequest request (Using a POST query to\n* minimize number of OPTIONS queries: Cross-Origin Resource Sharing).\n*\n* @param query the similar query\n* @param args (optional) if set, contains an object with query parameters.\n*   All search parameters are supported (see search function), restrictSearchableAttributes and facetFilters\n*   are the two most useful to restrict the similar results and get more relevant content\n*/\nIndexCore.prototype.similarSearch = buildSearchMethod('similarQuery');\n\n/*\n* Browse index content. The response content will have a `cursor` property that you can use\n* to browse subsequent pages for this query. Use `index.browseFrom(cursor)` when you want.\n*\n* @param {string} query - The full text query\n* @param {Object} [queryParameters] - Any search query parameter\n* @param {Function} [callback] - The result callback called with two arguments\n*   error: null or Error('message')\n*   content: the server answer with the browse result\n* @return {Promise|undefined} Returns a promise if no callback given\n* @example\n* index.browse('cool songs', {\n*   tagFilters: 'public,comments',\n*   hitsPerPage: 500\n* }, callback);\n* @see {@link https://www.algolia.com/doc/rest_api#Browse|Algolia REST API Documentation}\n*/\nIndexCore.prototype.browse = function(query, queryParameters, callback) {\n  var merge = require('./merge.js');\n\n  var indexObj = this;\n\n  var page;\n  var hitsPerPage;\n\n  // we check variadic calls that are not the one defined\n  // .browse()/.browse(fn)\n  // => page = 0\n  if (arguments.length === 0 || arguments.length === 1 && typeof arguments[0] === 'function') {\n    page = 0;\n    callback = arguments[0];\n    query = undefined;\n  } else if (typeof arguments[0] === 'number') {\n    // .browse(2)/.browse(2, 10)/.browse(2, fn)/.browse(2, 10, fn)\n    page = arguments[0];\n    if (typeof arguments[1] === 'number') {\n      hitsPerPage = arguments[1];\n    } else if (typeof arguments[1] === 'function') {\n      callback = arguments[1];\n      hitsPerPage = undefined;\n    }\n    query = undefined;\n    queryParameters = undefined;\n  } else if (typeof arguments[0] === 'object') {\n    // .browse(queryParameters)/.browse(queryParameters, cb)\n    if (typeof arguments[1] === 'function') {\n      callback = arguments[1];\n    }\n    queryParameters = arguments[0];\n    query = undefined;\n  } else if (typeof arguments[0] === 'string' && typeof arguments[1] === 'function') {\n    // .browse(query, cb)\n    callback = arguments[1];\n    queryParameters = undefined;\n  }\n\n  // otherwise it's a .browse(query)/.browse(query, queryParameters)/.browse(query, queryParameters, cb)\n\n  // get search query parameters combining various possible calls\n  // to .browse();\n  queryParameters = merge({}, queryParameters || {}, {\n    page: page,\n    hitsPerPage: hitsPerPage,\n    query: query\n  });\n\n  var params = this.as._getSearchParams(queryParameters, '');\n\n  return this.as._jsonRequest({\n    method: 'GET',\n    url: '/1/indexes/' + encodeURIComponent(indexObj.indexName) + '/browse?' + params,\n    hostType: 'read',\n    callback: callback\n  });\n};\n\n/*\n* Continue browsing from a previous position (cursor), obtained via a call to `.browse()`.\n*\n* @param {string} query - The full text query\n* @param {Object} [queryParameters] - Any search query parameter\n* @param {Function} [callback] - The result callback called with two arguments\n*   error: null or Error('message')\n*   content: the server answer with the browse result\n* @return {Promise|undefined} Returns a promise if no callback given\n* @example\n* index.browseFrom('14lkfsakl32', callback);\n* @see {@link https://www.algolia.com/doc/rest_api#Browse|Algolia REST API Documentation}\n*/\nIndexCore.prototype.browseFrom = function(cursor, callback) {\n  return this.as._jsonRequest({\n    method: 'GET',\n    url: '/1/indexes/' + encodeURIComponent(this.indexName) + '/browse?cursor=' + encodeURIComponent(cursor),\n    hostType: 'read',\n    callback: callback\n  });\n};\n\nIndexCore.prototype._search = function(params, url, callback) {\n  return this.as._jsonRequest({\n    cache: this.cache,\n    method: 'POST',\n    url: url || '/1/indexes/' + encodeURIComponent(this.indexName) + '/query',\n    body: {params: params},\n    hostType: 'read',\n    fallback: {\n      method: 'GET',\n      url: '/1/indexes/' + encodeURIComponent(this.indexName),\n      body: {params: params}\n    },\n    callback: callback\n  });\n};\n\n/*\n* Get an object from this index\n*\n* @param objectID the unique identifier of the object to retrieve\n* @param attrs (optional) if set, contains the array of attribute names to retrieve\n* @param callback (optional) the result callback called with two arguments\n*  error: null or Error('message')\n*  content: the object to retrieve or the error message if a failure occured\n*/\nIndexCore.prototype.getObject = function(objectID, attrs, callback) {\n  var indexObj = this;\n\n  if (arguments.length === 1 || typeof attrs === 'function') {\n    callback = attrs;\n    attrs = undefined;\n  }\n\n  var params = '';\n  if (attrs !== undefined) {\n    params = '?attributes=';\n    for (var i = 0; i < attrs.length; ++i) {\n      if (i !== 0) {\n        params += ',';\n      }\n      params += attrs[i];\n    }\n  }\n\n  return this.as._jsonRequest({\n    method: 'GET',\n    url: '/1/indexes/' + encodeURIComponent(indexObj.indexName) + '/' + encodeURIComponent(objectID) + params,\n    hostType: 'read',\n    callback: callback\n  });\n};\n\n/*\n* Get several objects from this index\n*\n* @param objectIDs the array of unique identifier of objects to retrieve\n*/\nIndexCore.prototype.getObjects = function(objectIDs, attributesToRetrieve, callback) {\n  var isArray = require('isarray');\n  var map = require('./map.js');\n\n  var usage = 'Usage: index.getObjects(arrayOfObjectIDs[, callback])';\n\n  if (!isArray(objectIDs)) {\n    throw new Error(usage);\n  }\n\n  var indexObj = this;\n\n  if (arguments.length === 1 || typeof attributesToRetrieve === 'function') {\n    callback = attributesToRetrieve;\n    attributesToRetrieve = undefined;\n  }\n\n  var body = {\n    requests: map(objectIDs, function prepareRequest(objectID) {\n      var request = {\n        indexName: indexObj.indexName,\n        objectID: objectID\n      };\n\n      if (attributesToRetrieve) {\n        request.attributesToRetrieve = attributesToRetrieve.join(',');\n      }\n\n      return request;\n    })\n  };\n\n  return this.as._jsonRequest({\n    method: 'POST',\n    url: '/1/indexes/*/objects',\n    hostType: 'read',\n    body: body,\n    callback: callback\n  });\n};\n\nIndexCore.prototype.as = null;\nIndexCore.prototype.indexName = null;\nIndexCore.prototype.typeAheadArgs = null;\nIndexCore.prototype.typeAheadValueOption = null;\n\n},{\"./buildSearchMethod.js\":14,\"./map.js\":20,\"./merge.js\":21,\"isarray\":32}],9:[function(require,module,exports){\n'use strict';\n\nvar AlgoliaSearch = require('../../AlgoliaSearch.js');\nvar createAlgoliasearch = require('../createAlgoliasearch.js');\n\nmodule.exports = createAlgoliasearch(AlgoliaSearch);\n\n},{\"../../AlgoliaSearch.js\":4,\"../createAlgoliasearch.js\":10}],10:[function(require,module,exports){\n(function (process){\n'use strict';\n\nvar global = require('global');\nvar Promise = global.Promise || require('es6-promise').Promise;\n\n// This is the standalone browser build entry point\n// Browser implementation of the Algolia Search JavaScript client,\n// using XMLHttpRequest, XDomainRequest and JSONP as fallback\nmodule.exports = function createAlgoliasearch(AlgoliaSearch, uaSuffix) {\n  var inherits = require('inherits');\n  var errors = require('../errors');\n  var inlineHeaders = require('./inline-headers');\n  var jsonpRequest = require('./jsonp-request');\n  var places = require('../places.js');\n  uaSuffix = uaSuffix || '';\n\n  if (process.env.NODE_ENV === 'debug') {\n    require('debug').enable('algoliasearch*');\n  }\n\n  function algoliasearch(applicationID, apiKey, opts) {\n    var cloneDeep = require('../clone.js');\n\n    var getDocumentProtocol = require('./get-document-protocol');\n\n    opts = cloneDeep(opts || {});\n\n    if (opts.protocol === undefined) {\n      opts.protocol = getDocumentProtocol();\n    }\n\n    opts._ua = opts._ua || algoliasearch.ua;\n\n    return new AlgoliaSearchBrowser(applicationID, apiKey, opts);\n  }\n\n  algoliasearch.version = require('../version.js');\n  algoliasearch.ua = 'Algolia for vanilla JavaScript ' + uaSuffix + algoliasearch.version;\n  algoliasearch.initPlaces = places(algoliasearch);\n\n  // we expose into window no matter how we are used, this will allow\n  // us to easily debug any website running algolia\n  global.__algolia = {\n    debug: require('debug'),\n    algoliasearch: algoliasearch\n  };\n\n  var support = {\n    hasXMLHttpRequest: 'XMLHttpRequest' in global,\n    hasXDomainRequest: 'XDomainRequest' in global\n  };\n\n  if (support.hasXMLHttpRequest) {\n    support.cors = 'withCredentials' in new XMLHttpRequest();\n    support.timeout = 'timeout' in new XMLHttpRequest();\n  }\n\n  function AlgoliaSearchBrowser() {\n    // call AlgoliaSearch constructor\n    AlgoliaSearch.apply(this, arguments);\n  }\n\n  inherits(AlgoliaSearchBrowser, AlgoliaSearch);\n\n  AlgoliaSearchBrowser.prototype._request = function request(url, opts) {\n    return new Promise(function wrapRequest(resolve, reject) {\n      // no cors or XDomainRequest, no request\n      if (!support.cors && !support.hasXDomainRequest) {\n        // very old browser, not supported\n        reject(new errors.Network('CORS not supported'));\n        return;\n      }\n\n      url = inlineHeaders(url, opts.headers);\n\n      var body = opts.body;\n      var req = support.cors ? new XMLHttpRequest() : new XDomainRequest();\n      var ontimeout;\n      var timedOut;\n\n      // do not rely on default XHR async flag, as some analytics code like hotjar\n      // breaks it and set it to false by default\n      if (req instanceof XMLHttpRequest) {\n        req.open(opts.method, url, true);\n      } else {\n        req.open(opts.method, url);\n      }\n\n      if (support.cors) {\n        if (body) {\n          if (opts.method === 'POST') {\n            // https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS#Simple_requests\n            req.setRequestHeader('content-type', 'application/x-www-form-urlencoded');\n          } else {\n            req.setRequestHeader('content-type', 'application/json');\n          }\n        }\n        req.setRequestHeader('accept', 'application/json');\n      }\n\n      // we set an empty onprogress listener\n      // so that XDomainRequest on IE9 is not aborted\n      // refs:\n      //  - https://github.com/algolia/algoliasearch-client-js/issues/76\n      //  - https://social.msdn.microsoft.com/Forums/ie/en-US/30ef3add-767c-4436-b8a9-f1ca19b4812e/ie9-rtm-xdomainrequest-issued-requests-may-abort-if-all-event-handlers-not-specified?forum=iewebdevelopment\n      req.onprogress = function noop() {};\n\n      req.onload = load;\n      req.onerror = error;\n\n      if (support.timeout) {\n        // .timeout supported by both XHR and XDR,\n        // we do receive timeout event, tested\n        req.timeout = opts.timeout;\n\n        req.ontimeout = timeout;\n      } else {\n        ontimeout = setTimeout(timeout, opts.timeout);\n      }\n\n      req.send(body);\n\n      // event object not received in IE8, at least\n      // but we do not use it, still important to note\n      function load(/* event */) {\n        // When browser does not supports req.timeout, we can\n        // have both a load and timeout event, since handled by a dumb setTimeout\n        if (timedOut) {\n          return;\n        }\n\n        if (!support.timeout) {\n          clearTimeout(ontimeout);\n        }\n\n        var out;\n\n        try {\n          out = {\n            body: JSON.parse(req.responseText),\n            responseText: req.responseText,\n            statusCode: req.status,\n            // XDomainRequest does not have any response headers\n            headers: req.getAllResponseHeaders && req.getAllResponseHeaders() || {}\n          };\n        } catch (e) {\n          out = new errors.UnparsableJSON({\n            more: req.responseText\n          });\n        }\n\n        if (out instanceof errors.UnparsableJSON) {\n          reject(out);\n        } else {\n          resolve(out);\n        }\n      }\n\n      function error(event) {\n        if (timedOut) {\n          return;\n        }\n\n        if (!support.timeout) {\n          clearTimeout(ontimeout);\n        }\n\n        // error event is trigerred both with XDR/XHR on:\n        //   - DNS error\n        //   - unallowed cross domain request\n        reject(\n          new errors.Network({\n            more: event\n          })\n        );\n      }\n\n      function timeout() {\n        if (!support.timeout) {\n          timedOut = true;\n          req.abort();\n        }\n\n        reject(new errors.RequestTimeout());\n      }\n    });\n  };\n\n  AlgoliaSearchBrowser.prototype._request.fallback = function requestFallback(url, opts) {\n    url = inlineHeaders(url, opts.headers);\n\n    return new Promise(function wrapJsonpRequest(resolve, reject) {\n      jsonpRequest(url, opts, function jsonpRequestDone(err, content) {\n        if (err) {\n          reject(err);\n          return;\n        }\n\n        resolve(content);\n      });\n    });\n  };\n\n  AlgoliaSearchBrowser.prototype._promise = {\n    reject: function rejectPromise(val) {\n      return Promise.reject(val);\n    },\n    resolve: function resolvePromise(val) {\n      return Promise.resolve(val);\n    },\n    delay: function delayPromise(ms) {\n      return new Promise(function resolveOnTimeout(resolve/* , reject*/) {\n        setTimeout(resolve, ms);\n      });\n    }\n  };\n\n  return algoliasearch;\n};\n\n}).call(this,require('_process'))\n},{\"../clone.js\":15,\"../errors\":18,\"../places.js\":22,\"../version.js\":23,\"./get-document-protocol\":11,\"./inline-headers\":12,\"./jsonp-request\":13,\"_process\":24,\"debug\":25,\"es6-promise\":27,\"global\":30,\"inherits\":31}],11:[function(require,module,exports){\n'use strict';\n\nmodule.exports = getDocumentProtocol;\n\nfunction getDocumentProtocol() {\n  var protocol = window.document.location.protocol;\n\n  // when in `file:` mode (local html file), default to `http:`\n  if (protocol !== 'http:' && protocol !== 'https:') {\n    protocol = 'http:';\n  }\n\n  return protocol;\n}\n\n},{}],12:[function(require,module,exports){\n'use strict';\n\nmodule.exports = inlineHeaders;\n\nvar encode = require('querystring-es3/encode');\n\nfunction inlineHeaders(url, headers) {\n  if (/\\?/.test(url)) {\n    url += '&';\n  } else {\n    url += '?';\n  }\n\n  return url + encode(headers);\n}\n\n},{\"querystring-es3/encode\":34}],13:[function(require,module,exports){\n'use strict';\n\nmodule.exports = jsonpRequest;\n\nvar errors = require('../errors');\n\nvar JSONPCounter = 0;\n\nfunction jsonpRequest(url, opts, cb) {\n  if (opts.method !== 'GET') {\n    cb(new Error('Method ' + opts.method + ' ' + url + ' is not supported by JSONP.'));\n    return;\n  }\n\n  opts.debug('JSONP: start');\n\n  var cbCalled = false;\n  var timedOut = false;\n\n  JSONPCounter += 1;\n  var head = document.getElementsByTagName('head')[0];\n  var script = document.createElement('script');\n  var cbName = 'algoliaJSONP_' + JSONPCounter;\n  var done = false;\n\n  window[cbName] = function(data) {\n    removeGlobals();\n\n    if (timedOut) {\n      opts.debug('JSONP: Late answer, ignoring');\n      return;\n    }\n\n    cbCalled = true;\n\n    clean();\n\n    cb(null, {\n      body: data/* ,\n      // We do not send the statusCode, there's no statusCode in JSONP, it will be\n      // computed using data.status && data.message like with XDR\n      statusCode*/\n    });\n  };\n\n  // add callback by hand\n  url += '&callback=' + cbName;\n\n  // add body params manually\n  if (opts.jsonBody && opts.jsonBody.params) {\n    url += '&' + opts.jsonBody.params;\n  }\n\n  var ontimeout = setTimeout(timeout, opts.timeout);\n\n  // script onreadystatechange needed only for\n  // <= IE8\n  // https://github.com/angular/angular.js/issues/4523\n  script.onreadystatechange = readystatechange;\n  script.onload = success;\n  script.onerror = error;\n\n  script.async = true;\n  script.defer = true;\n  script.src = url;\n  head.appendChild(script);\n\n  function success() {\n    opts.debug('JSONP: success');\n\n    if (done || timedOut) {\n      return;\n    }\n\n    done = true;\n\n    // script loaded but did not call the fn => script loading error\n    if (!cbCalled) {\n      opts.debug('JSONP: Fail. Script loaded but did not call the callback');\n      clean();\n      cb(new errors.JSONPScriptFail());\n    }\n  }\n\n  function readystatechange() {\n    if (this.readyState === 'loaded' || this.readyState === 'complete') {\n      success();\n    }\n  }\n\n  function clean() {\n    clearTimeout(ontimeout);\n    script.onload = null;\n    script.onreadystatechange = null;\n    script.onerror = null;\n    head.removeChild(script);\n  }\n\n  function removeGlobals() {\n    try {\n      delete window[cbName];\n      delete window[cbName + '_loaded'];\n    } catch (e) {\n      window[cbName] = window[cbName + '_loaded'] = undefined;\n    }\n  }\n\n  function timeout() {\n    opts.debug('JSONP: Script timeout');\n    timedOut = true;\n    clean();\n    cb(new errors.RequestTimeout());\n  }\n\n  function error() {\n    opts.debug('JSONP: Script error');\n\n    if (done || timedOut) {\n      return;\n    }\n\n    clean();\n    cb(new errors.JSONPScriptError());\n  }\n}\n\n},{\"../errors\":18}],14:[function(require,module,exports){\nmodule.exports = buildSearchMethod;\n\nvar errors = require('./errors.js');\n\nfunction buildSearchMethod(queryParam, url) {\n  return function search(query, args, callback) {\n    // warn V2 users on how to search\n    if (typeof query === 'function' && typeof args === 'object' ||\n      typeof callback === 'object') {\n      // .search(query, params, cb)\n      // .search(cb, params)\n      throw new errors.AlgoliaSearchError('index.search usage is index.search(query, params, cb)');\n    }\n\n    if (arguments.length === 0 || typeof query === 'function') {\n      // .search(), .search(cb)\n      callback = query;\n      query = '';\n    } else if (arguments.length === 1 || typeof args === 'function') {\n      // .search(query/args), .search(query, cb)\n      callback = args;\n      args = undefined;\n    }\n\n    // .search(args), careful: typeof null === 'object'\n    if (typeof query === 'object' && query !== null) {\n      args = query;\n      query = undefined;\n    } else if (query === undefined || query === null) { // .search(undefined/null)\n      query = '';\n    }\n\n    var params = '';\n\n    if (query !== undefined) {\n      params += queryParam + '=' + encodeURIComponent(query);\n    }\n\n    if (args !== undefined) {\n      // `_getSearchParams` will augment params, do not be fooled by the = versus += from previous if\n      params = this.as._getSearchParams(args, params);\n    }\n\n    return this._search(params, url, callback);\n  };\n}\n\n},{\"./errors.js\":18}],15:[function(require,module,exports){\nmodule.exports = function clone(obj) {\n  return JSON.parse(JSON.stringify(obj));\n};\n\n},{}],16:[function(require,module,exports){\nmodule.exports = function deprecate(fn, message) {\n  var warned = false;\n\n  function deprecated() {\n    if (!warned) {\n      /* eslint no-console:0 */\n      console.log(message);\n      warned = true;\n    }\n\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n};\n\n},{}],17:[function(require,module,exports){\nmodule.exports = function deprecatedMessage(previousUsage, newUsage) {\n  var githubAnchorLink = previousUsage.toLowerCase()\n    .replace('.', '')\n    .replace('()', '');\n\n  return 'algoliasearch: `' + previousUsage + '` was replaced by `' + newUsage +\n    '`. Please see https://github.com/algolia/algoliasearch-client-js/wiki/Deprecated#' + githubAnchorLink;\n};\n\n},{}],18:[function(require,module,exports){\n'use strict';\n\n// This file hosts our error definitions\n// We use custom error \"types\" so that we can act on them when we need it\n// e.g.: if error instanceof errors.UnparsableJSON then..\n\nvar inherits = require('inherits');\n\nfunction AlgoliaSearchError(message, extraProperties) {\n  var forEach = require('foreach');\n\n  var error = this;\n\n  // try to get a stacktrace\n  if (typeof Error.captureStackTrace === 'function') {\n    Error.captureStackTrace(this, this.constructor);\n  } else {\n    error.stack = (new Error()).stack || 'Cannot get a stacktrace, browser is too old';\n  }\n\n  this.name = 'AlgoliaSearchError';\n  this.message = message || 'Unknown error';\n\n  if (extraProperties) {\n    forEach(extraProperties, function addToErrorObject(value, key) {\n      error[key] = value;\n    });\n  }\n}\n\ninherits(AlgoliaSearchError, Error);\n\nfunction createCustomError(name, message) {\n  function AlgoliaSearchCustomError() {\n    var args = Array.prototype.slice.call(arguments, 0);\n\n    // custom message not set, use default\n    if (typeof args[0] !== 'string') {\n      args.unshift(message);\n    }\n\n    AlgoliaSearchError.apply(this, args);\n    this.name = 'AlgoliaSearch' + name + 'Error';\n  }\n\n  inherits(AlgoliaSearchCustomError, AlgoliaSearchError);\n\n  return AlgoliaSearchCustomError;\n}\n\n// late exports to let various fn defs and inherits take place\nmodule.exports = {\n  AlgoliaSearchError: AlgoliaSearchError,\n  UnparsableJSON: createCustomError(\n    'UnparsableJSON',\n    'Could not parse the incoming response as JSON, see err.more for details'\n  ),\n  RequestTimeout: createCustomError(\n    'RequestTimeout',\n    'Request timedout before getting a response'\n  ),\n  Network: createCustomError(\n    'Network',\n    'Network issue, see err.more for details'\n  ),\n  JSONPScriptFail: createCustomError(\n    'JSONPScriptFail',\n    '<script> was loaded but did not call our provided callback'\n  ),\n  JSONPScriptError: createCustomError(\n    'JSONPScriptError',\n    '<script> unable to load due to an `error` event on it'\n  ),\n  Unknown: createCustomError(\n    'Unknown',\n    'Unknown error occured'\n  )\n};\n\n},{\"foreach\":29,\"inherits\":31}],19:[function(require,module,exports){\n// Parse cloud does not supports setTimeout\n// We do not store a setTimeout reference in the client everytime\n// We only fallback to a fake setTimeout when not available\n// setTimeout cannot be override globally sadly\nmodule.exports = function exitPromise(fn, _setTimeout) {\n  _setTimeout(fn, 0);\n};\n\n},{}],20:[function(require,module,exports){\nvar foreach = require('foreach');\n\nmodule.exports = function map(arr, fn) {\n  var newArr = [];\n  foreach(arr, function(item, itemIndex) {\n    newArr.push(fn(item, itemIndex, arr));\n  });\n  return newArr;\n};\n\n},{\"foreach\":29}],21:[function(require,module,exports){\nvar foreach = require('foreach');\n\nmodule.exports = function merge(destination/* , sources */) {\n  var sources = Array.prototype.slice.call(arguments);\n\n  foreach(sources, function(source) {\n    for (var keyName in source) {\n      if (source.hasOwnProperty(keyName)) {\n        if (typeof destination[keyName] === 'object' && typeof source[keyName] === 'object') {\n          destination[keyName] = merge({}, destination[keyName], source[keyName]);\n        } else if (source[keyName] !== undefined) {\n          destination[keyName] = source[keyName];\n        }\n      }\n    }\n  });\n\n  return destination;\n};\n\n},{\"foreach\":29}],22:[function(require,module,exports){\nmodule.exports = createPlacesClient;\n\nvar buildSearchMethod = require('./buildSearchMethod.js');\n\nfunction createPlacesClient(algoliasearch) {\n  return function places(appID, apiKey, opts) {\n    var cloneDeep = require('./clone.js');\n\n    opts = opts && cloneDeep(opts) || {};\n    opts.hosts = opts.hosts || [\n      'places-dsn.algolia.net',\n      'places-1.algolianet.com',\n      'places-2.algolianet.com',\n      'places-3.algolianet.com'\n    ];\n\n    // allow initPlaces() no arguments => community rate limited\n    if (arguments.length === 0 || typeof appID === 'object' || appID === undefined) {\n      appID = '';\n      apiKey = '';\n      opts._allowEmptyCredentials = true;\n    }\n\n    var client = algoliasearch(appID, apiKey, opts);\n    var index = client.initIndex('places');\n    index.search = buildSearchMethod('query', '/1/places/query');\n    return index;\n  };\n}\n\n},{\"./buildSearchMethod.js\":14,\"./clone.js\":15}],23:[function(require,module,exports){\n'use strict';\n\nmodule.exports = '3.18.0';\n\n},{}],24:[function(require,module,exports){\n// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\n(function () {\n    try {\n        cachedSetTimeout = setTimeout;\n    } catch (e) {\n        cachedSetTimeout = function () {\n            throw new Error('setTimeout is not defined');\n        }\n    }\n    try {\n        cachedClearTimeout = clearTimeout;\n    } catch (e) {\n        cachedClearTimeout = function () {\n            throw new Error('clearTimeout is not defined');\n        }\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n},{}],25:[function(require,module,exports){\n\n/**\n * This is the web browser implementation of `debug()`.\n *\n * Expose `debug()` as the module.\n */\n\nexports = module.exports = require('./debug');\nexports.log = log;\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.storage = 'undefined' != typeof chrome\n               && 'undefined' != typeof chrome.storage\n                  ? chrome.storage.local\n                  : localstorage();\n\n/**\n * Colors.\n */\n\nexports.colors = [\n  'lightseagreen',\n  'forestgreen',\n  'goldenrod',\n  'dodgerblue',\n  'darkorchid',\n  'crimson'\n];\n\n/**\n * Currently only WebKit-based Web Inspectors, Firefox >= v31,\n * and the Firebug extension (any Firefox version) are known\n * to support \"%c\" CSS customizations.\n *\n * TODO: add a `localStorage` variable to explicitly enable/disable colors\n */\n\nfunction useColors() {\n  // is webkit? http://stackoverflow.com/a/16459606/376773\n  return ('WebkitAppearance' in document.documentElement.style) ||\n    // is firebug? http://stackoverflow.com/a/398120/376773\n    (window.console && (console.firebug || (console.exception && console.table))) ||\n    // is firefox >= v31?\n    // https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages\n    (navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/) && parseInt(RegExp.$1, 10) >= 31);\n}\n\n/**\n * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.\n */\n\nexports.formatters.j = function(v) {\n  return JSON.stringify(v);\n};\n\n\n/**\n * Colorize log arguments if enabled.\n *\n * @api public\n */\n\nfunction formatArgs() {\n  var args = arguments;\n  var useColors = this.useColors;\n\n  args[0] = (useColors ? '%c' : '')\n    + this.namespace\n    + (useColors ? ' %c' : ' ')\n    + args[0]\n    + (useColors ? '%c ' : ' ')\n    + '+' + exports.humanize(this.diff);\n\n  if (!useColors) return args;\n\n  var c = 'color: ' + this.color;\n  args = [args[0], c, 'color: inherit'].concat(Array.prototype.slice.call(args, 1));\n\n  // the final \"%c\" is somewhat tricky, because there could be other\n  // arguments passed either before or after the %c, so we need to\n  // figure out the correct index to insert the CSS into\n  var index = 0;\n  var lastC = 0;\n  args[0].replace(/%[a-z%]/g, function(match) {\n    if ('%%' === match) return;\n    index++;\n    if ('%c' === match) {\n      // we only are interested in the *last* %c\n      // (the user may have provided their own)\n      lastC = index;\n    }\n  });\n\n  args.splice(lastC, 0, c);\n  return args;\n}\n\n/**\n * Invokes `console.log()` when available.\n * No-op when `console.log` is not a \"function\".\n *\n * @api public\n */\n\nfunction log() {\n  // this hackery is required for IE8/9, where\n  // the `console.log` function doesn't have 'apply'\n  return 'object' === typeof console\n    && console.log\n    && Function.prototype.apply.call(console.log, console, arguments);\n}\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\n\nfunction save(namespaces) {\n  try {\n    if (null == namespaces) {\n      exports.storage.removeItem('debug');\n    } else {\n      exports.storage.debug = namespaces;\n    }\n  } catch(e) {}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\n\nfunction load() {\n  var r;\n  try {\n    r = exports.storage.debug;\n  } catch(e) {}\n  return r;\n}\n\n/**\n * Enable namespaces listed in `localStorage.debug` initially.\n */\n\nexports.enable(load());\n\n/**\n * Localstorage attempts to return the localstorage.\n *\n * This is necessary because safari throws\n * when a user disables cookies/localstorage\n * and you attempt to access it.\n *\n * @return {LocalStorage}\n * @api private\n */\n\nfunction localstorage(){\n  try {\n    return window.localStorage;\n  } catch (e) {}\n}\n\n},{\"./debug\":26}],26:[function(require,module,exports){\n\n/**\n * This is the common logic for both the Node.js and web browser\n * implementations of `debug()`.\n *\n * Expose `debug()` as the module.\n */\n\nexports = module.exports = debug;\nexports.coerce = coerce;\nexports.disable = disable;\nexports.enable = enable;\nexports.enabled = enabled;\nexports.humanize = require('algolia-ms');\n\n/**\n * The currently active debug mode names, and names to skip.\n */\n\nexports.names = [];\nexports.skips = [];\n\n/**\n * Map of special \"%n\" handling functions, for the debug \"format\" argument.\n *\n * Valid key names are a single, lowercased letter, i.e. \"n\".\n */\n\nexports.formatters = {};\n\n/**\n * Previously assigned color.\n */\n\nvar prevColor = 0;\n\n/**\n * Previous log timestamp.\n */\n\nvar prevTime;\n\n/**\n * Select a color.\n *\n * @return {Number}\n * @api private\n */\n\nfunction selectColor() {\n  return exports.colors[prevColor++ % exports.colors.length];\n}\n\n/**\n * Create a debugger with the given `namespace`.\n *\n * @param {String} namespace\n * @return {Function}\n * @api public\n */\n\nfunction debug(namespace) {\n\n  // define the `disabled` version\n  function disabled() {\n  }\n  disabled.enabled = false;\n\n  // define the `enabled` version\n  function enabled() {\n\n    var self = enabled;\n\n    // set `diff` timestamp\n    var curr = +new Date();\n    var ms = curr - (prevTime || curr);\n    self.diff = ms;\n    self.prev = prevTime;\n    self.curr = curr;\n    prevTime = curr;\n\n    // add the `color` if not set\n    if (null == self.useColors) self.useColors = exports.useColors();\n    if (null == self.color && self.useColors) self.color = selectColor();\n\n    var args = Array.prototype.slice.call(arguments);\n\n    args[0] = exports.coerce(args[0]);\n\n    if ('string' !== typeof args[0]) {\n      // anything else let's inspect with %o\n      args = ['%o'].concat(args);\n    }\n\n    // apply any `formatters` transformations\n    var index = 0;\n    args[0] = args[0].replace(/%([a-z%])/g, function(match, format) {\n      // if we encounter an escaped % then don't increase the array index\n      if (match === '%%') return match;\n      index++;\n      var formatter = exports.formatters[format];\n      if ('function' === typeof formatter) {\n        var val = args[index];\n        match = formatter.call(self, val);\n\n        // now we need to remove `args[index]` since it's inlined in the `format`\n        args.splice(index, 1);\n        index--;\n      }\n      return match;\n    });\n\n    if ('function' === typeof exports.formatArgs) {\n      args = exports.formatArgs.apply(self, args);\n    }\n    var logFn = enabled.log || exports.log || console.log.bind(console);\n    logFn.apply(self, args);\n  }\n  enabled.enabled = true;\n\n  var fn = exports.enabled(namespace) ? enabled : disabled;\n\n  fn.namespace = namespace;\n\n  return fn;\n}\n\n/**\n * Enables a debug mode by namespaces. This can include modes\n * separated by a colon and wildcards.\n *\n * @param {String} namespaces\n * @api public\n */\n\nfunction enable(namespaces) {\n  exports.save(namespaces);\n\n  var split = (namespaces || '').split(/[\\s,]+/);\n  var len = split.length;\n\n  for (var i = 0; i < len; i++) {\n    if (!split[i]) continue; // ignore empty strings\n    namespaces = split[i].replace(/\\*/g, '.*?');\n    if (namespaces[0] === '-') {\n      exports.skips.push(new RegExp('^' + namespaces.substr(1) + '$'));\n    } else {\n      exports.names.push(new RegExp('^' + namespaces + '$'));\n    }\n  }\n}\n\n/**\n * Disable debug output.\n *\n * @api public\n */\n\nfunction disable() {\n  exports.enable('');\n}\n\n/**\n * Returns true if the given mode name is enabled, false otherwise.\n *\n * @param {String} name\n * @return {Boolean}\n * @api public\n */\n\nfunction enabled(name) {\n  var i, len;\n  for (i = 0, len = exports.skips.length; i < len; i++) {\n    if (exports.skips[i].test(name)) {\n      return false;\n    }\n  }\n  for (i = 0, len = exports.names.length; i < len; i++) {\n    if (exports.names[i].test(name)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Coerce `val`.\n *\n * @param {Mixed} val\n * @return {Mixed}\n * @api private\n */\n\nfunction coerce(val) {\n  if (val instanceof Error) return val.stack || val.message;\n  return val;\n}\n\n},{\"algolia-ms\":3}],27:[function(require,module,exports){\n(function (process,global){\n/*!\n * @overview es6-promise - a tiny implementation of Promises/A+.\n * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)\n * @license   Licensed under MIT license\n *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE\n * @version   3.2.1\n */\n\n(function() {\n    \"use strict\";\n    function lib$es6$promise$utils$$objectOrFunction(x) {\n      return typeof x === 'function' || (typeof x === 'object' && x !== null);\n    }\n\n    function lib$es6$promise$utils$$isFunction(x) {\n      return typeof x === 'function';\n    }\n\n    function lib$es6$promise$utils$$isMaybeThenable(x) {\n      return typeof x === 'object' && x !== null;\n    }\n\n    var lib$es6$promise$utils$$_isArray;\n    if (!Array.isArray) {\n      lib$es6$promise$utils$$_isArray = function (x) {\n        return Object.prototype.toString.call(x) === '[object Array]';\n      };\n    } else {\n      lib$es6$promise$utils$$_isArray = Array.isArray;\n    }\n\n    var lib$es6$promise$utils$$isArray = lib$es6$promise$utils$$_isArray;\n    var lib$es6$promise$asap$$len = 0;\n    var lib$es6$promise$asap$$vertxNext;\n    var lib$es6$promise$asap$$customSchedulerFn;\n\n    var lib$es6$promise$asap$$asap = function asap(callback, arg) {\n      lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len] = callback;\n      lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len + 1] = arg;\n      lib$es6$promise$asap$$len += 2;\n      if (lib$es6$promise$asap$$len === 2) {\n        // If len is 2, that means that we need to schedule an async flush.\n        // If additional callbacks are queued before the queue is flushed, they\n        // will be processed by this flush that we are scheduling.\n        if (lib$es6$promise$asap$$customSchedulerFn) {\n          lib$es6$promise$asap$$customSchedulerFn(lib$es6$promise$asap$$flush);\n        } else {\n          lib$es6$promise$asap$$scheduleFlush();\n        }\n      }\n    }\n\n    function lib$es6$promise$asap$$setScheduler(scheduleFn) {\n      lib$es6$promise$asap$$customSchedulerFn = scheduleFn;\n    }\n\n    function lib$es6$promise$asap$$setAsap(asapFn) {\n      lib$es6$promise$asap$$asap = asapFn;\n    }\n\n    var lib$es6$promise$asap$$browserWindow = (typeof window !== 'undefined') ? window : undefined;\n    var lib$es6$promise$asap$$browserGlobal = lib$es6$promise$asap$$browserWindow || {};\n    var lib$es6$promise$asap$$BrowserMutationObserver = lib$es6$promise$asap$$browserGlobal.MutationObserver || lib$es6$promise$asap$$browserGlobal.WebKitMutationObserver;\n    var lib$es6$promise$asap$$isNode = typeof self === 'undefined' && typeof process !== 'undefined' && {}.toString.call(process) === '[object process]';\n\n    // test for web worker but not in IE10\n    var lib$es6$promise$asap$$isWorker = typeof Uint8ClampedArray !== 'undefined' &&\n      typeof importScripts !== 'undefined' &&\n      typeof MessageChannel !== 'undefined';\n\n    // node\n    function lib$es6$promise$asap$$useNextTick() {\n      // node version 0.10.x displays a deprecation warning when nextTick is used recursively\n      // see https://github.com/cujojs/when/issues/410 for details\n      return function() {\n        process.nextTick(lib$es6$promise$asap$$flush);\n      };\n    }\n\n    // vertx\n    function lib$es6$promise$asap$$useVertxTimer() {\n      return function() {\n        lib$es6$promise$asap$$vertxNext(lib$es6$promise$asap$$flush);\n      };\n    }\n\n    function lib$es6$promise$asap$$useMutationObserver() {\n      var iterations = 0;\n      var observer = new lib$es6$promise$asap$$BrowserMutationObserver(lib$es6$promise$asap$$flush);\n      var node = document.createTextNode('');\n      observer.observe(node, { characterData: true });\n\n      return function() {\n        node.data = (iterations = ++iterations % 2);\n      };\n    }\n\n    // web worker\n    function lib$es6$promise$asap$$useMessageChannel() {\n      var channel = new MessageChannel();\n      channel.port1.onmessage = lib$es6$promise$asap$$flush;\n      return function () {\n        channel.port2.postMessage(0);\n      };\n    }\n\n    function lib$es6$promise$asap$$useSetTimeout() {\n      return function() {\n        setTimeout(lib$es6$promise$asap$$flush, 1);\n      };\n    }\n\n    var lib$es6$promise$asap$$queue = new Array(1000);\n    function lib$es6$promise$asap$$flush() {\n      for (var i = 0; i < lib$es6$promise$asap$$len; i+=2) {\n        var callback = lib$es6$promise$asap$$queue[i];\n        var arg = lib$es6$promise$asap$$queue[i+1];\n\n        callback(arg);\n\n        lib$es6$promise$asap$$queue[i] = undefined;\n        lib$es6$promise$asap$$queue[i+1] = undefined;\n      }\n\n      lib$es6$promise$asap$$len = 0;\n    }\n\n    function lib$es6$promise$asap$$attemptVertx() {\n      try {\n        var r = require;\n        var vertx = r('vertx');\n        lib$es6$promise$asap$$vertxNext = vertx.runOnLoop || vertx.runOnContext;\n        return lib$es6$promise$asap$$useVertxTimer();\n      } catch(e) {\n        return lib$es6$promise$asap$$useSetTimeout();\n      }\n    }\n\n    var lib$es6$promise$asap$$scheduleFlush;\n    // Decide what async method to use to triggering processing of queued callbacks:\n    if (lib$es6$promise$asap$$isNode) {\n      lib$es6$promise$asap$$scheduleFlush = lib$es6$promise$asap$$useNextTick();\n    } else if (lib$es6$promise$asap$$BrowserMutationObserver) {\n      lib$es6$promise$asap$$scheduleFlush = lib$es6$promise$asap$$useMutationObserver();\n    } else if (lib$es6$promise$asap$$isWorker) {\n      lib$es6$promise$asap$$scheduleFlush = lib$es6$promise$asap$$useMessageChannel();\n    } else if (lib$es6$promise$asap$$browserWindow === undefined && typeof require === 'function') {\n      lib$es6$promise$asap$$scheduleFlush = lib$es6$promise$asap$$attemptVertx();\n    } else {\n      lib$es6$promise$asap$$scheduleFlush = lib$es6$promise$asap$$useSetTimeout();\n    }\n    function lib$es6$promise$then$$then(onFulfillment, onRejection) {\n      var parent = this;\n\n      var child = new this.constructor(lib$es6$promise$$internal$$noop);\n\n      if (child[lib$es6$promise$$internal$$PROMISE_ID] === undefined) {\n        lib$es6$promise$$internal$$makePromise(child);\n      }\n\n      var state = parent._state;\n\n      if (state) {\n        var callback = arguments[state - 1];\n        lib$es6$promise$asap$$asap(function(){\n          lib$es6$promise$$internal$$invokeCallback(state, child, callback, parent._result);\n        });\n      } else {\n        lib$es6$promise$$internal$$subscribe(parent, child, onFulfillment, onRejection);\n      }\n\n      return child;\n    }\n    var lib$es6$promise$then$$default = lib$es6$promise$then$$then;\n    function lib$es6$promise$promise$resolve$$resolve(object) {\n      /*jshint validthis:true */\n      var Constructor = this;\n\n      if (object && typeof object === 'object' && object.constructor === Constructor) {\n        return object;\n      }\n\n      var promise = new Constructor(lib$es6$promise$$internal$$noop);\n      lib$es6$promise$$internal$$resolve(promise, object);\n      return promise;\n    }\n    var lib$es6$promise$promise$resolve$$default = lib$es6$promise$promise$resolve$$resolve;\n    var lib$es6$promise$$internal$$PROMISE_ID = Math.random().toString(36).substring(16);\n\n    function lib$es6$promise$$internal$$noop() {}\n\n    var lib$es6$promise$$internal$$PENDING   = void 0;\n    var lib$es6$promise$$internal$$FULFILLED = 1;\n    var lib$es6$promise$$internal$$REJECTED  = 2;\n\n    var lib$es6$promise$$internal$$GET_THEN_ERROR = new lib$es6$promise$$internal$$ErrorObject();\n\n    function lib$es6$promise$$internal$$selfFulfillment() {\n      return new TypeError(\"You cannot resolve a promise with itself\");\n    }\n\n    function lib$es6$promise$$internal$$cannotReturnOwn() {\n      return new TypeError('A promises callback cannot return that same promise.');\n    }\n\n    function lib$es6$promise$$internal$$getThen(promise) {\n      try {\n        return promise.then;\n      } catch(error) {\n        lib$es6$promise$$internal$$GET_THEN_ERROR.error = error;\n        return lib$es6$promise$$internal$$GET_THEN_ERROR;\n      }\n    }\n\n    function lib$es6$promise$$internal$$tryThen(then, value, fulfillmentHandler, rejectionHandler) {\n      try {\n        then.call(value, fulfillmentHandler, rejectionHandler);\n      } catch(e) {\n        return e;\n      }\n    }\n\n    function lib$es6$promise$$internal$$handleForeignThenable(promise, thenable, then) {\n       lib$es6$promise$asap$$asap(function(promise) {\n        var sealed = false;\n        var error = lib$es6$promise$$internal$$tryThen(then, thenable, function(value) {\n          if (sealed) { return; }\n          sealed = true;\n          if (thenable !== value) {\n            lib$es6$promise$$internal$$resolve(promise, value);\n          } else {\n            lib$es6$promise$$internal$$fulfill(promise, value);\n          }\n        }, function(reason) {\n          if (sealed) { return; }\n          sealed = true;\n\n          lib$es6$promise$$internal$$reject(promise, reason);\n        }, 'Settle: ' + (promise._label || ' unknown promise'));\n\n        if (!sealed && error) {\n          sealed = true;\n          lib$es6$promise$$internal$$reject(promise, error);\n        }\n      }, promise);\n    }\n\n    function lib$es6$promise$$internal$$handleOwnThenable(promise, thenable) {\n      if (thenable._state === lib$es6$promise$$internal$$FULFILLED) {\n        lib$es6$promise$$internal$$fulfill(promise, thenable._result);\n      } else if (thenable._state === lib$es6$promise$$internal$$REJECTED) {\n        lib$es6$promise$$internal$$reject(promise, thenable._result);\n      } else {\n        lib$es6$promise$$internal$$subscribe(thenable, undefined, function(value) {\n          lib$es6$promise$$internal$$resolve(promise, value);\n        }, function(reason) {\n          lib$es6$promise$$internal$$reject(promise, reason);\n        });\n      }\n    }\n\n    function lib$es6$promise$$internal$$handleMaybeThenable(promise, maybeThenable, then) {\n      if (maybeThenable.constructor === promise.constructor &&\n          then === lib$es6$promise$then$$default &&\n          constructor.resolve === lib$es6$promise$promise$resolve$$default) {\n        lib$es6$promise$$internal$$handleOwnThenable(promise, maybeThenable);\n      } else {\n        if (then === lib$es6$promise$$internal$$GET_THEN_ERROR) {\n          lib$es6$promise$$internal$$reject(promise, lib$es6$promise$$internal$$GET_THEN_ERROR.error);\n        } else if (then === undefined) {\n          lib$es6$promise$$internal$$fulfill(promise, maybeThenable);\n        } else if (lib$es6$promise$utils$$isFunction(then)) {\n          lib$es6$promise$$internal$$handleForeignThenable(promise, maybeThenable, then);\n        } else {\n          lib$es6$promise$$internal$$fulfill(promise, maybeThenable);\n        }\n      }\n    }\n\n    function lib$es6$promise$$internal$$resolve(promise, value) {\n      if (promise === value) {\n        lib$es6$promise$$internal$$reject(promise, lib$es6$promise$$internal$$selfFulfillment());\n      } else if (lib$es6$promise$utils$$objectOrFunction(value)) {\n        lib$es6$promise$$internal$$handleMaybeThenable(promise, value, lib$es6$promise$$internal$$getThen(value));\n      } else {\n        lib$es6$promise$$internal$$fulfill(promise, value);\n      }\n    }\n\n    function lib$es6$promise$$internal$$publishRejection(promise) {\n      if (promise._onerror) {\n        promise._onerror(promise._result);\n      }\n\n      lib$es6$promise$$internal$$publish(promise);\n    }\n\n    function lib$es6$promise$$internal$$fulfill(promise, value) {\n      if (promise._state !== lib$es6$promise$$internal$$PENDING) { return; }\n\n      promise._result = value;\n      promise._state = lib$es6$promise$$internal$$FULFILLED;\n\n      if (promise._subscribers.length !== 0) {\n        lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish, promise);\n      }\n    }\n\n    function lib$es6$promise$$internal$$reject(promise, reason) {\n      if (promise._state !== lib$es6$promise$$internal$$PENDING) { return; }\n      promise._state = lib$es6$promise$$internal$$REJECTED;\n      promise._result = reason;\n\n      lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publishRejection, promise);\n    }\n\n    function lib$es6$promise$$internal$$subscribe(parent, child, onFulfillment, onRejection) {\n      var subscribers = parent._subscribers;\n      var length = subscribers.length;\n\n      parent._onerror = null;\n\n      subscribers[length] = child;\n      subscribers[length + lib$es6$promise$$internal$$FULFILLED] = onFulfillment;\n      subscribers[length + lib$es6$promise$$internal$$REJECTED]  = onRejection;\n\n      if (length === 0 && parent._state) {\n        lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish, parent);\n      }\n    }\n\n    function lib$es6$promise$$internal$$publish(promise) {\n      var subscribers = promise._subscribers;\n      var settled = promise._state;\n\n      if (subscribers.length === 0) { return; }\n\n      var child, callback, detail = promise._result;\n\n      for (var i = 0; i < subscribers.length; i += 3) {\n        child = subscribers[i];\n        callback = subscribers[i + settled];\n\n        if (child) {\n          lib$es6$promise$$internal$$invokeCallback(settled, child, callback, detail);\n        } else {\n          callback(detail);\n        }\n      }\n\n      promise._subscribers.length = 0;\n    }\n\n    function lib$es6$promise$$internal$$ErrorObject() {\n      this.error = null;\n    }\n\n    var lib$es6$promise$$internal$$TRY_CATCH_ERROR = new lib$es6$promise$$internal$$ErrorObject();\n\n    function lib$es6$promise$$internal$$tryCatch(callback, detail) {\n      try {\n        return callback(detail);\n      } catch(e) {\n        lib$es6$promise$$internal$$TRY_CATCH_ERROR.error = e;\n        return lib$es6$promise$$internal$$TRY_CATCH_ERROR;\n      }\n    }\n\n    function lib$es6$promise$$internal$$invokeCallback(settled, promise, callback, detail) {\n      var hasCallback = lib$es6$promise$utils$$isFunction(callback),\n          value, error, succeeded, failed;\n\n      if (hasCallback) {\n        value = lib$es6$promise$$internal$$tryCatch(callback, detail);\n\n        if (value === lib$es6$promise$$internal$$TRY_CATCH_ERROR) {\n          failed = true;\n          error = value.error;\n          value = null;\n        } else {\n          succeeded = true;\n        }\n\n        if (promise === value) {\n          lib$es6$promise$$internal$$reject(promise, lib$es6$promise$$internal$$cannotReturnOwn());\n          return;\n        }\n\n      } else {\n        value = detail;\n        succeeded = true;\n      }\n\n      if (promise._state !== lib$es6$promise$$internal$$PENDING) {\n        // noop\n      } else if (hasCallback && succeeded) {\n        lib$es6$promise$$internal$$resolve(promise, value);\n      } else if (failed) {\n        lib$es6$promise$$internal$$reject(promise, error);\n      } else if (settled === lib$es6$promise$$internal$$FULFILLED) {\n        lib$es6$promise$$internal$$fulfill(promise, value);\n      } else if (settled === lib$es6$promise$$internal$$REJECTED) {\n        lib$es6$promise$$internal$$reject(promise, value);\n      }\n    }\n\n    function lib$es6$promise$$internal$$initializePromise(promise, resolver) {\n      try {\n        resolver(function resolvePromise(value){\n          lib$es6$promise$$internal$$resolve(promise, value);\n        }, function rejectPromise(reason) {\n          lib$es6$promise$$internal$$reject(promise, reason);\n        });\n      } catch(e) {\n        lib$es6$promise$$internal$$reject(promise, e);\n      }\n    }\n\n    var lib$es6$promise$$internal$$id = 0;\n    function lib$es6$promise$$internal$$nextId() {\n      return lib$es6$promise$$internal$$id++;\n    }\n\n    function lib$es6$promise$$internal$$makePromise(promise) {\n      promise[lib$es6$promise$$internal$$PROMISE_ID] = lib$es6$promise$$internal$$id++;\n      promise._state = undefined;\n      promise._result = undefined;\n      promise._subscribers = [];\n    }\n\n    function lib$es6$promise$promise$all$$all(entries) {\n      return new lib$es6$promise$enumerator$$default(this, entries).promise;\n    }\n    var lib$es6$promise$promise$all$$default = lib$es6$promise$promise$all$$all;\n    function lib$es6$promise$promise$race$$race(entries) {\n      /*jshint validthis:true */\n      var Constructor = this;\n\n      if (!lib$es6$promise$utils$$isArray(entries)) {\n        return new Constructor(function(resolve, reject) {\n          reject(new TypeError('You must pass an array to race.'));\n        });\n      } else {\n        return new Constructor(function(resolve, reject) {\n          var length = entries.length;\n          for (var i = 0; i < length; i++) {\n            Constructor.resolve(entries[i]).then(resolve, reject);\n          }\n        });\n      }\n    }\n    var lib$es6$promise$promise$race$$default = lib$es6$promise$promise$race$$race;\n    function lib$es6$promise$promise$reject$$reject(reason) {\n      /*jshint validthis:true */\n      var Constructor = this;\n      var promise = new Constructor(lib$es6$promise$$internal$$noop);\n      lib$es6$promise$$internal$$reject(promise, reason);\n      return promise;\n    }\n    var lib$es6$promise$promise$reject$$default = lib$es6$promise$promise$reject$$reject;\n\n\n    function lib$es6$promise$promise$$needsResolver() {\n      throw new TypeError('You must pass a resolver function as the first argument to the promise constructor');\n    }\n\n    function lib$es6$promise$promise$$needsNew() {\n      throw new TypeError(\"Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.\");\n    }\n\n    var lib$es6$promise$promise$$default = lib$es6$promise$promise$$Promise;\n    /**\n      Promise objects represent the eventual result of an asynchronous operation. The\n      primary way of interacting with a promise is through its `then` method, which\n      registers callbacks to receive either a promise's eventual value or the reason\n      why the promise cannot be fulfilled.\n\n      Terminology\n      -----------\n\n      - `promise` is an object or function with a `then` method whose behavior conforms to this specification.\n      - `thenable` is an object or function that defines a `then` method.\n      - `value` is any legal JavaScript value (including undefined, a thenable, or a promise).\n      - `exception` is a value that is thrown using the throw statement.\n      - `reason` is a value that indicates why a promise was rejected.\n      - `settled` the final resting state of a promise, fulfilled or rejected.\n\n      A promise can be in one of three states: pending, fulfilled, or rejected.\n\n      Promises that are fulfilled have a fulfillment value and are in the fulfilled\n      state.  Promises that are rejected have a rejection reason and are in the\n      rejected state.  A fulfillment value is never a thenable.\n\n      Promises can also be said to *resolve* a value.  If this value is also a\n      promise, then the original promise's settled state will match the value's\n      settled state.  So a promise that *resolves* a promise that rejects will\n      itself reject, and a promise that *resolves* a promise that fulfills will\n      itself fulfill.\n\n\n      Basic Usage:\n      ------------\n\n      ```js\n      var promise = new Promise(function(resolve, reject) {\n        // on success\n        resolve(value);\n\n        // on failure\n        reject(reason);\n      });\n\n      promise.then(function(value) {\n        // on fulfillment\n      }, function(reason) {\n        // on rejection\n      });\n      ```\n\n      Advanced Usage:\n      ---------------\n\n      Promises shine when abstracting away asynchronous interactions such as\n      `XMLHttpRequest`s.\n\n      ```js\n      function getJSON(url) {\n        return new Promise(function(resolve, reject){\n          var xhr = new XMLHttpRequest();\n\n          xhr.open('GET', url);\n          xhr.onreadystatechange = handler;\n          xhr.responseType = 'json';\n          xhr.setRequestHeader('Accept', 'application/json');\n          xhr.send();\n\n          function handler() {\n            if (this.readyState === this.DONE) {\n              if (this.status === 200) {\n                resolve(this.response);\n              } else {\n                reject(new Error('getJSON: `' + url + '` failed with status: [' + this.status + ']'));\n              }\n            }\n          };\n        });\n      }\n\n      getJSON('/posts.json').then(function(json) {\n        // on fulfillment\n      }, function(reason) {\n        // on rejection\n      });\n      ```\n\n      Unlike callbacks, promises are great composable primitives.\n\n      ```js\n      Promise.all([\n        getJSON('/posts'),\n        getJSON('/comments')\n      ]).then(function(values){\n        values[0] // => postsJSON\n        values[1] // => commentsJSON\n\n        return values;\n      });\n      ```\n\n      @class Promise\n      @param {function} resolver\n      Useful for tooling.\n      @constructor\n    */\n    function lib$es6$promise$promise$$Promise(resolver) {\n      this[lib$es6$promise$$internal$$PROMISE_ID] = lib$es6$promise$$internal$$nextId();\n      this._result = this._state = undefined;\n      this._subscribers = [];\n\n      if (lib$es6$promise$$internal$$noop !== resolver) {\n        typeof resolver !== 'function' && lib$es6$promise$promise$$needsResolver();\n        this instanceof lib$es6$promise$promise$$Promise ? lib$es6$promise$$internal$$initializePromise(this, resolver) : lib$es6$promise$promise$$needsNew();\n      }\n    }\n\n    lib$es6$promise$promise$$Promise.all = lib$es6$promise$promise$all$$default;\n    lib$es6$promise$promise$$Promise.race = lib$es6$promise$promise$race$$default;\n    lib$es6$promise$promise$$Promise.resolve = lib$es6$promise$promise$resolve$$default;\n    lib$es6$promise$promise$$Promise.reject = lib$es6$promise$promise$reject$$default;\n    lib$es6$promise$promise$$Promise._setScheduler = lib$es6$promise$asap$$setScheduler;\n    lib$es6$promise$promise$$Promise._setAsap = lib$es6$promise$asap$$setAsap;\n    lib$es6$promise$promise$$Promise._asap = lib$es6$promise$asap$$asap;\n\n    lib$es6$promise$promise$$Promise.prototype = {\n      constructor: lib$es6$promise$promise$$Promise,\n\n    /**\n      The primary way of interacting with a promise is through its `then` method,\n      which registers callbacks to receive either a promise's eventual value or the\n      reason why the promise cannot be fulfilled.\n\n      ```js\n      findUser().then(function(user){\n        // user is available\n      }, function(reason){\n        // user is unavailable, and you are given the reason why\n      });\n      ```\n\n      Chaining\n      --------\n\n      The return value of `then` is itself a promise.  This second, 'downstream'\n      promise is resolved with the return value of the first promise's fulfillment\n      or rejection handler, or rejected if the handler throws an exception.\n\n      ```js\n      findUser().then(function (user) {\n        return user.name;\n      }, function (reason) {\n        return 'default name';\n      }).then(function (userName) {\n        // If `findUser` fulfilled, `userName` will be the user's name, otherwise it\n        // will be `'default name'`\n      });\n\n      findUser().then(function (user) {\n        throw new Error('Found user, but still unhappy');\n      }, function (reason) {\n        throw new Error('`findUser` rejected and we're unhappy');\n      }).then(function (value) {\n        // never reached\n      }, function (reason) {\n        // if `findUser` fulfilled, `reason` will be 'Found user, but still unhappy'.\n        // If `findUser` rejected, `reason` will be '`findUser` rejected and we're unhappy'.\n      });\n      ```\n      If the downstream promise does not specify a rejection handler, rejection reasons will be propagated further downstream.\n\n      ```js\n      findUser().then(function (user) {\n        throw new PedagogicalException('Upstream error');\n      }).then(function (value) {\n        // never reached\n      }).then(function (value) {\n        // never reached\n      }, function (reason) {\n        // The `PedgagocialException` is propagated all the way down to here\n      });\n      ```\n\n      Assimilation\n      ------------\n\n      Sometimes the value you want to propagate to a downstream promise can only be\n      retrieved asynchronously. This can be achieved by returning a promise in the\n      fulfillment or rejection handler. The downstream promise will then be pending\n      until the returned promise is settled. This is called *assimilation*.\n\n      ```js\n      findUser().then(function (user) {\n        return findCommentsByAuthor(user);\n      }).then(function (comments) {\n        // The user's comments are now available\n      });\n      ```\n\n      If the assimliated promise rejects, then the downstream promise will also reject.\n\n      ```js\n      findUser().then(function (user) {\n        return findCommentsByAuthor(user);\n      }).then(function (comments) {\n        // If `findCommentsByAuthor` fulfills, we'll have the value here\n      }, function (reason) {\n        // If `findCommentsByAuthor` rejects, we'll have the reason here\n      });\n      ```\n\n      Simple Example\n      --------------\n\n      Synchronous Example\n\n      ```javascript\n      var result;\n\n      try {\n        result = findResult();\n        // success\n      } catch(reason) {\n        // failure\n      }\n      ```\n\n      Errback Example\n\n      ```js\n      findResult(function(result, err){\n        if (err) {\n          // failure\n        } else {\n          // success\n        }\n      });\n      ```\n\n      Promise Example;\n\n      ```javascript\n      findResult().then(function(result){\n        // success\n      }, function(reason){\n        // failure\n      });\n      ```\n\n      Advanced Example\n      --------------\n\n      Synchronous Example\n\n      ```javascript\n      var author, books;\n\n      try {\n        author = findAuthor();\n        books  = findBooksByAuthor(author);\n        // success\n      } catch(reason) {\n        // failure\n      }\n      ```\n\n      Errback Example\n\n      ```js\n\n      function foundBooks(books) {\n\n      }\n\n      function failure(reason) {\n\n      }\n\n      findAuthor(function(author, err){\n        if (err) {\n          failure(err);\n          // failure\n        } else {\n          try {\n            findBoooksByAuthor(author, function(books, err) {\n              if (err) {\n                failure(err);\n              } else {\n                try {\n                  foundBooks(books);\n                } catch(reason) {\n                  failure(reason);\n                }\n              }\n            });\n          } catch(error) {\n            failure(err);\n          }\n          // success\n        }\n      });\n      ```\n\n      Promise Example;\n\n      ```javascript\n      findAuthor().\n        then(findBooksByAuthor).\n        then(function(books){\n          // found books\n      }).catch(function(reason){\n        // something went wrong\n      });\n      ```\n\n      @method then\n      @param {Function} onFulfilled\n      @param {Function} onRejected\n      Useful for tooling.\n      @return {Promise}\n    */\n      then: lib$es6$promise$then$$default,\n\n    /**\n      `catch` is simply sugar for `then(undefined, onRejection)` which makes it the same\n      as the catch block of a try/catch statement.\n\n      ```js\n      function findAuthor(){\n        throw new Error('couldn't find that author');\n      }\n\n      // synchronous\n      try {\n        findAuthor();\n      } catch(reason) {\n        // something went wrong\n      }\n\n      // async with promises\n      findAuthor().catch(function(reason){\n        // something went wrong\n      });\n      ```\n\n      @method catch\n      @param {Function} onRejection\n      Useful for tooling.\n      @return {Promise}\n    */\n      'catch': function(onRejection) {\n        return this.then(null, onRejection);\n      }\n    };\n    var lib$es6$promise$enumerator$$default = lib$es6$promise$enumerator$$Enumerator;\n    function lib$es6$promise$enumerator$$Enumerator(Constructor, input) {\n      this._instanceConstructor = Constructor;\n      this.promise = new Constructor(lib$es6$promise$$internal$$noop);\n\n      if (!this.promise[lib$es6$promise$$internal$$PROMISE_ID]) {\n        lib$es6$promise$$internal$$makePromise(this.promise);\n      }\n\n      if (lib$es6$promise$utils$$isArray(input)) {\n        this._input     = input;\n        this.length     = input.length;\n        this._remaining = input.length;\n\n        this._result = new Array(this.length);\n\n        if (this.length === 0) {\n          lib$es6$promise$$internal$$fulfill(this.promise, this._result);\n        } else {\n          this.length = this.length || 0;\n          this._enumerate();\n          if (this._remaining === 0) {\n            lib$es6$promise$$internal$$fulfill(this.promise, this._result);\n          }\n        }\n      } else {\n        lib$es6$promise$$internal$$reject(this.promise, lib$es6$promise$enumerator$$validationError());\n      }\n    }\n\n    function lib$es6$promise$enumerator$$validationError() {\n      return new Error('Array Methods must be provided an Array');\n    }\n\n    lib$es6$promise$enumerator$$Enumerator.prototype._enumerate = function() {\n      var length  = this.length;\n      var input   = this._input;\n\n      for (var i = 0; this._state === lib$es6$promise$$internal$$PENDING && i < length; i++) {\n        this._eachEntry(input[i], i);\n      }\n    };\n\n    lib$es6$promise$enumerator$$Enumerator.prototype._eachEntry = function(entry, i) {\n      var c = this._instanceConstructor;\n      var resolve = c.resolve;\n\n      if (resolve === lib$es6$promise$promise$resolve$$default) {\n        var then = lib$es6$promise$$internal$$getThen(entry);\n\n        if (then === lib$es6$promise$then$$default &&\n            entry._state !== lib$es6$promise$$internal$$PENDING) {\n          this._settledAt(entry._state, i, entry._result);\n        } else if (typeof then !== 'function') {\n          this._remaining--;\n          this._result[i] = entry;\n        } else if (c === lib$es6$promise$promise$$default) {\n          var promise = new c(lib$es6$promise$$internal$$noop);\n          lib$es6$promise$$internal$$handleMaybeThenable(promise, entry, then);\n          this._willSettleAt(promise, i);\n        } else {\n          this._willSettleAt(new c(function(resolve) { resolve(entry); }), i);\n        }\n      } else {\n        this._willSettleAt(resolve(entry), i);\n      }\n    };\n\n    lib$es6$promise$enumerator$$Enumerator.prototype._settledAt = function(state, i, value) {\n      var promise = this.promise;\n\n      if (promise._state === lib$es6$promise$$internal$$PENDING) {\n        this._remaining--;\n\n        if (state === lib$es6$promise$$internal$$REJECTED) {\n          lib$es6$promise$$internal$$reject(promise, value);\n        } else {\n          this._result[i] = value;\n        }\n      }\n\n      if (this._remaining === 0) {\n        lib$es6$promise$$internal$$fulfill(promise, this._result);\n      }\n    };\n\n    lib$es6$promise$enumerator$$Enumerator.prototype._willSettleAt = function(promise, i) {\n      var enumerator = this;\n\n      lib$es6$promise$$internal$$subscribe(promise, undefined, function(value) {\n        enumerator._settledAt(lib$es6$promise$$internal$$FULFILLED, i, value);\n      }, function(reason) {\n        enumerator._settledAt(lib$es6$promise$$internal$$REJECTED, i, reason);\n      });\n    };\n    function lib$es6$promise$polyfill$$polyfill() {\n      var local;\n\n      if (typeof global !== 'undefined') {\n          local = global;\n      } else if (typeof self !== 'undefined') {\n          local = self;\n      } else {\n          try {\n              local = Function('return this')();\n          } catch (e) {\n              throw new Error('polyfill failed because global object is unavailable in this environment');\n          }\n      }\n\n      var P = local.Promise;\n\n      if (P && Object.prototype.toString.call(P.resolve()) === '[object Promise]' && !P.cast) {\n        return;\n      }\n\n      local.Promise = lib$es6$promise$promise$$default;\n    }\n    var lib$es6$promise$polyfill$$default = lib$es6$promise$polyfill$$polyfill;\n\n    var lib$es6$promise$umd$$ES6Promise = {\n      'Promise': lib$es6$promise$promise$$default,\n      'polyfill': lib$es6$promise$polyfill$$default\n    };\n\n    /* global define:true module:true window: true */\n    if (typeof define === 'function' && define['amd']) {\n      define(function() { return lib$es6$promise$umd$$ES6Promise; });\n    } else if (typeof module !== 'undefined' && module['exports']) {\n      module['exports'] = lib$es6$promise$umd$$ES6Promise;\n    } else if (typeof this !== 'undefined') {\n      this['ES6Promise'] = lib$es6$promise$umd$$ES6Promise;\n    }\n\n    lib$es6$promise$polyfill$$default();\n}).call(this);\n\n\n}).call(this,require('_process'),typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"_process\":24}],28:[function(require,module,exports){\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n\n},{}],29:[function(require,module,exports){\n\nvar hasOwn = Object.prototype.hasOwnProperty;\nvar toString = Object.prototype.toString;\n\nmodule.exports = function forEach (obj, fn, ctx) {\n    if (toString.call(fn) !== '[object Function]') {\n        throw new TypeError('iterator must be a function');\n    }\n    var l = obj.length;\n    if (l === +l) {\n        for (var i = 0; i < l; i++) {\n            fn.call(ctx, obj[i], i, obj);\n        }\n    } else {\n        for (var k in obj) {\n            if (hasOwn.call(obj, k)) {\n                fn.call(ctx, obj[k], k, obj);\n            }\n        }\n    }\n};\n\n\n},{}],30:[function(require,module,exports){\n(function (global){\nif (typeof window !== \"undefined\") {\n    module.exports = window;\n} else if (typeof global !== \"undefined\") {\n    module.exports = global;\n} else if (typeof self !== \"undefined\"){\n    module.exports = self;\n} else {\n    module.exports = {};\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],31:[function(require,module,exports){\nif (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n\n},{}],32:[function(require,module,exports){\nvar toString = {}.toString;\n\nmodule.exports = Array.isArray || function (arr) {\n  return toString.call(arr) == '[object Array]';\n};\n\n},{}],33:[function(require,module,exports){\n;(function (global, factory) { // eslint-disable-line\r\n\t\"use strict\"\r\n\t/* eslint-disable no-undef */\r\n\tvar m = factory(global)\r\n\tif (typeof module === \"object\" && module != null && module.exports) {\r\n\t\tmodule.exports = m\r\n\t} else if (typeof define === \"function\" && define.amd) {\r\n\t\tdefine(function () { return m })\r\n\t} else {\r\n\t\tglobal.m = m\r\n\t}\r\n\t/* eslint-enable no-undef */\r\n})(typeof window !== \"undefined\" ? window : this, function (global, undefined) { // eslint-disable-line\r\n\t\"use strict\"\r\n\r\n\tm.version = function () {\r\n\t\treturn \"v0.2.5\"\r\n\t}\r\n\r\n\tvar hasOwn = {}.hasOwnProperty\r\n\tvar type = {}.toString\r\n\r\n\tfunction isFunction(object) {\r\n\t\treturn typeof object === \"function\"\r\n\t}\r\n\r\n\tfunction isObject(object) {\r\n\t\treturn type.call(object) === \"[object Object]\"\r\n\t}\r\n\r\n\tfunction isString(object) {\r\n\t\treturn type.call(object) === \"[object String]\"\r\n\t}\r\n\r\n\tvar isArray = Array.isArray || function (object) {\r\n\t\treturn type.call(object) === \"[object Array]\"\r\n\t}\r\n\r\n\tfunction noop() {}\r\n\r\n\tvar voidElements = {\r\n\t\tAREA: 1,\r\n\t\tBASE: 1,\r\n\t\tBR: 1,\r\n\t\tCOL: 1,\r\n\t\tCOMMAND: 1,\r\n\t\tEMBED: 1,\r\n\t\tHR: 1,\r\n\t\tIMG: 1,\r\n\t\tINPUT: 1,\r\n\t\tKEYGEN: 1,\r\n\t\tLINK: 1,\r\n\t\tMETA: 1,\r\n\t\tPARAM: 1,\r\n\t\tSOURCE: 1,\r\n\t\tTRACK: 1,\r\n\t\tWBR: 1\r\n\t}\r\n\r\n\t// caching commonly used variables\r\n\tvar $document, $location, $requestAnimationFrame, $cancelAnimationFrame\r\n\r\n\t// self invoking function needed because of the way mocks work\r\n\tfunction initialize(mock) {\r\n\t\t$document = mock.document\r\n\t\t$location = mock.location\r\n\t\t$cancelAnimationFrame = mock.cancelAnimationFrame || mock.clearTimeout\r\n\t\t$requestAnimationFrame = mock.requestAnimationFrame || mock.setTimeout\r\n\t}\r\n\r\n\t// testing API\r\n\tm.deps = function (mock) {\r\n\t\tinitialize(global = mock || window)\r\n\t\treturn global\r\n\t}\r\n\r\n\tm.deps(global)\r\n\r\n\t/**\r\n\t * @typedef {String} Tag\r\n\t * A string that looks like -> div.classname#id[param=one][param2=two]\r\n\t * Which describes a DOM node\r\n\t */\r\n\r\n\tfunction parseTagAttrs(cell, tag) {\r\n\t\tvar classes = []\r\n\t\tvar parser = /(?:(^|#|\\.)([^#\\.\\[\\]]+))|(\\[.+?\\])/g\r\n\t\tvar match\r\n\r\n\t\twhile ((match = parser.exec(tag))) {\r\n\t\t\tif (match[1] === \"\" && match[2]) {\r\n\t\t\t\tcell.tag = match[2]\r\n\t\t\t} else if (match[1] === \"#\") {\r\n\t\t\t\tcell.attrs.id = match[2]\r\n\t\t\t} else if (match[1] === \".\") {\r\n\t\t\t\tclasses.push(match[2])\r\n\t\t\t} else if (match[3][0] === \"[\") {\r\n\t\t\t\tvar pair = /\\[(.+?)(?:=(\"|'|)(.*?)\\2)?\\]/.exec(match[3])\r\n\t\t\t\tcell.attrs[pair[1]] = pair[3] || \"\"\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn classes\r\n\t}\r\n\r\n\tfunction getVirtualChildren(args, hasAttrs) {\r\n\t\tvar children = hasAttrs ? args.slice(1) : args\r\n\r\n\t\tif (children.length === 1 && isArray(children[0])) {\r\n\t\t\treturn children[0]\r\n\t\t} else {\r\n\t\t\treturn children\r\n\t\t}\r\n\t}\r\n\r\n\tfunction assignAttrs(target, attrs, classes) {\r\n\t\tvar classAttr = \"class\" in attrs ? \"class\" : \"className\"\r\n\r\n\t\tfor (var attrName in attrs) {\r\n\t\t\tif (hasOwn.call(attrs, attrName)) {\r\n\t\t\t\tif (attrName === classAttr &&\r\n\t\t\t\t\t\tattrs[attrName] != null &&\r\n\t\t\t\t\t\tattrs[attrName] !== \"\") {\r\n\t\t\t\t\tclasses.push(attrs[attrName])\r\n\t\t\t\t\t// create key in correct iteration order\r\n\t\t\t\t\ttarget[attrName] = \"\"\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttarget[attrName] = attrs[attrName]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (classes.length) target[classAttr] = classes.join(\" \")\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param {Tag} The DOM node tag\r\n\t * @param {Object=[]} optional key-value pairs to be mapped to DOM attrs\r\n\t * @param {...mNode=[]} Zero or more Mithril child nodes. Can be an array,\r\n\t *                      or splat (optional)\r\n\t */\r\n\tfunction m(tag, pairs) {\r\n\t\tvar args = []\r\n\r\n\t\tfor (var i = 1, length = arguments.length; i < length; i++) {\r\n\t\t\targs[i - 1] = arguments[i]\r\n\t\t}\r\n\r\n\t\tif (isObject(tag)) return parameterize(tag, args)\r\n\r\n\t\tif (!isString(tag)) {\r\n\t\t\tthrow new Error(\"selector in m(selector, attrs, children) should \" +\r\n\t\t\t\t\"be a string\")\r\n\t\t}\r\n\r\n\t\tvar hasAttrs = pairs != null && isObject(pairs) &&\r\n\t\t\t!(\"tag\" in pairs || \"view\" in pairs || \"subtree\" in pairs)\r\n\r\n\t\tvar attrs = hasAttrs ? pairs : {}\r\n\t\tvar cell = {\r\n\t\t\ttag: \"div\",\r\n\t\t\tattrs: {},\r\n\t\t\tchildren: getVirtualChildren(args, hasAttrs)\r\n\t\t}\r\n\r\n\t\tassignAttrs(cell.attrs, attrs, parseTagAttrs(cell, tag))\r\n\t\treturn cell\r\n\t}\r\n\r\n\tfunction forEach(list, f) {\r\n\t\tfor (var i = 0; i < list.length && !f(list[i], i++);) {\r\n\t\t\t// function called in condition\r\n\t\t}\r\n\t}\r\n\r\n\tfunction forKeys(list, f) {\r\n\t\tforEach(list, function (attrs, i) {\r\n\t\t\treturn (attrs = attrs && attrs.attrs) &&\r\n\t\t\t\tattrs.key != null &&\r\n\t\t\t\tf(attrs, i)\r\n\t\t})\r\n\t}\r\n\t// This function was causing deopts in Chrome.\r\n\tfunction dataToString(data) {\r\n\t\t// data.toString() might throw or return null if data is the return\r\n\t\t// value of Console.log in some versions of Firefox (behavior depends on\r\n\t\t// version)\r\n\t\ttry {\r\n\t\t\tif (data != null && data.toString() != null) return data\r\n\t\t} catch (e) {\r\n\t\t\t// silently ignore errors\r\n\t\t}\r\n\t\treturn \"\"\r\n\t}\r\n\r\n\t// This function was causing deopts in Chrome.\r\n\tfunction injectTextNode(parentElement, first, index, data) {\r\n\t\ttry {\r\n\t\t\tinsertNode(parentElement, first, index)\r\n\t\t\tfirst.nodeValue = data\r\n\t\t} catch (e) {\r\n\t\t\t// IE erroneously throws error when appending an empty text node\r\n\t\t\t// after a null\r\n\t\t}\r\n\t}\r\n\r\n\tfunction flatten(list) {\r\n\t\t// recursively flatten array\r\n\t\tfor (var i = 0; i < list.length; i++) {\r\n\t\t\tif (isArray(list[i])) {\r\n\t\t\t\tlist = list.concat.apply([], list)\r\n\t\t\t\t// check current index again and flatten until there are no more\r\n\t\t\t\t// nested arrays at that index\r\n\t\t\t\ti--\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn list\r\n\t}\r\n\r\n\tfunction insertNode(parentElement, node, index) {\r\n\t\tparentElement.insertBefore(node,\r\n\t\t\tparentElement.childNodes[index] || null)\r\n\t}\r\n\r\n\tvar DELETION = 1\r\n\tvar INSERTION = 2\r\n\tvar MOVE = 3\r\n\r\n\tfunction handleKeysDiffer(data, existing, cached, parentElement) {\r\n\t\tforKeys(data, function (key, i) {\r\n\t\t\texisting[key = key.key] = existing[key] ? {\r\n\t\t\t\taction: MOVE,\r\n\t\t\t\tindex: i,\r\n\t\t\t\tfrom: existing[key].index,\r\n\t\t\t\telement: cached.nodes[existing[key].index] ||\r\n\t\t\t\t\t$document.createElement(\"div\")\r\n\t\t\t} : {action: INSERTION, index: i}\r\n\t\t})\r\n\r\n\t\tvar actions = []\r\n\t\tfor (var prop in existing) {\r\n\t\t\tif (hasOwn.call(existing, prop)) {\r\n\t\t\t\tactions.push(existing[prop])\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar changes = actions.sort(sortChanges)\r\n\t\tvar newCached = new Array(cached.length)\r\n\r\n\t\tnewCached.nodes = cached.nodes.slice()\r\n\r\n\t\tforEach(changes, function (change) {\r\n\t\t\tvar index = change.index\r\n\t\t\tif (change.action === DELETION) {\r\n\t\t\t\tclear(cached[index].nodes, cached[index])\r\n\t\t\t\tnewCached.splice(index, 1)\r\n\t\t\t}\r\n\t\t\tif (change.action === INSERTION) {\r\n\t\t\t\tvar dummy = $document.createElement(\"div\")\r\n\t\t\t\tdummy.key = data[index].attrs.key\r\n\t\t\t\tinsertNode(parentElement, dummy, index)\r\n\t\t\t\tnewCached.splice(index, 0, {\r\n\t\t\t\t\tattrs: {key: data[index].attrs.key},\r\n\t\t\t\t\tnodes: [dummy]\r\n\t\t\t\t})\r\n\t\t\t\tnewCached.nodes[index] = dummy\r\n\t\t\t}\r\n\r\n\t\t\tif (change.action === MOVE) {\r\n\t\t\t\tvar changeElement = change.element\r\n\t\t\t\tvar maybeChanged = parentElement.childNodes[index]\r\n\t\t\t\tif (maybeChanged !== changeElement && changeElement !== null) {\r\n\t\t\t\t\tparentElement.insertBefore(changeElement,\r\n\t\t\t\t\t\tmaybeChanged || null)\r\n\t\t\t\t}\r\n\t\t\t\tnewCached[index] = cached[change.from]\r\n\t\t\t\tnewCached.nodes[index] = changeElement\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\treturn newCached\r\n\t}\r\n\r\n\tfunction diffKeys(data, cached, existing, parentElement) {\r\n\t\tvar keysDiffer = data.length !== cached.length\r\n\r\n\t\tif (!keysDiffer) {\r\n\t\t\tforKeys(data, function (attrs, i) {\r\n\t\t\t\tvar cachedCell = cached[i]\r\n\t\t\t\treturn keysDiffer = cachedCell &&\r\n\t\t\t\t\tcachedCell.attrs &&\r\n\t\t\t\t\tcachedCell.attrs.key !== attrs.key\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tif (keysDiffer) {\r\n\t\t\treturn handleKeysDiffer(data, existing, cached, parentElement)\r\n\t\t} else {\r\n\t\t\treturn cached\r\n\t\t}\r\n\t}\r\n\r\n\tfunction diffArray(data, cached, nodes) {\r\n\t\t// diff the array itself\r\n\r\n\t\t// update the list of DOM nodes by collecting the nodes from each item\r\n\t\tforEach(data, function (_, i) {\r\n\t\t\tif (cached[i] != null) nodes.push.apply(nodes, cached[i].nodes)\r\n\t\t})\r\n\t\t// remove items from the end of the array if the new array is shorter\r\n\t\t// than the old one. if errors ever happen here, the issue is most\r\n\t\t// likely a bug in the construction of the `cached` data structure\r\n\t\t// somewhere earlier in the program\r\n\t\tforEach(cached.nodes, function (node, i) {\r\n\t\t\tif (node.parentNode != null && nodes.indexOf(node) < 0) {\r\n\t\t\t\tclear([node], [cached[i]])\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tif (data.length < cached.length) cached.length = data.length\r\n\t\tcached.nodes = nodes\r\n\t}\r\n\r\n\tfunction buildArrayKeys(data) {\r\n\t\tvar guid = 0\r\n\t\tforKeys(data, function () {\r\n\t\t\tforEach(data, function (attrs) {\r\n\t\t\t\tif ((attrs = attrs && attrs.attrs) && attrs.key == null) {\r\n\t\t\t\t\tattrs.key = \"__mithril__\" + guid++\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\treturn 1\r\n\t\t})\r\n\t}\r\n\r\n\tfunction isDifferentEnough(data, cached, dataAttrKeys) {\r\n\t\tif (data.tag !== cached.tag) return true\r\n\r\n\t\tif (dataAttrKeys.sort().join() !==\r\n\t\t\t\tObject.keys(cached.attrs).sort().join()) {\r\n\t\t\treturn true\r\n\t\t}\r\n\r\n\t\tif (data.attrs.id !== cached.attrs.id) {\r\n\t\t\treturn true\r\n\t\t}\r\n\r\n\t\tif (data.attrs.key !== cached.attrs.key) {\r\n\t\t\treturn true\r\n\t\t}\r\n\r\n\t\tif (m.redraw.strategy() === \"all\") {\r\n\t\t\treturn !cached.configContext || cached.configContext.retain !== true\r\n\t\t}\r\n\r\n\t\tif (m.redraw.strategy() === \"diff\") {\r\n\t\t\treturn cached.configContext && cached.configContext.retain === false\r\n\t\t}\r\n\r\n\t\treturn false\r\n\t}\r\n\r\n\tfunction maybeRecreateObject(data, cached, dataAttrKeys) {\r\n\t\t// if an element is different enough from the one in cache, recreate it\r\n\t\tif (isDifferentEnough(data, cached, dataAttrKeys)) {\r\n\t\t\tif (cached.nodes.length) clear(cached.nodes)\r\n\r\n\t\t\tif (cached.configContext &&\r\n\t\t\t\t\tisFunction(cached.configContext.onunload)) {\r\n\t\t\t\tcached.configContext.onunload()\r\n\t\t\t}\r\n\r\n\t\t\tif (cached.controllers) {\r\n\t\t\t\tforEach(cached.controllers, function (controller) {\r\n\t\t\t\t\tif (controller.onunload) {\r\n\t\t\t\t\t\tcontroller.onunload({preventDefault: noop})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getObjectNamespace(data, namespace) {\r\n\t\tif (data.attrs.xmlns) return data.attrs.xmlns\r\n\t\tif (data.tag === \"svg\") return \"http://www.w3.org/2000/svg\"\r\n\t\tif (data.tag === \"math\") return \"http://www.w3.org/1998/Math/MathML\"\r\n\t\treturn namespace\r\n\t}\r\n\r\n\tvar pendingRequests = 0\r\n\tm.startComputation = function () { pendingRequests++ }\r\n\tm.endComputation = function () {\r\n\t\tif (pendingRequests > 1) {\r\n\t\t\tpendingRequests--\r\n\t\t} else {\r\n\t\t\tpendingRequests = 0\r\n\t\t\tm.redraw()\r\n\t\t}\r\n\t}\r\n\r\n\tfunction unloadCachedControllers(cached, views, controllers) {\r\n\t\tif (controllers.length) {\r\n\t\t\tcached.views = views\r\n\t\t\tcached.controllers = controllers\r\n\t\t\tforEach(controllers, function (controller) {\r\n\t\t\t\tif (controller.onunload && controller.onunload.$old) {\r\n\t\t\t\t\tcontroller.onunload = controller.onunload.$old\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (pendingRequests && controller.onunload) {\r\n\t\t\t\t\tvar onunload = controller.onunload\r\n\t\t\t\t\tcontroller.onunload = noop\r\n\t\t\t\t\tcontroller.onunload.$old = onunload\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tfunction scheduleConfigsToBeCalled(configs, data, node, isNew, cached) {\r\n\t\t// schedule configs to be called. They are called after `build` finishes\r\n\t\t// running\r\n\t\tif (isFunction(data.attrs.config)) {\r\n\t\t\tvar context = cached.configContext = cached.configContext || {}\r\n\r\n\t\t\t// bind\r\n\t\t\tconfigs.push(function () {\r\n\t\t\t\treturn data.attrs.config.call(data, node, !isNew, context,\r\n\t\t\t\t\tcached)\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tfunction buildUpdatedNode(\r\n\t\tcached,\r\n\t\tdata,\r\n\t\teditable,\r\n\t\thasKeys,\r\n\t\tnamespace,\r\n\t\tviews,\r\n\t\tconfigs,\r\n\t\tcontrollers\r\n\t) {\r\n\t\tvar node = cached.nodes[0]\r\n\r\n\t\tif (hasKeys) {\r\n\t\t\tsetAttributes(node, data.tag, data.attrs, cached.attrs, namespace)\r\n\t\t}\r\n\r\n\t\tcached.children = build(\r\n\t\t\tnode,\r\n\t\t\tdata.tag,\r\n\t\t\tundefined,\r\n\t\t\tundefined,\r\n\t\t\tdata.children,\r\n\t\t\tcached.children,\r\n\t\t\tfalse,\r\n\t\t\t0,\r\n\t\t\tdata.attrs.contenteditable ? node : editable,\r\n\t\t\tnamespace,\r\n\t\t\tconfigs\r\n\t\t)\r\n\r\n\t\tcached.nodes.intact = true\r\n\r\n\t\tif (controllers.length) {\r\n\t\t\tcached.views = views\r\n\t\t\tcached.controllers = controllers\r\n\t\t}\r\n\r\n\t\treturn node\r\n\t}\r\n\r\n\tfunction handleNonexistentNodes(data, parentElement, index) {\r\n\t\tvar nodes\r\n\t\tif (data.$trusted) {\r\n\t\t\tnodes = injectHTML(parentElement, index, data)\r\n\t\t} else {\r\n\t\t\tnodes = [$document.createTextNode(data)]\r\n\t\t\tif (!(parentElement.nodeName in voidElements)) {\r\n\t\t\t\tinsertNode(parentElement, nodes[0], index)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar cached\r\n\r\n\t\tif (typeof data === \"string\" ||\r\n\t\t\t\ttypeof data === \"number\" ||\r\n\t\t\t\ttypeof data === \"boolean\") {\r\n\t\t\tcached = new data.constructor(data)\r\n\t\t} else {\r\n\t\t\tcached = data\r\n\t\t}\r\n\r\n\t\tcached.nodes = nodes\r\n\t\treturn cached\r\n\t}\r\n\r\n\tfunction reattachNodes(\r\n\t\tdata,\r\n\t\tcached,\r\n\t\tparentElement,\r\n\t\teditable,\r\n\t\tindex,\r\n\t\tparentTag\r\n\t) {\r\n\t\tvar nodes = cached.nodes\r\n\t\tif (!editable || editable !== $document.activeElement) {\r\n\t\t\tif (data.$trusted) {\r\n\t\t\t\tclear(nodes, cached)\r\n\t\t\t\tnodes = injectHTML(parentElement, index, data)\r\n\t\t\t} else if (parentTag === \"textarea\") {\r\n\t\t\t\t// <textarea> uses `value` instead of `nodeValue`.\r\n\t\t\t\tparentElement.value = data\r\n\t\t\t} else if (editable) {\r\n\t\t\t\t// contenteditable nodes use `innerHTML` instead of `nodeValue`.\r\n\t\t\t\teditable.innerHTML = data\r\n\t\t\t} else {\r\n\t\t\t\t// was a trusted string\r\n\t\t\t\tif (nodes[0].nodeType === 1 || nodes.length > 1 ||\r\n\t\t\t\t\t\t(nodes[0].nodeValue.trim &&\r\n\t\t\t\t\t\t\t!nodes[0].nodeValue.trim())) {\r\n\t\t\t\t\tclear(cached.nodes, cached)\r\n\t\t\t\t\tnodes = [$document.createTextNode(data)]\r\n\t\t\t\t}\r\n\r\n\t\t\t\tinjectTextNode(parentElement, nodes[0], index, data)\r\n\t\t\t}\r\n\t\t}\r\n\t\tcached = new data.constructor(data)\r\n\t\tcached.nodes = nodes\r\n\t\treturn cached\r\n\t}\r\n\r\n\tfunction handleTextNode(\r\n\t\tcached,\r\n\t\tdata,\r\n\t\tindex,\r\n\t\tparentElement,\r\n\t\tshouldReattach,\r\n\t\teditable,\r\n\t\tparentTag\r\n\t) {\r\n\t\tif (!cached.nodes.length) {\r\n\t\t\treturn handleNonexistentNodes(data, parentElement, index)\r\n\t\t} else if (cached.valueOf() !== data.valueOf() || shouldReattach) {\r\n\t\t\treturn reattachNodes(data, cached, parentElement, editable, index,\r\n\t\t\t\tparentTag)\r\n\t\t} else {\r\n\t\t\treturn (cached.nodes.intact = true, cached)\r\n\t\t}\r\n\t}\r\n\r\n\tfunction getSubArrayCount(item) {\r\n\t\tif (item.$trusted) {\r\n\t\t\t// fix offset of next element if item was a trusted string w/ more\r\n\t\t\t// than one html element\r\n\t\t\t// the first clause in the regexp matches elements\r\n\t\t\t// the second clause (after the pipe) matches text nodes\r\n\t\t\tvar match = item.match(/<[^\\/]|\\>\\s*[^<]/g)\r\n\t\t\tif (match != null) return match.length\r\n\t\t} else if (isArray(item)) {\r\n\t\t\treturn item.length\r\n\t\t}\r\n\t\treturn 1\r\n\t}\r\n\r\n\tfunction buildArray(\r\n\t\tdata,\r\n\t\tcached,\r\n\t\tparentElement,\r\n\t\tindex,\r\n\t\tparentTag,\r\n\t\tshouldReattach,\r\n\t\teditable,\r\n\t\tnamespace,\r\n\t\tconfigs\r\n\t) {\r\n\t\tdata = flatten(data)\r\n\t\tvar nodes = []\r\n\t\tvar intact = cached.length === data.length\r\n\t\tvar subArrayCount = 0\r\n\r\n\t\t// keys algorithm: sort elements without recreating them if keys are\r\n\t\t// present\r\n\t\t//\r\n\t\t// 1) create a map of all existing keys, and mark all for deletion\r\n\t\t// 2) add new keys to map and mark them for addition\r\n\t\t// 3) if key exists in new list, change action from deletion to a move\r\n\t\t// 4) for each key, handle its corresponding action as marked in\r\n\t\t//    previous steps\r\n\r\n\t\tvar existing = {}\r\n\t\tvar shouldMaintainIdentities = false\r\n\r\n\t\tforKeys(cached, function (attrs, i) {\r\n\t\t\tshouldMaintainIdentities = true\r\n\t\t\texisting[cached[i].attrs.key] = {action: DELETION, index: i}\r\n\t\t})\r\n\r\n\t\tbuildArrayKeys(data)\r\n\t\tif (shouldMaintainIdentities) {\r\n\t\t\tcached = diffKeys(data, cached, existing, parentElement)\r\n\t\t}\r\n\t\t// end key algorithm\r\n\r\n\t\tvar cacheCount = 0\r\n\t\t// faster explicitly written\r\n\t\tfor (var i = 0, len = data.length; i < len; i++) {\r\n\t\t\t// diff each item in the array\r\n\t\t\tvar item = build(\r\n\t\t\t\tparentElement,\r\n\t\t\t\tparentTag,\r\n\t\t\t\tcached,\r\n\t\t\t\tindex,\r\n\t\t\t\tdata[i],\r\n\t\t\t\tcached[cacheCount],\r\n\t\t\t\tshouldReattach,\r\n\t\t\t\tindex + subArrayCount || subArrayCount,\r\n\t\t\t\teditable,\r\n\t\t\t\tnamespace,\r\n\t\t\t\tconfigs)\r\n\r\n\t\t\tif (item !== undefined) {\r\n\t\t\t\tintact = intact && item.nodes.intact\r\n\t\t\t\tsubArrayCount += getSubArrayCount(item)\r\n\t\t\t\tcached[cacheCount++] = item\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!intact) diffArray(data, cached, nodes)\r\n\t\treturn cached\r\n\t}\r\n\r\n\tfunction makeCache(data, cached, index, parentIndex, parentCache) {\r\n\t\tif (cached != null) {\r\n\t\t\tif (type.call(cached) === type.call(data)) return cached\r\n\r\n\t\t\tif (parentCache && parentCache.nodes) {\r\n\t\t\t\tvar offset = index - parentIndex\r\n\t\t\t\tvar end = offset + (isArray(data) ? data : cached.nodes).length\r\n\t\t\t\tclear(\r\n\t\t\t\t\tparentCache.nodes.slice(offset, end),\r\n\t\t\t\t\tparentCache.slice(offset, end))\r\n\t\t\t} else if (cached.nodes) {\r\n\t\t\t\tclear(cached.nodes, cached)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcached = new data.constructor()\r\n\t\t// if constructor creates a virtual dom element, use a blank object as\r\n\t\t// the base cached node instead of copying the virtual el (#277)\r\n\t\tif (cached.tag) cached = {}\r\n\t\tcached.nodes = []\r\n\t\treturn cached\r\n\t}\r\n\r\n\tfunction constructNode(data, namespace) {\r\n\t\tif (data.attrs.is) {\r\n\t\t\tif (namespace == null) {\r\n\t\t\t\treturn $document.createElement(data.tag, data.attrs.is)\r\n\t\t\t} else {\r\n\t\t\t\treturn $document.createElementNS(namespace, data.tag,\r\n\t\t\t\t\tdata.attrs.is)\r\n\t\t\t}\r\n\t\t} else if (namespace == null) {\r\n\t\t\treturn $document.createElement(data.tag)\r\n\t\t} else {\r\n\t\t\treturn $document.createElementNS(namespace, data.tag)\r\n\t\t}\r\n\t}\r\n\r\n\tfunction constructAttrs(data, node, namespace, hasKeys) {\r\n\t\tif (hasKeys) {\r\n\t\t\treturn setAttributes(node, data.tag, data.attrs, {}, namespace)\r\n\t\t} else {\r\n\t\t\treturn data.attrs\r\n\t\t}\r\n\t}\r\n\r\n\tfunction constructChildren(\r\n\t\tdata,\r\n\t\tnode,\r\n\t\tcached,\r\n\t\teditable,\r\n\t\tnamespace,\r\n\t\tconfigs\r\n\t) {\r\n\t\tif (data.children != null && data.children.length > 0) {\r\n\t\t\treturn build(\r\n\t\t\t\tnode,\r\n\t\t\t\tdata.tag,\r\n\t\t\t\tundefined,\r\n\t\t\t\tundefined,\r\n\t\t\t\tdata.children,\r\n\t\t\t\tcached.children,\r\n\t\t\t\ttrue,\r\n\t\t\t\t0,\r\n\t\t\t\tdata.attrs.contenteditable ? node : editable,\r\n\t\t\t\tnamespace,\r\n\t\t\t\tconfigs)\r\n\t\t} else {\r\n\t\t\treturn data.children\r\n\t\t}\r\n\t}\r\n\r\n\tfunction reconstructCached(\r\n\t\tdata,\r\n\t\tattrs,\r\n\t\tchildren,\r\n\t\tnode,\r\n\t\tnamespace,\r\n\t\tviews,\r\n\t\tcontrollers\r\n\t) {\r\n\t\tvar cached = {\r\n\t\t\ttag: data.tag,\r\n\t\t\tattrs: attrs,\r\n\t\t\tchildren: children,\r\n\t\t\tnodes: [node]\r\n\t\t}\r\n\r\n\t\tunloadCachedControllers(cached, views, controllers)\r\n\r\n\t\tif (cached.children && !cached.children.nodes) {\r\n\t\t\tcached.children.nodes = []\r\n\t\t}\r\n\r\n\t\t// edge case: setting value on <select> doesn't work before children\r\n\t\t// exist, so set it again after children have been created\r\n\t\tif (data.tag === \"select\" && \"value\" in data.attrs) {\r\n\t\t\tsetAttributes(node, data.tag, {value: data.attrs.value}, {},\r\n\t\t\t\tnamespace)\r\n\t\t}\r\n\r\n\t\treturn cached\r\n\t}\r\n\r\n\tfunction getController(views, view, cachedControllers, controller) {\r\n\t\tvar controllerIndex\r\n\r\n\t\tif (m.redraw.strategy() === \"diff\" && views) {\r\n\t\t\tcontrollerIndex = views.indexOf(view)\r\n\t\t} else {\r\n\t\t\tcontrollerIndex = -1\r\n\t\t}\r\n\r\n\t\tif (controllerIndex > -1) {\r\n\t\t\treturn cachedControllers[controllerIndex]\r\n\t\t} else if (isFunction(controller)) {\r\n\t\t\treturn new controller()\r\n\t\t} else {\r\n\t\t\treturn {}\r\n\t\t}\r\n\t}\r\n\r\n\tvar unloaders = []\r\n\r\n\tfunction updateLists(views, controllers, view, controller) {\r\n\t\tif (controller.onunload != null &&\r\n\t\t\t\tunloaders.map(function (u) { return u.handler })\r\n\t\t\t\t\t.indexOf(controller.onunload) < 0) {\r\n\t\t\tunloaders.push({\r\n\t\t\t\tcontroller: controller,\r\n\t\t\t\thandler: controller.onunload\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tviews.push(view)\r\n\t\tcontrollers.push(controller)\r\n\t}\r\n\r\n\tvar forcing = false\r\n\tfunction checkView(\r\n\t\tdata,\r\n\t\tview,\r\n\t\tcached,\r\n\t\tcachedControllers,\r\n\t\tcontrollers,\r\n\t\tviews\r\n\t) {\r\n\t\tvar controller = getController(\r\n\t\t\tcached.views,\r\n\t\t\tview,\r\n\t\t\tcachedControllers,\r\n\t\t\tdata.controller)\r\n\r\n\t\tvar key = data && data.attrs && data.attrs.key\r\n\r\n\t\tif (pendingRequests === 0 ||\r\n\t\t\t\tforcing ||\r\n\t\t\t\tcachedControllers &&\r\n\t\t\t\t\tcachedControllers.indexOf(controller) > -1) {\r\n\t\t\tdata = data.view(controller)\r\n\t\t} else {\r\n\t\t\tdata = {tag: \"placeholder\"}\r\n\t\t}\r\n\r\n\t\tif (data.subtree === \"retain\") return data\r\n\t\tdata.attrs = data.attrs || {}\r\n\t\tdata.attrs.key = key\r\n\t\tupdateLists(views, controllers, view, controller)\r\n\t\treturn data\r\n\t}\r\n\r\n\tfunction markViews(data, cached, views, controllers) {\r\n\t\tvar cachedControllers = cached && cached.controllers\r\n\r\n\t\twhile (data.view != null) {\r\n\t\t\tdata = checkView(\r\n\t\t\t\tdata,\r\n\t\t\t\tdata.view.$original || data.view,\r\n\t\t\t\tcached,\r\n\t\t\t\tcachedControllers,\r\n\t\t\t\tcontrollers,\r\n\t\t\t\tviews)\r\n\t\t}\r\n\r\n\t\treturn data\r\n\t}\r\n\r\n\tfunction buildObject( // eslint-disable-line max-statements\r\n\t\tdata,\r\n\t\tcached,\r\n\t\teditable,\r\n\t\tparentElement,\r\n\t\tindex,\r\n\t\tshouldReattach,\r\n\t\tnamespace,\r\n\t\tconfigs\r\n\t) {\r\n\t\tvar views = []\r\n\t\tvar controllers = []\r\n\r\n\t\tdata = markViews(data, cached, views, controllers)\r\n\r\n\t\tif (data.subtree === \"retain\") return cached\r\n\r\n\t\tif (!data.tag && controllers.length) {\r\n\t\t\tthrow new Error(\"Component template must return a virtual \" +\r\n\t\t\t\t\"element, not an array, string, etc.\")\r\n\t\t}\r\n\r\n\t\tdata.attrs = data.attrs || {}\r\n\t\tcached.attrs = cached.attrs || {}\r\n\r\n\t\tvar dataAttrKeys = Object.keys(data.attrs)\r\n\t\tvar hasKeys = dataAttrKeys.length > (\"key\" in data.attrs ? 1 : 0)\r\n\r\n\t\tmaybeRecreateObject(data, cached, dataAttrKeys)\r\n\r\n\t\tif (!isString(data.tag)) return\r\n\r\n\t\tvar isNew = cached.nodes.length === 0\r\n\r\n\t\tnamespace = getObjectNamespace(data, namespace)\r\n\r\n\t\tvar node\r\n\t\tif (isNew) {\r\n\t\t\tnode = constructNode(data, namespace)\r\n\t\t\t// set attributes first, then create children\r\n\t\t\tvar attrs = constructAttrs(data, node, namespace, hasKeys)\r\n\r\n\t\t\t// add the node to its parent before attaching children to it\r\n\t\t\tinsertNode(parentElement, node, index)\r\n\r\n\t\t\tvar children = constructChildren(data, node, cached, editable,\r\n\t\t\t\tnamespace, configs)\r\n\r\n\t\t\tcached = reconstructCached(\r\n\t\t\t\tdata,\r\n\t\t\t\tattrs,\r\n\t\t\t\tchildren,\r\n\t\t\t\tnode,\r\n\t\t\t\tnamespace,\r\n\t\t\t\tviews,\r\n\t\t\t\tcontrollers)\r\n\t\t} else {\r\n\t\t\tnode = buildUpdatedNode(\r\n\t\t\t\tcached,\r\n\t\t\t\tdata,\r\n\t\t\t\teditable,\r\n\t\t\t\thasKeys,\r\n\t\t\t\tnamespace,\r\n\t\t\t\tviews,\r\n\t\t\t\tconfigs,\r\n\t\t\t\tcontrollers)\r\n\t\t}\r\n\r\n\t\tif (!isNew && shouldReattach === true && node != null) {\r\n\t\t\tinsertNode(parentElement, node, index)\r\n\t\t}\r\n\r\n\t\t// The configs are called after `build` finishes running\r\n\t\tscheduleConfigsToBeCalled(configs, data, node, isNew, cached)\r\n\r\n\t\treturn cached\r\n\t}\r\n\r\n\tfunction build(\r\n\t\tparentElement,\r\n\t\tparentTag,\r\n\t\tparentCache,\r\n\t\tparentIndex,\r\n\t\tdata,\r\n\t\tcached,\r\n\t\tshouldReattach,\r\n\t\tindex,\r\n\t\teditable,\r\n\t\tnamespace,\r\n\t\tconfigs\r\n\t) {\r\n\t\t/*\r\n\t\t * `build` is a recursive function that manages creation/diffing/removal\r\n\t\t * of DOM elements based on comparison between `data` and `cached` the\r\n\t\t * diff algorithm can be summarized as this:\r\n\t\t *\r\n\t\t * 1 - compare `data` and `cached`\r\n\t\t * 2 - if they are different, copy `data` to `cached` and update the DOM\r\n\t\t *     based on what the difference is\r\n\t\t * 3 - recursively apply this algorithm for every array and for the\r\n\t\t *     children of every virtual element\r\n\t\t *\r\n\t\t * The `cached` data structure is essentially the same as the previous\r\n\t\t * redraw's `data` data structure, with a few additions:\r\n\t\t * - `cached` always has a property called `nodes`, which is a list of\r\n\t\t *    DOM elements that correspond to the data represented by the\r\n\t\t *    respective virtual element\r\n\t\t * - in order to support attaching `nodes` as a property of `cached`,\r\n\t\t *    `cached` is *always* a non-primitive object, i.e. if the data was\r\n\t\t *    a string, then cached is a String instance. If data was `null` or\r\n\t\t *    `undefined`, cached is `new String(\"\")`\r\n\t\t * - `cached also has a `configContext` property, which is the state\r\n\t\t *    storage object exposed by config(element, isInitialized, context)\r\n\t\t * - when `cached` is an Object, it represents a virtual element; when\r\n\t\t *    it's an Array, it represents a list of elements; when it's a\r\n\t\t *    String, Number or Boolean, it represents a text node\r\n\t\t *\r\n\t\t * `parentElement` is a DOM element used for W3C DOM API calls\r\n\t\t * `parentTag` is only used for handling a corner case for textarea\r\n\t\t * values\r\n\t\t * `parentCache` is used to remove nodes in some multi-node cases\r\n\t\t * `parentIndex` and `index` are used to figure out the offset of nodes.\r\n\t\t * They're artifacts from before arrays started being flattened and are\r\n\t\t * likely refactorable\r\n\t\t * `data` and `cached` are, respectively, the new and old nodes being\r\n\t\t * diffed\r\n\t\t * `shouldReattach` is a flag indicating whether a parent node was\r\n\t\t * recreated (if so, and if this node is reused, then this node must\r\n\t\t * reattach itself to the new parent)\r\n\t\t * `editable` is a flag that indicates whether an ancestor is\r\n\t\t * contenteditable\r\n\t\t * `namespace` indicates the closest HTML namespace as it cascades down\r\n\t\t * from an ancestor\r\n\t\t * `configs` is a list of config functions to run after the topmost\r\n\t\t * `build` call finishes running\r\n\t\t *\r\n\t\t * there's logic that relies on the assumption that null and undefined\r\n\t\t * data are equivalent to empty strings\r\n\t\t * - this prevents lifecycle surprises from procedural helpers that mix\r\n\t\t *   implicit and explicit return statements (e.g.\r\n\t\t *   function foo() {if (cond) return m(\"div\")}\r\n\t\t * - it simplifies diffing code\r\n\t\t */\r\n\t\tdata = dataToString(data)\r\n\t\tif (data.subtree === \"retain\") return cached\r\n\t\tcached = makeCache(data, cached, index, parentIndex, parentCache)\r\n\r\n\t\tif (isArray(data)) {\r\n\t\t\treturn buildArray(\r\n\t\t\t\tdata,\r\n\t\t\t\tcached,\r\n\t\t\t\tparentElement,\r\n\t\t\t\tindex,\r\n\t\t\t\tparentTag,\r\n\t\t\t\tshouldReattach,\r\n\t\t\t\teditable,\r\n\t\t\t\tnamespace,\r\n\t\t\t\tconfigs)\r\n\t\t} else if (data != null && isObject(data)) {\r\n\t\t\treturn buildObject(\r\n\t\t\t\tdata,\r\n\t\t\t\tcached,\r\n\t\t\t\teditable,\r\n\t\t\t\tparentElement,\r\n\t\t\t\tindex,\r\n\t\t\t\tshouldReattach,\r\n\t\t\t\tnamespace,\r\n\t\t\t\tconfigs)\r\n\t\t} else if (!isFunction(data)) {\r\n\t\t\treturn handleTextNode(\r\n\t\t\t\tcached,\r\n\t\t\t\tdata,\r\n\t\t\t\tindex,\r\n\t\t\t\tparentElement,\r\n\t\t\t\tshouldReattach,\r\n\t\t\t\teditable,\r\n\t\t\t\tparentTag)\r\n\t\t} else {\r\n\t\t\treturn cached\r\n\t\t}\r\n\t}\r\n\r\n\tfunction sortChanges(a, b) {\r\n\t\treturn a.action - b.action || a.index - b.index\r\n\t}\r\n\r\n\tfunction copyStyleAttrs(node, dataAttr, cachedAttr) {\r\n\t\tfor (var rule in dataAttr) {\r\n\t\t\tif (hasOwn.call(dataAttr, rule)) {\r\n\t\t\t\tif (cachedAttr == null || cachedAttr[rule] !== dataAttr[rule]) {\r\n\t\t\t\t\tnode.style[rule] = dataAttr[rule]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (rule in cachedAttr) {\r\n\t\t\tif (hasOwn.call(cachedAttr, rule)) {\r\n\t\t\t\tif (!hasOwn.call(dataAttr, rule)) node.style[rule] = \"\"\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tvar shouldUseSetAttribute = {\r\n\t\tlist: 1,\r\n\t\tstyle: 1,\r\n\t\tform: 1,\r\n\t\ttype: 1,\r\n\t\twidth: 1,\r\n\t\theight: 1\r\n\t}\r\n\r\n\tfunction setSingleAttr(\r\n\t\tnode,\r\n\t\tattrName,\r\n\t\tdataAttr,\r\n\t\tcachedAttr,\r\n\t\ttag,\r\n\t\tnamespace\r\n\t) {\r\n\t\tif (attrName === \"config\" || attrName === \"key\") {\r\n\t\t\t// `config` isn't a real attribute, so ignore it\r\n\t\t\treturn true\r\n\t\t} else if (isFunction(dataAttr) && attrName.slice(0, 2) === \"on\") {\r\n\t\t\t// hook event handlers to the auto-redrawing system\r\n\t\t\tnode[attrName] = autoredraw(dataAttr, node)\r\n\t\t} else if (attrName === \"style\" && dataAttr != null &&\r\n\t\t\t\tisObject(dataAttr)) {\r\n\t\t\t// handle `style: {...}`\r\n\t\t\tcopyStyleAttrs(node, dataAttr, cachedAttr)\r\n\t\t} else if (namespace != null) {\r\n\t\t\t// handle SVG\r\n\t\t\tif (attrName === \"href\") {\r\n\t\t\t\tnode.setAttributeNS(\"http://www.w3.org/1999/xlink\",\r\n\t\t\t\t\t\"href\", dataAttr)\r\n\t\t\t} else {\r\n\t\t\t\tnode.setAttribute(\r\n\t\t\t\t\tattrName === \"className\" ? \"class\" : attrName,\r\n\t\t\t\t\tdataAttr)\r\n\t\t\t}\r\n\t\t} else if (attrName in node && !shouldUseSetAttribute[attrName]) {\r\n\t\t\t// handle cases that are properties (but ignore cases where we\r\n\t\t\t// should use setAttribute instead)\r\n\t\t\t//\r\n\t\t\t// - list and form are typically used as strings, but are DOM\r\n\t\t\t//   element references in js\r\n\t\t\t//\r\n\t\t\t// - when using CSS selectors (e.g. `m(\"[style='']\")`), style is\r\n\t\t\t//   used as a string, but it's an object in js\r\n\t\t\t//\r\n\t\t\t// #348 don't set the value if not needed - otherwise, cursor\r\n\t\t\t// placement breaks in Chrome\r\n\t\t\ttry {\r\n\t\t\t\tif (tag !== \"input\" || node[attrName] !== dataAttr) {\r\n\t\t\t\t\tnode[attrName] = dataAttr\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tnode.setAttribute(attrName, dataAttr)\r\n\t\t\t}\r\n\t\t}\r\n\t\telse node.setAttribute(attrName, dataAttr)\r\n\t}\r\n\r\n\tfunction trySetAttr(\r\n\t\tnode,\r\n\t\tattrName,\r\n\t\tdataAttr,\r\n\t\tcachedAttr,\r\n\t\tcachedAttrs,\r\n\t\ttag,\r\n\t\tnamespace\r\n\t) {\r\n\t\tif (!(attrName in cachedAttrs) || (cachedAttr !== dataAttr) || ($document.activeElement === node)) {\r\n\t\t\tcachedAttrs[attrName] = dataAttr\r\n\t\t\ttry {\r\n\t\t\t\treturn setSingleAttr(\r\n\t\t\t\t\tnode,\r\n\t\t\t\t\tattrName,\r\n\t\t\t\t\tdataAttr,\r\n\t\t\t\t\tcachedAttr,\r\n\t\t\t\t\ttag,\r\n\t\t\t\t\tnamespace)\r\n\t\t\t} catch (e) {\r\n\t\t\t\t// swallow IE's invalid argument errors to mimic HTML's\r\n\t\t\t\t// fallback-to-doing-nothing-on-invalid-attributes behavior\r\n\t\t\t\tif (e.message.indexOf(\"Invalid argument\") < 0) throw e\r\n\t\t\t}\r\n\t\t} else if (attrName === \"value\" && tag === \"input\" &&\r\n\t\t\t\tnode.value !== dataAttr) {\r\n\t\t\t// #348 dataAttr may not be a string, so use loose comparison\r\n\t\t\tnode.value = dataAttr\r\n\t\t}\r\n\t}\r\n\r\n\tfunction setAttributes(node, tag, dataAttrs, cachedAttrs, namespace) {\r\n\t\tfor (var attrName in dataAttrs) {\r\n\t\t\tif (hasOwn.call(dataAttrs, attrName)) {\r\n\t\t\t\tif (trySetAttr(\r\n\t\t\t\t\t\tnode,\r\n\t\t\t\t\t\tattrName,\r\n\t\t\t\t\t\tdataAttrs[attrName],\r\n\t\t\t\t\t\tcachedAttrs[attrName],\r\n\t\t\t\t\t\tcachedAttrs,\r\n\t\t\t\t\t\ttag,\r\n\t\t\t\t\t\tnamespace)) {\r\n\t\t\t\t\tcontinue\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn cachedAttrs\r\n\t}\r\n\r\n\tfunction clear(nodes, cached) {\r\n\t\tfor (var i = nodes.length - 1; i > -1; i--) {\r\n\t\t\tif (nodes[i] && nodes[i].parentNode) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tnodes[i].parentNode.removeChild(nodes[i])\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\t/* eslint-disable max-len */\r\n\t\t\t\t\t// ignore if this fails due to order of events (see\r\n\t\t\t\t\t// http://stackoverflow.com/questions/21926083/failed-to-execute-removechild-on-node)\r\n\t\t\t\t\t/* eslint-enable max-len */\r\n\t\t\t\t}\r\n\t\t\t\tcached = [].concat(cached)\r\n\t\t\t\tif (cached[i]) unload(cached[i])\r\n\t\t\t}\r\n\t\t}\r\n\t\t// release memory if nodes is an array. This check should fail if nodes\r\n\t\t// is a NodeList (see loop above)\r\n\t\tif (nodes.length) {\r\n\t\t\tnodes.length = 0\r\n\t\t}\r\n\t}\r\n\r\n\tfunction unload(cached) {\r\n\t\tif (cached.configContext && isFunction(cached.configContext.onunload)) {\r\n\t\t\tcached.configContext.onunload()\r\n\t\t\tcached.configContext.onunload = null\r\n\t\t}\r\n\t\tif (cached.controllers) {\r\n\t\t\tforEach(cached.controllers, function (controller) {\r\n\t\t\t\tif (isFunction(controller.onunload)) {\r\n\t\t\t\t\tcontroller.onunload({preventDefault: noop})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t\tif (cached.children) {\r\n\t\t\tif (isArray(cached.children)) forEach(cached.children, unload)\r\n\t\t\telse if (cached.children.tag) unload(cached.children)\r\n\t\t}\r\n\t}\r\n\r\n\tfunction appendTextFragment(parentElement, data) {\r\n\t\ttry {\r\n\t\t\tparentElement.appendChild(\r\n\t\t\t\t$document.createRange().createContextualFragment(data))\r\n\t\t} catch (e) {\r\n\t\t\tparentElement.insertAdjacentHTML(\"beforeend\", data)\r\n\t\t\treplaceScriptNodes(parentElement)\r\n\t\t}\r\n\t}\r\n\r\n\t// Replace script tags inside given DOM element with executable ones.\r\n\t// Will also check children recursively and replace any found script\r\n\t// tags in same manner.\r\n\tfunction replaceScriptNodes(node) {\r\n\t\tif (node.tagName === \"SCRIPT\") {\r\n\t\t\tnode.parentNode.replaceChild(buildExecutableNode(node), node)\r\n\t\t} else {\r\n\t\t\tvar children = node.childNodes\r\n\t\t\tif (children && children.length) {\r\n\t\t\t\tfor (var i = 0; i < children.length; i++) {\r\n\t\t\t\t\treplaceScriptNodes(children[i])\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn node\r\n\t}\r\n\r\n\t// Replace script element with one whose contents are executable.\r\n\tfunction buildExecutableNode(node){\r\n\t\tvar scriptEl = document.createElement(\"script\")\r\n\t\tvar attrs = node.attributes\r\n\r\n\t\tfor (var i = 0; i < attrs.length; i++) {\r\n\t\t\tscriptEl.setAttribute(attrs[i].name, attrs[i].value)\r\n\t\t}\r\n\r\n\t\tscriptEl.text = node.innerHTML\r\n\t\treturn scriptEl\r\n\t}\r\n\r\n\tfunction injectHTML(parentElement, index, data) {\r\n\t\tvar nextSibling = parentElement.childNodes[index]\r\n\t\tif (nextSibling) {\r\n\t\t\tvar isElement = nextSibling.nodeType !== 1\r\n\t\t\tvar placeholder = $document.createElement(\"span\")\r\n\t\t\tif (isElement) {\r\n\t\t\t\tparentElement.insertBefore(placeholder, nextSibling || null)\r\n\t\t\t\tplaceholder.insertAdjacentHTML(\"beforebegin\", data)\r\n\t\t\t\tparentElement.removeChild(placeholder)\r\n\t\t\t} else {\r\n\t\t\t\tnextSibling.insertAdjacentHTML(\"beforebegin\", data)\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tappendTextFragment(parentElement, data)\r\n\t\t}\r\n\r\n\t\tvar nodes = []\r\n\r\n\t\twhile (parentElement.childNodes[index] !== nextSibling) {\r\n\t\t\tnodes.push(parentElement.childNodes[index])\r\n\t\t\tindex++\r\n\t\t}\r\n\r\n\t\treturn nodes\r\n\t}\r\n\r\n\tfunction autoredraw(callback, object) {\r\n\t\treturn function (e) {\r\n\t\t\te = e || event\r\n\t\t\tm.redraw.strategy(\"diff\")\r\n\t\t\tm.startComputation()\r\n\t\t\ttry {\r\n\t\t\t\treturn callback.call(object, e)\r\n\t\t\t} finally {\r\n\t\t\t\tendFirstComputation()\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tvar html\r\n\tvar documentNode = {\r\n\t\tappendChild: function (node) {\r\n\t\t\tif (html === undefined) html = $document.createElement(\"html\")\r\n\t\t\tif ($document.documentElement &&\r\n\t\t\t\t\t$document.documentElement !== node) {\r\n\t\t\t\t$document.replaceChild(node, $document.documentElement)\r\n\t\t\t} else {\r\n\t\t\t\t$document.appendChild(node)\r\n\t\t\t}\r\n\r\n\t\t\tthis.childNodes = $document.childNodes\r\n\t\t},\r\n\r\n\t\tinsertBefore: function (node) {\r\n\t\t\tthis.appendChild(node)\r\n\t\t},\r\n\r\n\t\tchildNodes: []\r\n\t}\r\n\r\n\tvar nodeCache = []\r\n\tvar cellCache = {}\r\n\r\n\tm.render = function (root, cell, forceRecreation) {\r\n\t\tif (!root) {\r\n\t\t\tthrow new Error(\"Ensure the DOM element being passed to \" +\r\n\t\t\t\t\"m.route/m.mount/m.render is not undefined.\")\r\n\t\t}\r\n\t\tvar configs = []\r\n\t\tvar id = getCellCacheKey(root)\r\n\t\tvar isDocumentRoot = root === $document\r\n\t\tvar node\r\n\r\n\t\tif (isDocumentRoot || root === $document.documentElement) {\r\n\t\t\tnode = documentNode\r\n\t\t} else {\r\n\t\t\tnode = root\r\n\t\t}\r\n\r\n\t\tif (isDocumentRoot && cell.tag !== \"html\") {\r\n\t\t\tcell = {tag: \"html\", attrs: {}, children: cell}\r\n\t\t}\r\n\r\n\t\tif (cellCache[id] === undefined) clear(node.childNodes)\r\n\t\tif (forceRecreation === true) reset(root)\r\n\r\n\t\tcellCache[id] = build(\r\n\t\t\tnode,\r\n\t\t\tnull,\r\n\t\t\tundefined,\r\n\t\t\tundefined,\r\n\t\t\tcell,\r\n\t\t\tcellCache[id],\r\n\t\t\tfalse,\r\n\t\t\t0,\r\n\t\t\tnull,\r\n\t\t\tundefined,\r\n\t\t\tconfigs)\r\n\r\n\t\tforEach(configs, function (config) { config() })\r\n\t}\r\n\r\n\tfunction getCellCacheKey(element) {\r\n\t\tvar index = nodeCache.indexOf(element)\r\n\t\treturn index < 0 ? nodeCache.push(element) - 1 : index\r\n\t}\r\n\r\n\tm.trust = function (value) {\r\n\t\tvalue = new String(value) // eslint-disable-line no-new-wrappers\r\n\t\tvalue.$trusted = true\r\n\t\treturn value\r\n\t}\r\n\r\n\tfunction gettersetter(store) {\r\n\t\tfunction prop() {\r\n\t\t\tif (arguments.length) store = arguments[0]\r\n\t\t\treturn store\r\n\t\t}\r\n\r\n\t\tprop.toJSON = function () {\r\n\t\t\treturn store\r\n\t\t}\r\n\r\n\t\treturn prop\r\n\t}\r\n\r\n\tm.prop = function (store) {\r\n\t\tif ((store != null && (isObject(store) || isFunction(store)) || ((typeof Promise !== \"undefined\") && (store instanceof Promise))) &&\r\n\t\t\t\tisFunction(store.then)) {\r\n\t\t\treturn propify(store)\r\n\t\t}\r\n\r\n\t\treturn gettersetter(store)\r\n\t}\r\n\r\n\tvar roots = []\r\n\tvar components = []\r\n\tvar controllers = []\r\n\tvar lastRedrawId = null\r\n\tvar lastRedrawCallTime = 0\r\n\tvar computePreRedrawHook = null\r\n\tvar computePostRedrawHook = null\r\n\tvar topComponent\r\n\tvar FRAME_BUDGET = 16 // 60 frames per second = 1 call per 16 ms\r\n\r\n\tfunction parameterize(component, args) {\r\n\t\tfunction controller() {\r\n\t\t\t/* eslint-disable no-invalid-this */\r\n\t\t\treturn (component.controller || noop).apply(this, args) || this\r\n\t\t\t/* eslint-enable no-invalid-this */\r\n\t\t}\r\n\r\n\t\tif (component.controller) {\r\n\t\t\tcontroller.prototype = component.controller.prototype\r\n\t\t}\r\n\r\n\t\tfunction view(ctrl) {\r\n\t\t\tvar currentArgs = [ctrl].concat(args)\r\n\t\t\tfor (var i = 1; i < arguments.length; i++) {\r\n\t\t\t\tcurrentArgs.push(arguments[i])\r\n\t\t\t}\r\n\r\n\t\t\treturn component.view.apply(component, currentArgs)\r\n\t\t}\r\n\r\n\t\tview.$original = component.view\r\n\t\tvar output = {controller: controller, view: view}\r\n\t\tif (args[0] && args[0].key != null) output.attrs = {key: args[0].key}\r\n\t\treturn output\r\n\t}\r\n\r\n\tm.component = function (component) {\r\n\t\tvar args = new Array(arguments.length - 1)\r\n\r\n\t\tfor (var i = 1; i < arguments.length; i++) {\r\n\t\t\targs[i - 1] = arguments[i]\r\n\t\t}\r\n\r\n\t\treturn parameterize(component, args)\r\n\t}\r\n\r\n\tfunction checkPrevented(component, root, index, isPrevented) {\r\n\t\tif (!isPrevented) {\r\n\t\t\tm.redraw.strategy(\"all\")\r\n\t\t\tm.startComputation()\r\n\t\t\troots[index] = root\r\n\t\t\tvar currentComponent\r\n\r\n\t\t\tif (component) {\r\n\t\t\t\tcurrentComponent = topComponent = component\r\n\t\t\t} else {\r\n\t\t\t\tcurrentComponent = topComponent = component = {controller: noop}\r\n\t\t\t}\r\n\r\n\t\t\tvar controller = new (component.controller || noop)()\r\n\r\n\t\t\t// controllers may call m.mount recursively (via m.route redirects,\r\n\t\t\t// for example)\r\n\t\t\t// this conditional ensures only the last recursive m.mount call is\r\n\t\t\t// applied\r\n\t\t\tif (currentComponent === topComponent) {\r\n\t\t\t\tcontrollers[index] = controller\r\n\t\t\t\tcomponents[index] = component\r\n\t\t\t}\r\n\t\t\tendFirstComputation()\r\n\t\t\tif (component === null) {\r\n\t\t\t\tremoveRootElement(root, index)\r\n\t\t\t}\r\n\t\t\treturn controllers[index]\r\n\t\t} else if (component == null) {\r\n\t\t\tremoveRootElement(root, index)\r\n\t\t}\r\n\t}\r\n\r\n\tm.mount = m.module = function (root, component) {\r\n\t\tif (!root) {\r\n\t\t\tthrow new Error(\"Please ensure the DOM element exists before \" +\r\n\t\t\t\t\"rendering a template into it.\")\r\n\t\t}\r\n\r\n\t\tvar index = roots.indexOf(root)\r\n\t\tif (index < 0) index = roots.length\r\n\r\n\t\tvar isPrevented = false\r\n\t\tvar event = {\r\n\t\t\tpreventDefault: function () {\r\n\t\t\t\tisPrevented = true\r\n\t\t\t\tcomputePreRedrawHook = computePostRedrawHook = null\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tforEach(unloaders, function (unloader) {\r\n\t\t\tunloader.handler.call(unloader.controller, event)\r\n\t\t\tunloader.controller.onunload = null\r\n\t\t})\r\n\r\n\t\tif (isPrevented) {\r\n\t\t\tforEach(unloaders, function (unloader) {\r\n\t\t\t\tunloader.controller.onunload = unloader.handler\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tunloaders = []\r\n\t\t}\r\n\r\n\t\tif (controllers[index] && isFunction(controllers[index].onunload)) {\r\n\t\t\tcontrollers[index].onunload(event)\r\n\t\t}\r\n\r\n\t\treturn checkPrevented(component, root, index, isPrevented)\r\n\t}\r\n\r\n\tfunction removeRootElement(root, index) {\r\n\t\troots.splice(index, 1)\r\n\t\tcontrollers.splice(index, 1)\r\n\t\tcomponents.splice(index, 1)\r\n\t\treset(root)\r\n\t\tnodeCache.splice(getCellCacheKey(root), 1)\r\n\t}\r\n\r\n\tvar redrawing = false\r\n\tm.redraw = function (force) {\r\n\t\tif (redrawing) return\r\n\t\tredrawing = true\r\n\t\tif (force) forcing = true\r\n\r\n\t\ttry {\r\n\t\t\t// lastRedrawId is a positive number if a second redraw is requested\r\n\t\t\t// before the next animation frame\r\n\t\t\t// lastRedrawId is null if it's the first redraw and not an event\r\n\t\t\t// handler\r\n\t\t\tif (lastRedrawId && !force) {\r\n\t\t\t\t// when setTimeout: only reschedule redraw if time between now\r\n\t\t\t\t// and previous redraw is bigger than a frame, otherwise keep\r\n\t\t\t\t// currently scheduled timeout\r\n\t\t\t\t// when rAF: always reschedule redraw\r\n\t\t\t\tif ($requestAnimationFrame === global.requestAnimationFrame ||\r\n\t\t\t\t\t\tnew Date() - lastRedrawCallTime > FRAME_BUDGET) {\r\n\t\t\t\t\tif (lastRedrawId > 0) $cancelAnimationFrame(lastRedrawId)\r\n\t\t\t\t\tlastRedrawId = $requestAnimationFrame(redraw, FRAME_BUDGET)\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tredraw()\r\n\t\t\t\tlastRedrawId = $requestAnimationFrame(function () {\r\n\t\t\t\t\tlastRedrawId = null\r\n\t\t\t\t}, FRAME_BUDGET)\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tredrawing = forcing = false\r\n\t\t}\r\n\t}\r\n\r\n\tm.redraw.strategy = m.prop()\r\n\tfunction redraw() {\r\n\t\tif (computePreRedrawHook) {\r\n\t\t\tcomputePreRedrawHook()\r\n\t\t\tcomputePreRedrawHook = null\r\n\t\t}\r\n\t\tforEach(roots, function (root, i) {\r\n\t\t\tvar component = components[i]\r\n\t\t\tif (controllers[i]) {\r\n\t\t\t\tvar args = [controllers[i]]\r\n\t\t\t\tm.render(root,\r\n\t\t\t\t\tcomponent.view ? component.view(controllers[i], args) : \"\")\r\n\t\t\t}\r\n\t\t})\r\n\t\t// after rendering within a routed context, we need to scroll back to\r\n\t\t// the top, and fetch the document title for history.pushState\r\n\t\tif (computePostRedrawHook) {\r\n\t\t\tcomputePostRedrawHook()\r\n\t\t\tcomputePostRedrawHook = null\r\n\t\t}\r\n\t\tlastRedrawId = null\r\n\t\tlastRedrawCallTime = new Date()\r\n\t\tm.redraw.strategy(\"diff\")\r\n\t}\r\n\r\n\tfunction endFirstComputation() {\r\n\t\tif (m.redraw.strategy() === \"none\") {\r\n\t\t\tpendingRequests--\r\n\t\t\tm.redraw.strategy(\"diff\")\r\n\t\t} else {\r\n\t\t\tm.endComputation()\r\n\t\t}\r\n\t}\r\n\r\n\tm.withAttr = function (prop, withAttrCallback, callbackThis) {\r\n\t\treturn function (e) {\r\n\t\t\te = e || window.event\r\n\t\t\t/* eslint-disable no-invalid-this */\r\n\t\t\tvar currentTarget = e.currentTarget || this\r\n\t\t\tvar _this = callbackThis || this\r\n\t\t\t/* eslint-enable no-invalid-this */\r\n\t\t\tvar target = prop in currentTarget ?\r\n\t\t\t\tcurrentTarget[prop] :\r\n\t\t\t\tcurrentTarget.getAttribute(prop)\r\n\t\t\twithAttrCallback.call(_this, target)\r\n\t\t}\r\n\t}\r\n\r\n\t// routing\r\n\tvar modes = {pathname: \"\", hash: \"#\", search: \"?\"}\r\n\tvar redirect = noop\r\n\tvar isDefaultRoute = false\r\n\tvar routeParams, currentRoute\r\n\r\n\tm.route = function (root, arg1, arg2, vdom) { // eslint-disable-line\r\n\t\t// m.route()\r\n\t\tif (arguments.length === 0) return currentRoute\r\n\t\t// m.route(el, defaultRoute, routes)\r\n\t\tif (arguments.length === 3 && isString(arg1)) {\r\n\t\t\tredirect = function (source) {\r\n\t\t\t\tvar path = currentRoute = normalizeRoute(source)\r\n\t\t\t\tif (!routeByValue(root, arg2, path)) {\r\n\t\t\t\t\tif (isDefaultRoute) {\r\n\t\t\t\t\t\tthrow new Error(\"Ensure the default route matches \" +\r\n\t\t\t\t\t\t\t\"one of the routes defined in m.route\")\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tisDefaultRoute = true\r\n\t\t\t\t\tm.route(arg1, true)\r\n\t\t\t\t\tisDefaultRoute = false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar listener = m.route.mode === \"hash\" ?\r\n\t\t\t\t\"onhashchange\" :\r\n\t\t\t\t\"onpopstate\"\r\n\r\n\t\t\tglobal[listener] = function () {\r\n\t\t\t\tvar path = $location[m.route.mode]\r\n\t\t\t\tif (m.route.mode === \"pathname\") path += $location.search\r\n\t\t\t\tif (currentRoute !== normalizeRoute(path)) redirect(path)\r\n\t\t\t}\r\n\r\n\t\t\tcomputePreRedrawHook = setScroll\r\n\t\t\tglobal[listener]()\r\n\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\t// config: m.route\r\n\t\tif (root.addEventListener || root.attachEvent) {\r\n\t\t\tvar base = m.route.mode !== \"pathname\" ? $location.pathname : \"\"\r\n\t\t\troot.href = base + modes[m.route.mode] + vdom.attrs.href\r\n\t\t\tif (root.addEventListener) {\r\n\t\t\t\troot.removeEventListener(\"click\", routeUnobtrusive)\r\n\t\t\t\troot.addEventListener(\"click\", routeUnobtrusive)\r\n\t\t\t} else {\r\n\t\t\t\troot.detachEvent(\"onclick\", routeUnobtrusive)\r\n\t\t\t\troot.attachEvent(\"onclick\", routeUnobtrusive)\r\n\t\t\t}\r\n\r\n\t\t\treturn\r\n\t\t}\r\n\t\t// m.route(route, params, shouldReplaceHistoryEntry)\r\n\t\tif (isString(root)) {\r\n\t\t\tvar oldRoute = currentRoute\r\n\t\t\tcurrentRoute = root\r\n\r\n\t\t\tvar args = arg1 || {}\r\n\t\t\tvar queryIndex = currentRoute.indexOf(\"?\")\r\n\t\t\tvar params\r\n\r\n\t\t\tif (queryIndex > -1) {\r\n\t\t\t\tparams = parseQueryString(currentRoute.slice(queryIndex + 1))\r\n\t\t\t} else {\r\n\t\t\t\tparams = {}\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i in args) {\r\n\t\t\t\tif (hasOwn.call(args, i)) {\r\n\t\t\t\t\tparams[i] = args[i]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar querystring = buildQueryString(params)\r\n\t\t\tvar currentPath\r\n\r\n\t\t\tif (queryIndex > -1) {\r\n\t\t\t\tcurrentPath = currentRoute.slice(0, queryIndex)\r\n\t\t\t} else {\r\n\t\t\t\tcurrentPath = currentRoute\r\n\t\t\t}\r\n\r\n\t\t\tif (querystring) {\r\n\t\t\t\tcurrentRoute = currentPath +\r\n\t\t\t\t\t(currentPath.indexOf(\"?\") === -1 ? \"?\" : \"&\") +\r\n\t\t\t\t\tquerystring\r\n\t\t\t}\r\n\r\n\t\t\tvar replaceHistory =\r\n\t\t\t\t(arguments.length === 3 ? arg2 : arg1) === true ||\r\n\t\t\t\toldRoute === root\r\n\r\n\t\t\tif (global.history.pushState) {\r\n\t\t\t\tvar method = replaceHistory ? \"replaceState\" : \"pushState\"\r\n\t\t\t\tcomputePreRedrawHook = setScroll\r\n\t\t\t\tcomputePostRedrawHook = function () {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tglobal.history[method](null, $document.title,\r\n\t\t\t\t\t\t\tmodes[m.route.mode] + currentRoute)\r\n\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\t// In the event of a pushState or replaceState failure,\r\n\t\t\t\t\t\t// fallback to a standard redirect. This is specifically\r\n\t\t\t\t\t\t// to address a Safari security error when attempting to\r\n\t\t\t\t\t\t// call pushState more than 100 times.\r\n\t\t\t\t\t\t$location[m.route.mode] = currentRoute\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tredirect(modes[m.route.mode] + currentRoute)\r\n\t\t\t} else {\r\n\t\t\t\t$location[m.route.mode] = currentRoute\r\n\t\t\t\tredirect(modes[m.route.mode] + currentRoute)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tm.route.param = function (key) {\r\n\t\tif (!routeParams) {\r\n\t\t\tthrow new Error(\"You must call m.route(element, defaultRoute, \" +\r\n\t\t\t\t\"routes) before calling m.route.param()\")\r\n\t\t}\r\n\r\n\t\tif (!key) {\r\n\t\t\treturn routeParams\r\n\t\t}\r\n\r\n\t\treturn routeParams[key]\r\n\t}\r\n\r\n\tm.route.mode = \"search\"\r\n\r\n\tfunction normalizeRoute(route) {\r\n\t\treturn route.slice(modes[m.route.mode].length)\r\n\t}\r\n\r\n\tfunction routeByValue(root, router, path) {\r\n\t\trouteParams = {}\r\n\r\n\t\tvar queryStart = path.indexOf(\"?\")\r\n\t\tif (queryStart !== -1) {\r\n\t\t\trouteParams = parseQueryString(\r\n\t\t\t\tpath.substr(queryStart + 1, path.length))\r\n\t\t\tpath = path.substr(0, queryStart)\r\n\t\t}\r\n\r\n\t\t// Get all routes and check if there's\r\n\t\t// an exact match for the current path\r\n\t\tvar keys = Object.keys(router)\r\n\t\tvar index = keys.indexOf(path)\r\n\r\n\t\tif (index !== -1){\r\n\t\t\tm.mount(root, router[keys [index]])\r\n\t\t\treturn true\r\n\t\t}\r\n\r\n\t\tfor (var route in router) {\r\n\t\t\tif (hasOwn.call(router, route)) {\r\n\t\t\t\tif (route === path) {\r\n\t\t\t\t\tm.mount(root, router[route])\r\n\t\t\t\t\treturn true\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar matcher = new RegExp(\"^\" + route\r\n\t\t\t\t\t.replace(/:[^\\/]+?\\.{3}/g, \"(.*?)\")\r\n\t\t\t\t\t.replace(/:[^\\/]+/g, \"([^\\\\/]+)\") + \"\\/?$\")\r\n\r\n\t\t\t\tif (matcher.test(path)) {\r\n\t\t\t\t\t/* eslint-disable no-loop-func */\r\n\t\t\t\t\tpath.replace(matcher, function () {\r\n\t\t\t\t\t\tvar keys = route.match(/:[^\\/]+/g) || []\r\n\t\t\t\t\t\tvar values = [].slice.call(arguments, 1, -2)\r\n\t\t\t\t\t\tforEach(keys, function (key, i) {\r\n\t\t\t\t\t\t\trouteParams[key.replace(/:|\\./g, \"\")] =\r\n\t\t\t\t\t\t\t\tdecodeURIComponent(values[i])\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tm.mount(root, router[route])\r\n\t\t\t\t\t})\r\n\t\t\t\t\t/* eslint-enable no-loop-func */\r\n\t\t\t\t\treturn true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction routeUnobtrusive(e) {\r\n\t\te = e || event\r\n\t\tif (e.ctrlKey || e.metaKey || e.shiftKey || e.which === 2) return\r\n\r\n\t\tif (e.preventDefault) {\r\n\t\t\te.preventDefault()\r\n\t\t} else {\r\n\t\t\te.returnValue = false\r\n\t\t}\r\n\r\n\t\tvar currentTarget = e.currentTarget || e.srcElement\r\n\t\tvar args\r\n\r\n\t\tif (m.route.mode === \"pathname\" && currentTarget.search) {\r\n\t\t\targs = parseQueryString(currentTarget.search.slice(1))\r\n\t\t} else {\r\n\t\t\targs = {}\r\n\t\t}\r\n\r\n\t\twhile (currentTarget && !/a/i.test(currentTarget.nodeName)) {\r\n\t\t\tcurrentTarget = currentTarget.parentNode\r\n\t\t}\r\n\r\n\t\t// clear pendingRequests because we want an immediate route change\r\n\t\tpendingRequests = 0\r\n\t\tm.route(currentTarget[m.route.mode]\r\n\t\t\t.slice(modes[m.route.mode].length), args)\r\n\t}\r\n\r\n\tfunction setScroll() {\r\n\t\tif (m.route.mode !== \"hash\" && $location.hash) {\r\n\t\t\t$location.hash = $location.hash\r\n\t\t} else {\r\n\t\t\tglobal.scrollTo(0, 0)\r\n\t\t}\r\n\t}\r\n\r\n\tfunction buildQueryString(object, prefix) {\r\n\t\tvar duplicates = {}\r\n\t\tvar str = []\r\n\r\n\t\tfor (var prop in object) {\r\n\t\t\tif (hasOwn.call(object, prop)) {\r\n\t\t\t\tvar key = prefix ? prefix + \"[\" + prop + \"]\" : prop\r\n\t\t\t\tvar value = object[prop]\r\n\r\n\t\t\t\tif (value === null) {\r\n\t\t\t\t\tstr.push(encodeURIComponent(key))\r\n\t\t\t\t} else if (isObject(value)) {\r\n\t\t\t\t\tstr.push(buildQueryString(value, key))\r\n\t\t\t\t} else if (isArray(value)) {\r\n\t\t\t\t\tvar keys = []\r\n\t\t\t\t\tduplicates[key] = duplicates[key] || {}\r\n\t\t\t\t\t/* eslint-disable no-loop-func */\r\n\t\t\t\t\tforEach(value, function (item) {\r\n\t\t\t\t\t\t/* eslint-enable no-loop-func */\r\n\t\t\t\t\t\tif (!duplicates[key][item]) {\r\n\t\t\t\t\t\t\tduplicates[key][item] = true\r\n\t\t\t\t\t\t\tkeys.push(encodeURIComponent(key) + \"=\" +\r\n\t\t\t\t\t\t\t\tencodeURIComponent(item))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\tstr.push(keys.join(\"&\"))\r\n\t\t\t\t} else if (value !== undefined) {\r\n\t\t\t\t\tstr.push(encodeURIComponent(key) + \"=\" +\r\n\t\t\t\t\t\tencodeURIComponent(value))\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn str.join(\"&\")\r\n\t}\r\n\r\n\tfunction parseQueryString(str) {\r\n\t\tif (str === \"\" || str == null) return {}\r\n\t\tif (str.charAt(0) === \"?\") str = str.slice(1)\r\n\r\n\t\tvar pairs = str.split(\"&\")\r\n\t\tvar params = {}\r\n\r\n\t\tforEach(pairs, function (string) {\r\n\t\t\tvar pair = string.split(\"=\")\r\n\t\t\tvar key = decodeURIComponent(pair[0])\r\n\t\t\tvar value = pair.length === 2 ? decodeURIComponent(pair[1]) : null\r\n\t\t\tif (params[key] != null) {\r\n\t\t\t\tif (!isArray(params[key])) params[key] = [params[key]]\r\n\t\t\t\tparams[key].push(value)\r\n\t\t\t}\r\n\t\t\telse params[key] = value\r\n\t\t})\r\n\r\n\t\treturn params\r\n\t}\r\n\r\n\tm.route.buildQueryString = buildQueryString\r\n\tm.route.parseQueryString = parseQueryString\r\n\r\n\tfunction reset(root) {\r\n\t\tvar cacheKey = getCellCacheKey(root)\r\n\t\tclear(root.childNodes, cellCache[cacheKey])\r\n\t\tcellCache[cacheKey] = undefined\r\n\t}\r\n\r\n\tm.deferred = function () {\r\n\t\tvar deferred = new Deferred()\r\n\t\tdeferred.promise = propify(deferred.promise)\r\n\t\treturn deferred\r\n\t}\r\n\r\n\tfunction propify(promise, initialValue) {\r\n\t\tvar prop = m.prop(initialValue)\r\n\t\tpromise.then(prop)\r\n\t\tprop.then = function (resolve, reject) {\r\n\t\t\treturn propify(promise.then(resolve, reject), initialValue)\r\n\t\t}\r\n\r\n\t\tprop.catch = prop.then.bind(null, null)\r\n\t\treturn prop\r\n\t}\r\n\t// Promiz.mithril.js | Zolmeister | MIT\r\n\t// a modified version of Promiz.js, which does not conform to Promises/A+\r\n\t// for two reasons:\r\n\t//\r\n\t// 1) `then` callbacks are called synchronously (because setTimeout is too\r\n\t//    slow, and the setImmediate polyfill is too big\r\n\t//\r\n\t// 2) throwing subclasses of Error cause the error to be bubbled up instead\r\n\t//    of triggering rejection (because the spec does not account for the\r\n\t//    important use case of default browser error handling, i.e. message w/\r\n\t//    line number)\r\n\r\n\tvar RESOLVING = 1\r\n\tvar REJECTING = 2\r\n\tvar RESOLVED = 3\r\n\tvar REJECTED = 4\r\n\r\n\tfunction Deferred(onSuccess, onFailure) {\r\n\t\tvar self = this\r\n\t\tvar state = 0\r\n\t\tvar promiseValue = 0\r\n\t\tvar next = []\r\n\r\n\t\tself.promise = {}\r\n\r\n\t\tself.resolve = function (value) {\r\n\t\t\tif (!state) {\r\n\t\t\t\tpromiseValue = value\r\n\t\t\t\tstate = RESOLVING\r\n\r\n\t\t\t\tfire()\r\n\t\t\t}\r\n\r\n\t\t\treturn self\r\n\t\t}\r\n\r\n\t\tself.reject = function (value) {\r\n\t\t\tif (!state) {\r\n\t\t\t\tpromiseValue = value\r\n\t\t\t\tstate = REJECTING\r\n\r\n\t\t\t\tfire()\r\n\t\t\t}\r\n\r\n\t\t\treturn self\r\n\t\t}\r\n\r\n\t\tself.promise.then = function (onSuccess, onFailure) {\r\n\t\t\tvar deferred = new Deferred(onSuccess, onFailure)\r\n\r\n\t\t\tif (state === RESOLVED) {\r\n\t\t\t\tdeferred.resolve(promiseValue)\r\n\t\t\t} else if (state === REJECTED) {\r\n\t\t\t\tdeferred.reject(promiseValue)\r\n\t\t\t} else {\r\n\t\t\t\tnext.push(deferred)\r\n\t\t\t}\r\n\r\n\t\t\treturn deferred.promise\r\n\t\t}\r\n\r\n\t\tfunction finish(type) {\r\n\t\t\tstate = type || REJECTED\r\n\t\t\tnext.map(function (deferred) {\r\n\t\t\t\tif (state === RESOLVED) {\r\n\t\t\t\t\tdeferred.resolve(promiseValue)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdeferred.reject(promiseValue)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tfunction thennable(then, success, failure, notThennable) {\r\n\t\t\tif (((promiseValue != null && isObject(promiseValue)) ||\r\n\t\t\t\t\tisFunction(promiseValue)) && isFunction(then)) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// count protects against abuse calls from spec checker\r\n\t\t\t\t\tvar count = 0\r\n\t\t\t\t\tthen.call(promiseValue, function (value) {\r\n\t\t\t\t\t\tif (count++) return\r\n\t\t\t\t\t\tpromiseValue = value\r\n\t\t\t\t\t\tsuccess()\r\n\t\t\t\t\t}, function (value) {\r\n\t\t\t\t\t\tif (count++) return\r\n\t\t\t\t\t\tpromiseValue = value\r\n\t\t\t\t\t\tfailure()\r\n\t\t\t\t\t})\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tm.deferred.onerror(e)\r\n\t\t\t\t\tpromiseValue = e\r\n\t\t\t\t\tfailure()\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tnotThennable()\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction fire() {\r\n\t\t\t// check if it's a thenable\r\n\t\t\tvar then\r\n\t\t\ttry {\r\n\t\t\t\tthen = promiseValue && promiseValue.then\r\n\t\t\t} catch (e) {\r\n\t\t\t\tm.deferred.onerror(e)\r\n\t\t\t\tpromiseValue = e\r\n\t\t\t\tstate = REJECTING\r\n\t\t\t\treturn fire()\r\n\t\t\t}\r\n\r\n\t\t\tif (state === REJECTING) {\r\n\t\t\t\tm.deferred.onerror(promiseValue)\r\n\t\t\t}\r\n\r\n\t\t\tthennable(then, function () {\r\n\t\t\t\tstate = RESOLVING\r\n\t\t\t\tfire()\r\n\t\t\t}, function () {\r\n\t\t\t\tstate = REJECTING\r\n\t\t\t\tfire()\r\n\t\t\t}, function () {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (state === RESOLVING && isFunction(onSuccess)) {\r\n\t\t\t\t\t\tpromiseValue = onSuccess(promiseValue)\r\n\t\t\t\t\t} else if (state === REJECTING && isFunction(onFailure)) {\r\n\t\t\t\t\t\tpromiseValue = onFailure(promiseValue)\r\n\t\t\t\t\t\tstate = RESOLVING\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tm.deferred.onerror(e)\r\n\t\t\t\t\tpromiseValue = e\r\n\t\t\t\t\treturn finish()\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (promiseValue === self) {\r\n\t\t\t\t\tpromiseValue = TypeError()\r\n\t\t\t\t\tfinish()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthennable(then, function () {\r\n\t\t\t\t\t\tfinish(RESOLVED)\r\n\t\t\t\t\t}, finish, function () {\r\n\t\t\t\t\t\tfinish(state === RESOLVING && RESOLVED)\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tm.deferred.onerror = function (e) {\r\n\t\tif (type.call(e) === \"[object Error]\" &&\r\n\t\t\t\t!/ Error/.test(e.constructor.toString())) {\r\n\t\t\tpendingRequests = 0\r\n\t\t\tthrow e\r\n\t\t}\r\n\t}\r\n\r\n\tm.sync = function (args) {\r\n\t\tvar deferred = m.deferred()\r\n\t\tvar outstanding = args.length\r\n\t\tvar results = []\r\n\t\tvar method = \"resolve\"\r\n\r\n\t\tfunction synchronizer(pos, resolved) {\r\n\t\t\treturn function (value) {\r\n\t\t\t\tresults[pos] = value\r\n\t\t\t\tif (!resolved) method = \"reject\"\r\n\t\t\t\tif (--outstanding === 0) {\r\n\t\t\t\t\tdeferred.promise(results)\r\n\t\t\t\t\tdeferred[method](results)\r\n\t\t\t\t}\r\n\t\t\t\treturn value\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (args.length > 0) {\r\n\t\t\tforEach(args, function (arg, i) {\r\n\t\t\t\targ.then(synchronizer(i, true), synchronizer(i, false))\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tdeferred.resolve([])\r\n\t\t}\r\n\r\n\t\treturn deferred.promise\r\n\t}\r\n\r\n\tfunction identity(value) { return value }\r\n\r\n\tfunction handleJsonp(options) {\r\n\t\tvar callbackKey = options.callbackName || \"mithril_callback_\" +\r\n\t\t\tnew Date().getTime() + \"_\" +\r\n\t\t\t(Math.round(Math.random() * 1e16)).toString(36)\r\n\r\n\t\tvar script = $document.createElement(\"script\")\r\n\r\n\t\tglobal[callbackKey] = function (resp) {\r\n\t\t\tscript.parentNode.removeChild(script)\r\n\t\t\toptions.onload({\r\n\t\t\t\ttype: \"load\",\r\n\t\t\t\ttarget: {\r\n\t\t\t\t\tresponseText: resp\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tglobal[callbackKey] = undefined\r\n\t\t}\r\n\r\n\t\tscript.onerror = function () {\r\n\t\t\tscript.parentNode.removeChild(script)\r\n\r\n\t\t\toptions.onerror({\r\n\t\t\t\ttype: \"error\",\r\n\t\t\t\ttarget: {\r\n\t\t\t\t\tstatus: 500,\r\n\t\t\t\t\tresponseText: JSON.stringify({\r\n\t\t\t\t\t\terror: \"Error making jsonp request\"\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tglobal[callbackKey] = undefined\r\n\r\n\t\t\treturn false\r\n\t\t}\r\n\r\n\t\tscript.onload = function () {\r\n\t\t\treturn false\r\n\t\t}\r\n\r\n\t\tscript.src = options.url +\r\n\t\t\t(options.url.indexOf(\"?\") > 0 ? \"&\" : \"?\") +\r\n\t\t\t(options.callbackKey ? options.callbackKey : \"callback\") +\r\n\t\t\t\"=\" + callbackKey +\r\n\t\t\t\"&\" + buildQueryString(options.data || {})\r\n\r\n\t\t$document.body.appendChild(script)\r\n\t}\r\n\r\n\tfunction createXhr(options) {\r\n\t\tvar xhr = new global.XMLHttpRequest()\r\n\t\txhr.open(options.method, options.url, true, options.user,\r\n\t\t\toptions.password)\r\n\r\n\t\txhr.onreadystatechange = function () {\r\n\t\t\tif (xhr.readyState === 4) {\r\n\t\t\t\tif (xhr.status >= 200 && xhr.status < 300) {\r\n\t\t\t\t\toptions.onload({type: \"load\", target: xhr})\r\n\t\t\t\t} else {\r\n\t\t\t\t\toptions.onerror({type: \"error\", target: xhr})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (options.serialize === JSON.stringify &&\r\n\t\t\t\toptions.data &&\r\n\t\t\t\toptions.method !== \"GET\") {\r\n\t\t\txhr.setRequestHeader(\"Content-Type\",\r\n\t\t\t\t\"application/json; charset=utf-8\")\r\n\t\t}\r\n\r\n\t\tif (options.deserialize === JSON.parse) {\r\n\t\t\txhr.setRequestHeader(\"Accept\", \"application/json, text/*\")\r\n\t\t}\r\n\r\n\t\tif (isFunction(options.config)) {\r\n\t\t\tvar maybeXhr = options.config(xhr, options)\r\n\t\t\tif (maybeXhr != null) xhr = maybeXhr\r\n\t\t}\r\n\r\n\t\tvar data = options.method === \"GET\" || !options.data ? \"\" : options.data\r\n\r\n\t\tif (data && !isString(data) && data.constructor !== global.FormData) {\r\n\t\t\tthrow new Error(\"Request data should be either be a string or \" +\r\n\t\t\t\t\"FormData. Check the `serialize` option in `m.request`\")\r\n\t\t}\r\n\r\n\t\txhr.send(data)\r\n\t\treturn xhr\r\n\t}\r\n\r\n\tfunction ajax(options) {\r\n\t\tif (options.dataType && options.dataType.toLowerCase() === \"jsonp\") {\r\n\t\t\treturn handleJsonp(options)\r\n\t\t} else {\r\n\t\t\treturn createXhr(options)\r\n\t\t}\r\n\t}\r\n\r\n\tfunction bindData(options, data, serialize) {\r\n\t\tif (options.method === \"GET\" && options.dataType !== \"jsonp\") {\r\n\t\t\tvar prefix = options.url.indexOf(\"?\") < 0 ? \"?\" : \"&\"\r\n\t\t\tvar querystring = buildQueryString(data)\r\n\t\t\toptions.url += (querystring ? prefix + querystring : \"\")\r\n\t\t} else {\r\n\t\t\toptions.data = serialize(data)\r\n\t\t}\r\n\t}\r\n\r\n\tfunction parameterizeUrl(url, data) {\r\n\t\tif (data) {\r\n\t\t\turl = url.replace(/:[a-z]\\w+/gi, function (token){\r\n\t\t\t\tvar key = token.slice(1)\r\n\t\t\t\tvar value = data[key] || token\r\n\t\t\t\tdelete data[key]\r\n\t\t\t\treturn value\r\n\t\t\t})\r\n\t\t}\r\n\t\treturn url\r\n\t}\r\n\r\n\tm.request = function (options) {\r\n\t\tif (options.background !== true) m.startComputation()\r\n\t\tvar deferred = new Deferred()\r\n\t\tvar isJSONP = options.dataType &&\r\n\t\t\toptions.dataType.toLowerCase() === \"jsonp\"\r\n\r\n\t\tvar serialize, deserialize, extract\r\n\r\n\t\tif (isJSONP) {\r\n\t\t\tserialize = options.serialize =\r\n\t\t\tdeserialize = options.deserialize = identity\r\n\r\n\t\t\textract = function (jsonp) { return jsonp.responseText }\r\n\t\t} else {\r\n\t\t\tserialize = options.serialize = options.serialize || JSON.stringify\r\n\r\n\t\t\tdeserialize = options.deserialize =\r\n\t\t\t\toptions.deserialize || JSON.parse\r\n\t\t\textract = options.extract || function (xhr) {\r\n\t\t\t\tif (xhr.responseText.length || deserialize !== JSON.parse) {\r\n\t\t\t\t\treturn xhr.responseText\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn null\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\toptions.method = (options.method || \"GET\").toUpperCase()\r\n\t\toptions.url = parameterizeUrl(options.url, options.data)\r\n\t\tbindData(options, options.data, serialize)\r\n\t\toptions.onload = options.onerror = function (ev) {\r\n\t\t\ttry {\r\n\t\t\t\tev = ev || event\r\n\t\t\t\tvar response = deserialize(extract(ev.target, options))\r\n\t\t\t\tif (ev.type === \"load\") {\r\n\t\t\t\t\tif (options.unwrapSuccess) {\r\n\t\t\t\t\t\tresponse = options.unwrapSuccess(response, ev.target)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (isArray(response) && options.type) {\r\n\t\t\t\t\t\tforEach(response, function (res, i) {\r\n\t\t\t\t\t\t\tresponse[i] = new options.type(res)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else if (options.type) {\r\n\t\t\t\t\t\tresponse = new options.type(response)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdeferred.resolve(response)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (options.unwrapError) {\r\n\t\t\t\t\t\tresponse = options.unwrapError(response, ev.target)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdeferred.reject(response)\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tdeferred.reject(e)\r\n\t\t\t\tm.deferred.onerror(e)\r\n\t\t\t} finally {\r\n\t\t\t\tif (options.background !== true) m.endComputation()\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tajax(options)\r\n\t\tdeferred.promise = propify(deferred.promise, options.initialValue)\r\n\t\treturn deferred.promise\r\n\t}\r\n\r\n\treturn m\r\n}); // eslint-disable-line\r\n\n},{}],34:[function(require,module,exports){\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar stringifyPrimitive = function(v) {\n  switch (typeof v) {\n    case 'string':\n      return v;\n\n    case 'boolean':\n      return v ? 'true' : 'false';\n\n    case 'number':\n      return isFinite(v) ? v : '';\n\n    default:\n      return '';\n  }\n};\n\nmodule.exports = function(obj, sep, eq, name) {\n  sep = sep || '&';\n  eq = eq || '=';\n  if (obj === null) {\n    obj = undefined;\n  }\n\n  if (typeof obj === 'object') {\n    return map(objectKeys(obj), function(k) {\n      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;\n      if (isArray(obj[k])) {\n        return map(obj[k], function(v) {\n          return ks + encodeURIComponent(stringifyPrimitive(v));\n        }).join(sep);\n      } else {\n        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));\n      }\n    }).join(sep);\n\n  }\n\n  if (!name) return '';\n  return encodeURIComponent(stringifyPrimitive(name)) + eq +\n         encodeURIComponent(stringifyPrimitive(obj));\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n\nfunction map (xs, f) {\n  if (xs.map) return xs.map(f);\n  var res = [];\n  for (var i = 0; i < xs.length; i++) {\n    res.push(f(xs[i], i));\n  }\n  return res;\n}\n\nvar objectKeys = Object.keys || function (obj) {\n  var res = [];\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) res.push(key);\n  }\n  return res;\n};\n\n},{}]},{},[1]);\n })();"],"sourceRoot":"/source/"}